<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TINSFLASH | Console Admin – IA J.E.A.N.</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at 20% 20%, #00111f, #000814);
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }
    header {
      text-align: center;
      padding: 15px;
      background: rgba(0, 40, 80, 0.8);
      font-size: 1.3em;
      letter-spacing: 1px;
      border-bottom: 2px solid #0ff;
    }
    #cockpit {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      padding: 20px;
    }
    button {
      background: #022c43;
      color: #0ff;
      border: 1px solid #0ff;
      border-radius: 10px;
      padding: 12px;
      font-size: 1.1em;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #0ff;
      color: #000;
      transform: scale(1.05);
    }
    #logs {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 35vh;
      background: rgba(0,0,0,0.75);
      border-top: 2px solid #0ff;
      padding: 10px;
      overflow-y: scroll;
      font-family: monospace;
      font-size: 0.9em;
      color: #0f0;
    }
    #overlay {
      display: none;
      position: fixed;
      top:0;left:0;width:100%;height:100%;
      background: rgba(0,0,0,0.9);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      color: #0ff;
      flex-direction: column;
    }
    input.pin {
      background: #022c43;
      border: 1px solid #0ff;
      border-radius: 5px;
      padding: 10px;
      color: #0ff;
      text-align: center;
      width: 150px;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <h2>🔒 Entrer le code PIN</h2>
    <input class="pin" id="pinInput" maxlength="6" placeholder="******" />
    <button onclick="checkPin()">Déverrouiller</button>
    <p id="pinMsg"></p>
  </div>

  <header>🚀 Console Admin – IA J.E.A.N. (Everest v3.8 PRO+++)</header>

  <div id="cockpit">
    <button onclick="runEurope()">🌍 Run Europe</button>
    <button onclick="runUSA()">🗽 Run USA</button>
    <button onclick="runWorld()">🌐 Run World Alerts</button>
    <button onclick="analyseIA()">🤖 IA J.E.A.N. Analyse</button>
    <button onclick="stopEngine()">🛑 Arrêt Sécurisé</button>
    <button onclick="resetStop()">♻️ Reset Sécurité</button>
    <button onclick="location.href='admin-alerts.html'">⚠️ Gestion Alertes</button>
  </div>

  <div id="logs"></div>

  <script>
    const logsDiv = document.getElementById("logs");

    async function post(url, data={}) {
      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        appendLog(`✅ ${url} → OK`);
        return json;
      } catch (e) {
        appendLog(`❌ ${url} → ${e.message}`, true);
      }
    }

    function appendLog(msg, error=false) {
      const line = document.createElement("div");
      line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      line.style.color = error ? "#f33" : "#0f0";
      logsDiv.appendChild(line);
      logsDiv.scrollTop = logsDiv.scrollHeight;
    }

    // --- Sécurité PIN ---
    const overlay = document.getElementById("overlay");
    overlay.style.display = "flex";
    function checkPin() {
      const val = document.getElementById("pinInput").value.trim();
      if (val === "202679") overlay.style.display = "none";
      else document.getElementById("pinMsg").innerText = "❌ Code incorrect";
    }

    // --- Actions backend ---
    function runEurope() { post("/api/runGlobalEurope"); }
    function runUSA() { post("/api/runGlobalUSA"); }
    function runWorld() { post("/api/runWorldAlerts"); }
    function analyseIA() { post("/api/ai-analyse"); }
    function stopEngine() { post("/api/stop-extraction"); }
    function resetStop() { post("/api/reset-stop-extraction"); }

    // --- Flux Logs live ---
    const evtSource = new EventSource("/api/logs-live");
    evtSource.onmessage = e => appendLog(e.data);
    evtSource.onerror = () => appendLog("⚠️ Erreur flux logs SSE", true);
  </script>
</body>
</html>
