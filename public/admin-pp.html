<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>🛰 Centrale Nucléaire Météo – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #0d1117; color: #e6edf3; margin: 0; padding: 0; }
    header { background: #161b22; padding: 1em; text-align: center; border-bottom: 2px solid #30363d; }
    h1 { margin: 0; font-size: 1.6em; }
    button { background: #238636; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #2ea043; }
    section { padding: 1em; border-bottom: 1px solid #30363d; }
    h2 { color: #58a6ff; margin-top: 0; }
    textarea, input { width: 100%; background: #161b22; color: #e6edf3; border: 1px solid #30363d; padding: 8px; border-radius: 4px; }
    #logs { background: #161b22; padding: 10px; border: 1px solid #30363d; border-radius: 6px; white-space: pre-wrap; max-height: 250px; overflow-y: auto; }
    .alert { padding: 10px; border-radius: 4px; margin-bottom: 10px; }
    .alert.auto { background: #23863644; border: 1px solid #238636; }
    .alert.pending { background: #f5a62344; border: 1px solid #f5a623; }
    .alert.rejected { background: #d73a4944; border: 1px solid #d73a49; }
    .forecast-box { background: #161b22; padding: 10px; border-radius: 6px; border: 1px solid #30363d; margin-bottom: 10px; }
    .forecast-box textarea { height: 100px; }
    .users, .stats { display: flex; justify-content: space-around; flex-wrap: wrap; }
    .users div, .stats div { background: #161b22; padding: 10px; border: 1px solid #30363d; border-radius: 6px; width: 22%; text-align: center; margin: 5px; }
    .chat-box { display: flex; flex-direction: column; }
    .chat-messages { background: #161b22; padding: 10px; border: 1px solid #30363d; border-radius: 6px; height: 200px; overflow-y: auto; margin-bottom: 10px; }
    .chat-input { display: flex; }
    .chat-input input { flex: 1; margin-right: 5px; }
    footer { background: #161b22; text-align: center; padding: 1em; border-top: 2px solid #30363d; font-size: 0.8em; }
  </style>
</head>
<body>
<header>
  <h1>⚡ Centrale Nucléaire Météo – Cockpit Admin</h1>
  <button onclick="runSuperForecast()">🚀 Lancer un Run (Europe + USA)</button>
</header>

<section>
  <h2>📊 Logs du moteur</h2>
  <div id="logs">En attente d'un Run...</div>
</section>

<section>
  <h2>🌦 Prévisions nationales (éditables)</h2>
  <div class="forecast-box">
    <h3>🇧🇪 Belgique</h3>
    <textarea id="forecast-be"></textarea>
    <button onclick="saveForecast('BE')">💾 Sauvegarder & rafraîchir Index</button>
  </div>
  <div class="forecast-box">
    <h3>🇫🇷 France</h3>
    <textarea id="forecast-fr"></textarea>
    <button onclick="saveForecast('FR')">💾 Sauvegarder & rafraîchir Index</button>
  </div>
  <div class="forecast-box">
    <h3>🇱🇺 Luxembourg</h3>
    <textarea id="forecast-lux"></textarea>
    <button onclick="saveForecast('LUX')">💾 Sauvegarder & rafraîchir Index</button>
  </div>
</section>

<section>
  <h2>⚠️ Alertes</h2>
  <div id="alerts">En attente d'un Run...</div>
</section>

<section>
  <h2>💬 Chat avec J.E.A.N.</h2>
  <div class="chat-box">
    <div id="chat-messages" class="chat-messages"></div>
    <div class="chat-input">
      <input type="text" id="chat-input" placeholder="Posez une question à J.E.A.N.">
      <button onclick="sendChat()">Envoyer</button>
    </div>
  </div>
</section>

<section>
  <h2>👥 Utilisateurs</h2>
  <div class="users">
    <div><h3>Free</h3><p id="users-free">0</p></div>
    <div><h3>Premium</h3><p id="users-premium">0</p></div>
    <div><h3>Pro</h3><p id="users-pro">0</p></div>
    <div><h3>Pro+</h3><p id="users-proplus">0</p></div>
  </div>
</section>

<section>
  <h2>📈 Statistiques système</h2>
  <div class="stats">
    <div><h3>Prévisions</h3><p id="stats-forecasts">0</p></div>
    <div><h3>Alertes</h3><p id="stats-alerts">0</p></div>
    <div><h3>Uptime</h3><p id="stats-uptime">0s</p></div>
  </div>
</section>

<footer>
  Centrale Nucléaire Météo – Tinsflash 🚀🌍 | Frissons NASA | Grincement météorologues
</footer>

<script>
async function runSuperForecast() {
  const res = await fetch("/api/supercalc/run", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ lat: 50.5, lon: 4.7 })
  });
  const data = await res.json();
  document.getElementById("logs").textContent = data.logs.join("\n");

  if (data.nationalForecasts) {
    document.getElementById("forecast-be").value = data.nationalForecasts.BE;
    document.getElementById("forecast-fr").value = data.nationalForecasts.FR;
    document.getElementById("forecast-lux").value = data.nationalForecasts.LUX;
  }

  if (data.jeanResponse) {
    const alertBox = document.getElementById("alerts");
    alertBox.innerHTML = `<div class="alert auto">${data.jeanResponse.text}</div>`;
  } else {
    document.getElementById("alerts").innerHTML =
      "<div class='alert rejected'>❌ Pas de réponse de l’IA</div>";
  }
}

function saveForecast(country) {
  alert(`Prévision ${country} sauvegardée & rafraîchie sur Index.`);
}

async function sendChat() {
  const msg = document.getElementById("chat-input").value;
  if (!msg) return;

  const res = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: msg })
  });
  const data = await res.json();

  const chatBox = document.getElementById("chat-messages");
  chatBox.innerHTML += `<div><b>Vous:</b> ${msg}</div>`;
  chatBox.innerHTML += `<div><b>J.E.A.N.:</b> ${data.text}</div>`;
  document.getElementById("chat-input").value = "";
}
</script>
</body>
</html>
