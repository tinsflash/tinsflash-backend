<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>‚ö° Centrale Nucl√©aire M√©t√©o ‚Äì Admin</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #f1f1f1;
      margin: 0;
      padding: 0;
    }
    h1, h2, h3 {
      text-align: center;
      color: #00e0ff;
    }
    .card {
      background: #1e1e1e;
      margin: 15px auto;
      padding: 15px;
      border-radius: 12px;
      max-width: 800px;
      box-shadow: 0 0 10px rgba(0, 224, 255, 0.3);
    }
    pre {
      background: #000;
      padding: 10px;
      border-radius: 8px;
      color: #0f0;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    textarea {
      width: 100%;
      height: 80px;
      border-radius: 8px;
      border: none;
      padding: 8px;
      margin-bottom: 8px;
      font-family: monospace;
      font-size: 14px;
    }
    button {
      background: #00e0ff;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      color: #000;
      font-weight: bold;
    }
    button:hover {
      background: #00bcd4;
    }
  </style>
</head>
<body>
  <h1>‚ö° Centrale Nucl√©aire M√©t√©o ‚Äì Admin</h1>

  <!-- Bouton pour lancer un run -->
  <div class="card">
    <h2>‚ö° Lancer un Run SuperForecast</h2>
    <button onclick="lancerRun()">üöÄ Lancer le Run</button>
  </div>

  <!-- Logs en temps r√©el -->
  <div class="card">
    <h3>üìú Logs en temps r√©el</h3>
    <pre id="logs">En attente...</pre>
  </div>

  <!-- Pr√©visions nationales -->
  <div class="card">
    <h3>üåç Pr√©visions Nationales (BE / FR / LUX)</h3>
    <pre id="national-forecasts">En attente d‚Äôun run...</pre>

    <h4>‚úèÔ∏è Modifier manuellement</h4>
    <label>üáßüá™ Belgique :</label>
    <textarea id="forecast-BE"></textarea>
    <label>üá´üá∑ France :</label>
    <textarea id="forecast-FR"></textarea>
    <label>üá±üá∫ Luxembourg :</label>
    <textarea id="forecast-LUX"></textarea>
    <button onclick="sauverNational()">üíæ Sauvegarder les pr√©visions nationales</button>
  </div>

  <!-- Script -->
  <script>
    async function lancerRun() {
      const res = await fetch("/api/supercalc/run", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ lat: 50.5, lon: 4.7 }),
      });

      const data = await res.json();

      // Logs
      document.getElementById("logs").textContent = data.logs.join("\n");

      // Pr√©visions nationales
      if (data.nationalForecasts) {
        document.getElementById("national-forecasts").textContent =
          JSON.stringify(data.nationalForecasts, null, 2);

        // Remplir les textarea
        document.getElementById("forecast-BE").value = data.nationalForecasts.BE || "";
        document.getElementById("forecast-FR").value = data.nationalForecasts.FR || "";
        document.getElementById("forecast-LUX").value = data.nationalForecasts.LUX || "";
      }
    }

    async function sauverNational() {
      const forecasts = {
        BE: document.getElementById("forecast-BE").value,
        FR: document.getElementById("forecast-FR").value,
        LUX: document.getElementById("forecast-LUX").value,
      };

      // Appel √† un endpoint backend (√† cr√©er si pas encore fait)
      const res = await fetch("/api/admin/national-forecasts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(forecasts),
      });

      if (res.ok) {
        alert("‚úÖ Pr√©visions nationales sauvegard√©es et envoy√©es sur index !");
      } else {
        alert("‚ùå Erreur lors de la sauvegarde des pr√©visions");
      }
    }
  </script>
</body>
</html>
