<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>‚ö° Console Admin ‚Äì Centrale Nucl√©aire M√©t√©o</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b0e17;
      color: #f0f0f0;
      margin: 0; padding: 0;
    }
    header {
      background: #1b2133;
      padding: 15px;
      text-align: center;
    }
    h1 { margin: 0; font-size: 20px; }
    .container { padding: 20px; }
    button {
      padding: 10px 20px;
      margin: 10px 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn-run { background: #28a745; color: white; }
    .btn-ai  { background: #007bff; color: white; }
    pre {
      background: #1e2639;
      color: #e0e0e0;
      padding: 10px;
      border-radius: 5px;
      max-height: 400px;
      overflow-y: auto;
    }
    .status {
      margin: 15px 0;
      padding: 10px;
      border-radius: 5px;
      background: #1e2639;
    }
    .dot {
      height: 12px; width: 12px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
    .pending { background: orange; }
    .ok { background: limegreen; }
    .fail { background: red; }
  </style>
</head>
<body>
  <header>
    <h1>‚ö° Centrale Nucl√©aire M√©t√©o ‚Äì Console Admin</h1>
  </header>

  <div class="container">
    <button class="btn-run" onclick="launchSuperForecast()">üöÄ Lancer le moteur complet</button>
    <button class="btn-ai" onclick="launchAIOnly()">ü§ñ Lancer uniquement l‚ÄôIA (optionnel)</button>

    <h2>üìä Checkup</h2>
    <div id="checkup"></div>

    <h2>üìú Logs</h2>
    <pre id="logs">En attente‚Ä¶</pre>

    <h2>‚ö†Ô∏è Alertes</h2>
    <pre id="alerts">En attente‚Ä¶</pre>
  </div>

  <script>
    async function refreshLogs() {
      const res = await fetch("/api/logs");
      const data = await res.json();
      document.getElementById("logs").textContent = 
        (data || []).map(l => `[${l.ts}] ${l.msg}`).join("\n") || "Aucun log";
    }

    async function refreshCheckup() {
      const res = await fetch("/api/checkup");
      const data = await res.json();
      let html = "";
      for (const [key, val] of Object.entries(data)) {
        let cls = "pending";
        if (val === "OK") cls = "ok";
        if (val === "FAIL") cls = "fail";
        html += `<div class="status"><span class="dot ${cls}"></span>${key}: ${val}</div>`;
      }
      document.getElementById("checkup").innerHTML = html || "Pas de donn√©es.";
    }

    async function refreshAlerts() {
      const res = await fetch("/api/alerts");
      const data = await res.json();
      document.getElementById("alerts").textContent =
        JSON.stringify(data.alerts || [], null, 2);
    }

    async function launchSuperForecast() {
      document.getElementById("logs").textContent = "üöÄ Lancement du SuperForecast Global‚Ä¶";
      await fetch("/api/superforecast", { method: "POST" });
      await refreshLogs();
      await refreshCheckup();
      await refreshAlerts();
    }

    async function launchAIOnly() {
      document.getElementById("logs").textContent = "ü§ñ Lancement uniquement IA‚Ä¶";
      await fetch("/api/chat/engine", { 
        method: "POST", 
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: "Analyse finale IA du moteur m√©t√©o" })
      });
      await refreshLogs();
    }

    // Rafra√Æchissement auto toutes les 10s
    setInterval(() => {
      refreshLogs();
      refreshCheckup();
      refreshAlerts();
    }, 10000);

    // Premier chargement
    refreshLogs();
    refreshCheckup();
    refreshAlerts();
  </script>
</body>
</html>
