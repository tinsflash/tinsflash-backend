<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>âš¡ Centrale NuclÃ©aire MÃ©tÃ©o â€“ Admin</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>âš¡ Console Admin Tinsflash</h1>
  </header>

  <!-- Bouton Run unique -->
  <section>
    <h2>ğŸš€ SuperForecast</h2>
    <button onclick="runSuperForecast()">Lancer Run</button>
    <div id="superforecast-result">En attenteâ€¦</div>
  </section>

  <!-- PrÃ©visions -->
  <section>
    <h2>ğŸ›°ï¸ PrÃ©visions nationales</h2>
    <div id="forecasts">â³ Chargementâ€¦</div>
  </section>

  <!-- Alertes -->
  <section>
    <h2>âš ï¸ Alertes</h2>
    <div id="alerts">â³ Chargementâ€¦</div>
  </section>

  <!-- Chat -->
  <section>
    <h2>ğŸ¤– J.E.A.N.</h2>
    <input id="chat-input" placeholder="Pose ta questionâ€¦" style="width:70%;"/>
    <button onclick="sendChat()">Envoyer</button>
    <div id="chat-reply"></div>
  </section>

  <!-- Logs -->
  <section>
    <h2>ğŸ“œ Logs</h2>
    <div id="logs">â³ Chargementâ€¦</div>
  </section>

<script>
const API = "";

// === SuperForecast ===
async function runSuperForecast() {
  document.getElementById("superforecast-result").innerText = "â³ Lancementâ€¦";
  try {
    const res = await fetch(`${API}/api/superforecast/run`, { method:"POST" });
    const data = await res.json();
    document.getElementById("superforecast-result").innerText = data.analysis || "âœ… Run terminÃ©";
    loadForecasts();
    loadLogs();
  } catch (err) {
    document.getElementById("superforecast-result").innerText = "âŒ Erreur: " + err.message;
  }
}

// === Forecasts ===
async function loadForecasts() {
  const box = document.getElementById("forecasts");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const forecasts = await res.json();
    if (!forecasts.length) { box.innerHTML = "Aucune donnÃ©e."; return; }
    box.innerHTML = forecasts.map(f => `
      <div>
        <b>${f.country}</b> (${f.date}) ğŸŒ¡ï¸ ${f.minTemp}â€“${f.maxTemp}Â°C â˜” ${f.rainProbability || 0}%
      </div>`).join("");
  } catch (err) { box.innerHTML = "âŒ Erreur: " + err.message; }
}

// === Alertes ===
async function loadAlerts() {
  const box = document.getElementById("alerts");
  try {
    const res = await fetch(`${API}/api/alerts`);
    const alerts = await res.json();
    if (!alerts.length) { box.innerHTML = "Aucune alerte."; return; }
    box.innerHTML = alerts.map(a => `
      <div>
        <b>${a.title || "Alerte"}</b> (${a.certainty}%) â†’ ${a.status}<br/>
        ${a.description}<br/>
      </div>`).join("");
  } catch (err) { box.innerHTML = "âŒ Erreur: " + err.message; }
}

// === Chat ===
async function sendChat() {
  const q = document.getElementById("chat-input").value;
  const reply = document.getElementById("chat-reply");
  reply.innerText = "â³ J.E.A.N. rÃ©flÃ©chitâ€¦";
  try {
    const res = await fetch(`${API}/api/chat`, { 
      method:"POST", headers:{ "Content-Type":"application/json" }, 
      body:JSON.stringify({ message:q })
    });
    const data = await res.json();
    reply.innerText = data.reply || "âŒ Pas de rÃ©ponse";
  } catch (err) { reply.innerText = "âŒ Erreur: " + err.message; }
}

// === Logs ===
async function loadLogs() {
  const box = document.getElementById("logs");
  try {
    const res = await fetch(`${API}/api/logs`);
    const logs = await res.json();
    box.innerHTML = logs.map(l => `<div>[${l.timestamp}] ${l.message}</div>`).join("");
  } catch (err) { box.innerHTML = "âŒ Erreur: " + err.message; }
}

setInterval(loadLogs, 10000);
loadForecasts(); loadAlerts(); loadLogs();
</script>
</body>
</html>
