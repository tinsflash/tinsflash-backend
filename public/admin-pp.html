<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>⚙️ Console Admin - Centrale Météo</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    nav { margin-bottom: 20px; }
    nav button { margin-right: 10px; padding: 8px 15px; cursor: pointer; }
    section { display: none; }
    section.active { display: block; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    .ok { color: green; font-weight: bold; }
    .warn { color: orange; font-weight: bold; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>⚙️ Console Admin - Centrale Nucléaire Météo</h1>

  <nav>
    <button onclick="showTab('checkup')">🔎 Check moteur</button>
    <button onclick="showTab('alerts')">📡 Alertes</button>
    <!-- autres onglets existants (Logs, Chat IA, News...) -->
  </nav>

  <!-- Section Check moteur -->
  <section id="checkup">
    <h2>🔎 Check moteur</h2>
    <button onclick="loadCheckup()">Lancer Checkup</button>
    <table id="checkupTable">
      <thead>
        <tr>
          <th>Zone</th>
          <th>Couverte</th>
          <th>Statut</th>
          <th>Détails</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Section Alertes -->
  <section id="alerts">
    <h2>📡 Liste des Alertes</h2>
    <button onclick="loadAlerts()">🔄 Rafraîchir</button>
    <table id="alertsTable">
      <thead>
        <tr>
          <th>Zone</th>
          <th>Type</th>
          <th>Fiabilité</th>
          <th>Premier ?</th>
          <th>Statut</th>
          <th>Explication</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    function showTab(tabId) {
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
    }

    async function loadCheckup() {
      try {
        const res = await fetch("/api/checkup");
        const data = await res.json();
        const tbody = document.querySelector("#checkupTable tbody");
        tbody.innerHTML = "";
        data.checkup.forEach(row => {
          tbody.innerHTML += `
            <tr>
              <td>${row.zone}</td>
              <td>${row.covered ? "✅ Oui" : "❌ Non"}</td>
              <td>${row.status}</td>
              <td>${row.details}</td>
            </tr>`;
        });
      } catch (err) {
        alert("Erreur lors du check moteur: " + err.message);
      }
    }

    async function loadAlerts() {
      try {
        const res = await fetch("/api/alerts/Belgium"); // 👉 zone test (Belgique)
        const data = await res.json();
        const tbody = document.querySelector("#alertsTable tbody");
        tbody.innerHTML = "";
        data.alerts.forEach(alert => {
          let fiabClass = alert.fiabilite >= 90 ? "ok" : (alert.fiabilite >= 70 ? "warn" : "error");
          tbody.innerHTML += `
            <tr>
              <td>${alert.zoneInfo?.zone || data.zone}</td>
              <td>${alert.type || "Inconnu"}</td>
              <td class="${fiabClass}">${alert.fiabilite}%</td>
              <td>${alert.premier ? "✅ Oui" : "❌ Non"}</td>
              <td>${alert.statut}</td>
              <td>${alert.explication}</td>
            </tr>`;
        });
      } catch (err) {
        alert("Erreur lors du chargement des alertes: " + err.message);
      }
    }

    // Tab par défaut
    showTab('checkup');
  </script>
</body>
</html>
