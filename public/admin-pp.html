<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ö° Centrale Nucl√©aire M√©t√©o ‚Äì Console Admin</title>
  <style>
    body { background:#0a0a0a; color:#00ffe0; font-family:"Courier New", monospace; margin:0; padding:0;}
    h1,h2 { text-align:center; text-shadow:0 0 10px #00ffe0;}
    .section { margin:20px; padding:20px; border-radius:10px; background:#111; box-shadow:0 0 15px rgba(0,255,224,0.3);}
    button { background:#00ffe0; color:#000; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:bold;}
    button:hover { background:#00c2a8;}
    pre,.output { background:#000; padding:10px; border-radius:8px; overflow-x:auto; color:#00ffe0;}
    img { max-width:100%; margin:5px 0; border:1px solid #00ffe0; border-radius:6px;}
    input,select,textarea { padding:10px; margin:5px 0; width:95%; border-radius:6px; border:1px solid #00ffe0; background:#000; color:#00ffe0;}
  </style>
</head>
<body>
  <h1>‚ö° Centrale Nucl√©aire M√©t√©o ‚Äì Console Admin</h1>

  <!-- RUN GLOBAL -->
  <div class="section">
    <h2>üöÄ Lancer un Run Global</h2>
    <button onclick="callAPI('/api/superforecast','runOutput')">Lancer le moteur</button>
    <div id="runOutput" class="output"></div>
  </div>

  <!-- LOGS -->
  <div class="section">
    <h2>üì° Logs moteur</h2>
    <button onclick="callAPI('/api/logs','logsOutput')">Actualiser</button>
    <div id="logsOutput" class="output"></div>
  </div>

  <!-- √âTAT -->
  <div class="section">
    <h2>üõ†Ô∏è √âtat du moteur</h2>
    <button onclick="callAPI('/api/engine','engineOutput')">V√©rifier</button>
    <div id="engineOutput" class="output"></div>
  </div>

  <!-- ZONES -->
  <div class="section">
    <h2>‚úÖ Checkup zones</h2>
    <button onclick="callAPI('/api/zones','zonesOutput')">V√©rifier zones</button>
    <div id="zonesOutput" class="output"></div>
  </div>

  <!-- ALERTES -->
  <div class="section">
    <h2>‚ö†Ô∏è Alertes m√©t√©o</h2>
    <button onclick="callAPI('/api/alerts','alertsOutput')">Charger</button>
    <div id="alertsOutput" class="output"></div>
  </div>

  <!-- RADAR -->
  <div class="section">
    <h2>üåç Radar m√©t√©o global</h2>
    <button onclick="loadRadar()">Afficher</button>
    <div id="radarOutput" class="output"></div>
  </div>

  <!-- ACTUALIT√âS -->
  <div class="section">
    <h2>üì∞ Actualit√©s m√©t√©o</h2>
    <button onclick="loadNews()">Charger</button>
    <div id="newsOutput" class="output"></div>
  </div>

  <!-- UTILISATEURS -->
  <div class="section">
    <h2>üë• Utilisateurs</h2>
    <button onclick="callAPI('/api/users','usersOutput')">Lister</button>
    <div id="usersOutput" class="output"></div>
  </div>

  <!-- RECHERCHE LOCALE -->
  <div class="section">
    <h2>üåê Rechercher une localit√© (zones couvertes)</h2>
    <input id="city" placeholder="Ville (ex: Marseille)"/>
    <select id="country">
      <option>France</option>
      <option>Belgium</option>
      <option>Germany</option>
      <option>Spain</option>
      <option>Italy</option>
      <option>United Kingdom</option>
      <option>Norway</option>
      <option>Ukraine</option>
      <option>United States</option>
    </select>
    <button onclick="searchLocal()">Chercher</button>
    <div id="localOutput" class="output"></div>
  </div>

  <!-- CHAT IA -->
  <div class="section">
    <h2>ü§ñ Chat IA ‚Äì Moteur m√©t√©o nucl√©aire</h2>
    <textarea id="chatInput" rows="3" placeholder="Posez une question..."></textarea>
    <button onclick="askChat()">Envoyer</button>
    <div id="chatOutput" class="output"></div>
  </div>

<script>
async function callAPI(endpoint, targetId) {
  try {
    const res = await fetch(endpoint);
    const data = await res.json();
    document.getElementById(targetId).innerText = JSON.stringify(data, null, 2);
  } catch (err) {
    document.getElementById(targetId).innerText = "‚ùå Erreur: " + err.message;
  }
}

async function loadRadar() {
  const res = await fetch("/api/radar");
  const data = await res.json();
  let html = "";
  if (data.success && data.tiles) {
    data.tiles.forEach(tile => {
      html += `<p>${tile.name}</p><img src="${tile.url}" alt="${tile.name}"/>`;
    });
  } else {
    html = "<p>‚ö†Ô∏è Radar indisponible</p>";
  }
  document.getElementById("radarOutput").innerHTML = html;
}

async function loadNews() {
  const res = await fetch("/api/news");
  const data = await res.json();
  let html = "";
  if (Array.isArray(data)) {
    data.forEach(n => {
      html += `<p><strong>${n.title}</strong> ‚Äì ${n.source}<br/><a href="${n.url}" target="_blank">Lire</a></p>`;
    });
  }
  document.getElementById("newsOutput").innerHTML = html || "‚ö†Ô∏è Pas de news";
}

async function searchLocal() {
  const city = document.getElementById("city").value;
  const country = document.getElementById("country").value;
  const res = await fetch(`/api/localforecast?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}`);
  const data = await res.json();
  document.getElementById("localOutput").innerText = JSON.stringify(data, null, 2);
}

async function askChat() {
  const message = document.getElementById("chatInput").value;
  const res = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message })
  });
  const data = await res.json();
  document.getElementById("chatOutput").innerText = data.reply?.reply || JSON.stringify(data, null, 2);
}
</script>
</body>
</html>
