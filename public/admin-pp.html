<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‚öôÔ∏è TINSFLASH PRO+++ Console ‚Äì IA J.E.A.N</title>
  <style>
    body{margin:0;background:#0b1220;color:#e6f6ff;font-family:Inter,system-ui}
    header{padding:14px;text-align:center;background:#08121d;color:#6bf3ff;font-weight:700}
    nav{display:flex;justify-content:center;gap:10px;padding:8px;background:#0d1624}
    nav a{color:#6bf3ff;text-decoration:none;padding:6px 10px;border-radius:8px}
    nav a:hover{background:#122236}
    .container{max-width:1100px;margin:12px auto;padding:12px}
    .panel{background:#0e1721;border-radius:10px;padding:12px;margin-top:10px}
    .status-board{display:flex;justify-content:space-around;gap:10px;margin-bottom:10px}
    .status{flex:1;text-align:center;padding:10px;border-radius:10px;font-weight:700}
    .green{background:#073d24;color:#4cffb3}
    .red{background:#3d0711;color:#ff4c60}
    .yellow{background:#3a2a05;color:#ffe073}
    button{background:#4fc3f7;border:none;padding:10px 16px;border-radius:8px;color:#001;font-weight:700;cursor:pointer}
    button:hover{background:#6bf3ff}
    pre{background:#07121a;color:#b4f8ff;padding:10px;border-radius:8px;max-height:45vh;overflow:auto}
  </style>
</head>
<body>
<script>
  const pin=sessionStorage.getItem("tinsflashPIN");
  if(!pin){
    const p=prompt("Code d‚Äôacc√®s admin ?");
    if(p!=="202679"){alert("Acc√®s refus√©");location.href="/";} 
    else sessionStorage.setItem("tinsflashPIN","ok");
  }
</script>

<header>‚öôÔ∏è Console Administrateur ‚Äì IA J.E.A.N (GPT-5 Moteur)</header>
<nav>
  <a href="/admin-pp.html">Console</a>
  <a href="/admin-alerts.html">Alertes</a>
  <a href="/admin-chat.html">Chat</a>
</nav>

<div class="container">

  <!-- üü¢ Tableau de voyants -->
  <div class="status-board" id="statusBoard">
    <div id="statusEngine" class="status red">Moteur ‚ùå</div>
    <div id="statusIA" class="status red">IA J.E.A.N ‚ùå</div>
    <div id="statusFusion" class="status red">Fusion ‚ùå</div>
  </div>

  <div class="panel">
    <button onclick="runGlobal()">üåç Lancer Run Global</button>
    <button onclick="runIA()">üß† Analyse IA J.E.A.N</button>
    <button onclick="runFusion()">üåê Fusion Globale</button>
  </div>

  <div class="panel">
    <h3>üß≠ Logs en direct</h3>
    <pre id="logs">Chargement des logs...</pre>
  </div>
</div>

<script>
async function updateStatus(){
  try{
    const res = await fetch("/api/status");
    const j = await res.json();
    const eng = document.getElementById("statusEngine");
    const ia  = document.getElementById("statusIA");
    const fu  = document.getElementById("statusFusion");
    const status = (j.status || "").toLowerCase();

    // moteur
    if(status.includes("ok")||status.includes("running")){eng.className="status green";eng.textContent="Moteur üü¢";}
    else if(status.includes("idle")){eng.className="status yellow";eng.textContent="Moteur üü°";}
    else{eng.className="status red";eng.textContent="Moteur üî¥";}

    // IA J.E.A.N
    const logs = j.checkup?.logs || [];
    const lastIA = logs?.slice(-5).find(l=>l.message?.includes("IA J.E.A.N"));
    if(lastIA){ia.className="status green";ia.textContent="IA J.E.A.N üü¢";}
    else{ia.className="status yellow";ia.textContent="IA J.E.A.N üü°";}

    // Fusion
    if(j.checkup?.lastFusionOK){fu.className="status green";fu.textContent="Fusion üü¢";}
    else{fu.className="status yellow";fu.textContent="Fusion üü°";}
  }catch(e){
    console.warn("Status error:",e);
  }
}

async function refreshLogs(){
  try{
    const res = await fetch("/api/logs-live");
    const j = await res.json();
    const out = j.logs?.map(l=>`${l.timestamp} | ${l.message}`).join("\n") || "Aucun log";
    document.getElementById("logs").textContent = out;
  }catch(e){
    document.getElementById("logs").textContent="Erreur logs: "+e.message;
  }
}

async function runGlobal(){
  document.getElementById("logs").textContent="üöÄ Run Global en cours...";
  const r=await fetch("/api/run-global",{method:"POST"});await refreshLogs();updateStatus();
}
async function runIA(){
  document.getElementById("logs").textContent="üß† Analyse IA J.E.A.N en cours...";
  const r=await fetch("/api/ai-analyse",{method:"POST"});await refreshLogs();updateStatus();
}
async function runFusion(){
  document.getElementById("logs").textContent="üåê Fusion Globale en cours...";
  const r=await fetch("/api/runWorldAlerts",{method:"POST"});await refreshLogs();updateStatus();
}

setInterval(()=>{updateStatus();refreshLogs();},10000);
updateStatus();refreshLogs();
</script>

</body>
</html>
