<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>ğŸ›°ï¸ Centrale NuclÃ©aire MÃ©tÃ©o â€“ Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="style.css">
  <style>
    body { background:#0a0f1c; color:#00ffea; font-family:"Orbitron", Arial, sans-serif; margin:0; }
    header { text-align:center; padding:20px; border-bottom:2px solid #00ffea; }
    h1 { margin:0; color:#00ffea; text-shadow:0 0 12px #00fbe7; }
    .container { padding:20px; max-width:1400px; margin:auto; display:grid; gap:20px; }
    .card { background:#111830; border:1px solid #00ffea; border-radius:12px; padding:20px; box-shadow:0 0 15px rgba(0,255,234,0.3); }
    h2 { color:#00fbe7; margin-top:0; text-shadow:0 0 8px #00d9ff; }
    .btn { background:#00ffea; color:#000; border:none; padding:10px 15px; margin:5px; border-radius:8px; font-weight:bold; cursor:pointer; }
    .btn:hover { background:#00d9ff; }
    #logs { background:#000; color:#0f0; font-family:monospace; padding:10px; height:220px; overflow-y:auto; border-radius:6px; }
    textarea,input { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:none; background:#0c1a2b; color:#fff; }
    .status-dot { height:12px; width:12px; border-radius:50%; display:inline-block; margin-right:6px; }
    .green { background:#0f0; } .yellow { background:#ff0; } .red { background:#f00; }
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
  </style>
  <script>
    // SÃ©curitÃ© simple par mot de passe
    document.addEventListener("DOMContentLoaded", () => {
      const pass = prompt("Mot de passe Admin ?");
      if(pass !== "202679") {
        alert("â›” AccÃ¨s refusÃ©");
        window.location.href = "index.html";
      }
    });
  </script>
</head>
<body>
  <header>
    <h1>ğŸ›°ï¸ Centrale NuclÃ©aire MÃ©tÃ©o â€“ Console Admin</h1>
  </header>
  <div class="container">

    <!-- Run -->
    <div class="card">
      <h2>âš¡ Supercalculateur</h2>
      <button class="btn" onclick="runForecast()">ğŸš€ Lancer un Run Global</button>
      <div id="forecast-status">â³ En attente...</div>
    </div>

    <!-- Logs -->
    <div class="card">
      <h2>ğŸ“¡ Logs moteur</h2>
      <button class="btn" onclick="loadLogs()">ğŸ” Actualiser</button>
      <div id="logs">â³ Attente logs...</div>
    </div>

    <!-- Alertes -->
    <div class="card">
      <h2>âš ï¸ Alertes mÃ©tÃ©o</h2>
      <button class="btn" onclick="loadAlerts()">ğŸ” Charger</button>
      <div class="two-col">
        <div>
          <h3>âœ… PubliÃ©es</h3>
          <div id="alerts-published">â³ ...</div>
        </div>
        <div>
          <h3>â³ Ã€ valider</h3>
          <div id="alerts-pending">â³ ...</div>
        </div>
      </div>
    </div>

    <!-- Checkup -->
    <div class="card">
      <h2>ğŸ› ï¸ Ã‰tat du moteur</h2>
      <button class="btn" onclick="loadCheckup()">ğŸ” VÃ©rifier</button>
      <div id="checkup">â³ ...</div>
    </div>

    <!-- PrÃ©visions Ã©ditables -->
    <div class="card">
      <h2>ğŸŒ PrÃ©visions Ã©ditables</h2>
      <h3>ğŸ‡§ğŸ‡ª Belgique</h3>
      <textarea id="forecast-be"></textarea>
      <button class="btn" onclick="saveForecast('Belgium')">ğŸ’¾ Sauver</button>
      <h3>ğŸ‡«ğŸ‡· France</h3>
      <textarea id="forecast-fr"></textarea>
      <button class="btn" onclick="saveForecast('France')">ğŸ’¾ Sauver</button>
    </div>

    <!-- Utilisateurs -->
    <div class="card">
      <h2>ğŸ“Š Utilisateurs</h2>
      <button class="btn" onclick="loadUsers()">ğŸ” Charger stats</button>
      <div id="user-stats">â³ ...</div>
    </div>

    <!-- Chat IA -->
    <div class="card">
      <h2>ğŸ¤– IA J.E.A.N</h2>
      <textarea id="ai-input" placeholder="Posez une question..."></textarea>
      <button class="btn" onclick="sendChat()">Envoyer</button>
      <div id="ai-response"></div>
    </div>

    <!-- Radar -->
    <div class="card">
      <h2>ğŸ›°ï¸ Radar Global</h2>
      <div id="radar-map" style="height:400px; border-radius:8px;">â³ ...</div>
    </div>

    <!-- News -->
    <div class="card">
      <h2>ğŸ“° ActualitÃ©s mÃ©tÃ©o</h2>
      <button class="btn" onclick="loadNews()">ğŸ” Charger</button>
      <div id="news-feed">â³ ...</div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const API_BASE = "/api";

    async function runForecast() {
      document.getElementById("forecast-status").innerText = "â³ Calcul...";
      const res = await fetch(`${API_BASE}/superforecast`);
      const data = await res.json();
      document.getElementById("forecast-status").innerText = "âœ… TerminÃ© : " + (data.analysis || "Pas de donnÃ©es");
    }

    async function loadLogs() {
      const res = await fetch(`${API_BASE}/logs`);
      const data = await res.json();
      document.getElementById("logs").innerText = JSON.stringify(data, null, 2);
    }

    async function loadAlerts() {
      const res = await fetch(`${API_BASE}/alerts/Belgium`);
      const data = await res.json();
      const published = data.alerts.filter(a => a.reliability >= 90);
      const pending = data.alerts.filter(a => a.reliability >= 70 && a.reliability < 90);
      document.getElementById("alerts-published").innerHTML = published.map(a => `âœ… ${a.message} (${a.reliability}%)`).join("<br>");
      document.getElementById("alerts-pending").innerHTML = pending.map(a => `âš ï¸ ${a.message} (${a.reliability}%)`).join("<br>");
    }

    async function loadCheckup() {
      const res = await fetch(`${API_BASE}/checkup`);
      const data = await res.json();
      document.getElementById("checkup").innerText = JSON.stringify(data, null, 2);
    }

    async function saveForecast(zone) {
      const text = document.getElementById(zone === "Belgium" ? "forecast-be" : "forecast-fr").value;
      await fetch(`${API_BASE}/bulletin/${zone}`, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({ text }) });
      alert("âœ… PrÃ©vision sauvegardÃ©e pour " + zone);
    }

    async function loadUsers() {
      const res = await fetch(`${API_BASE}/users`);
      const data = await res.json();
      document.getElementById("user-stats").innerText = JSON.stringify(data, null, 2);
    }

    async function sendChat() {
      const msg = document.getElementById("ai-input").value;
      const res = await fetch(`${API_BASE}/chat`, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({ message: msg }) });
      const data = await res.json();
      document.getElementById("ai-response").innerText = data.reply || JSON.stringify(data);
    }

    async function loadNews() {
      const res = await fetch(`${API_BASE}/news`);
      const data = await res.json();
      document.getElementById("news-feed").innerHTML = data.articles.map(n => `ğŸ“° <a href="${n.url}" target="_blank">${n.title}</a>`).join("<br>");
    }

    // Radar Leaflet simple
    const map = L.map('radar-map').setView([50, 4], 4);
    L.tileLayer('https://tile.openweathermap.org/map/precipitation/{z}/{x}/{y}.png?appid=YOUR_OPENWEATHER_KEY', {
      attribution: '&copy; OpenWeather',
      maxZoom: 10
    }).addTo(map);
  </script>
</body>
</html>
