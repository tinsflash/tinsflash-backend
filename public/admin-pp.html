<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ§  Centrale NuclÃ©aire MÃ©tÃ©o â€“ Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #0a0f24; color: #f0f0f0; }
    header { background: #142850; padding: 1rem; text-align: center; }
    h1 { margin: 0; font-size: 1.6rem; }
    section { padding: 1rem; border-bottom: 1px solid #333; }
    h2 { font-size: 1.3rem; margin-top: 0; }
    textarea, input, select {
      width: 100%; padding: 0.5rem; margin: 0.5rem 0;
      border: none; border-radius: 5px;
    }
    button {
      background: #00b4d8; color: white; border: none;
      padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;
    }
    button:hover { background: #0096c7; }
    .log-box { background: #111; padding: 0.5rem; height: 150px; overflow-y: auto; font-size: 0.85rem; }
    .forecast-card, .alert-card {
      background: #1a1f36; padding: 0.7rem; margin: 0.5rem 0; border-radius: 5px;
    }
    .forecast-card span { font-weight: bold; }
    .status-premier { color: #00ff00; }
    .status-deja { color: #ffcc00; }
    .status-doublon { color: #ff4d4d; }
  </style>
</head>
<body>
  <header>
    <h1>âš¡ Centrale NuclÃ©aire MÃ©tÃ©o â€“ Console Admin</h1>
  </header>

  <!-- ğŸ”´ SuperForecast -->
  <section>
    <h2>ğŸš€ SuperForecast</h2>
    <button onclick="runSuperForecast()">â–¶ Lancer Run</button>
    <div id="analysis"></div>
  </section>

  <!-- ğŸŒ PrÃ©visions nationales -->
  <section>
    <h2>ğŸ“¡ PrÃ©visions nationales</h2>
    <div id="forecasts">â³ Chargementâ€¦</div>
  </section>

  <!-- âš ï¸ Alertes -->
  <section>
    <h2>âš ï¸ Alertes</h2>
    <div id="alerts">â³ Chargementâ€¦</div>
  </section>

  <!-- ğŸ’¬ Chat IA J.E.A.N. -->
  <section>
    <h2>ğŸ’¬ Chat J.E.A.N.</h2>
    <textarea id="chatInput" placeholder="Posez une question Ã  J.E.A.N."></textarea>
    <button onclick="askJEAN()">Envoyer</button>
    <div id="chatReply"></div>
  </section>

  <!-- ğŸ“œ Logs -->
  <section>
    <h2>ğŸ“œ Logs</h2>
    <div id="logs" class="log-box">â³ Chargementâ€¦</div>
  </section>

  <!-- ğŸ‘¥ Utilisateurs -->
  <section>
    <h2>ğŸ‘¥ Utilisateurs</h2>
    <div id="users">â³ Chargementâ€¦</div>
  </section>

  <!-- ğŸŒ Outils de veille -->
  <section>
    <h2>ğŸŒ Outils de veille</h2>
    <ul>
      <li><a href="https://www.noaa.gov/" target="_blank">NOAA (USA)</a></li>
      <li><a href="https://climate.copernicus.eu/" target="_blank">Copernicus (Europe)</a></li>
      <li><a href="https://www.meteo.be/" target="_blank">IRM (Belgique)</a></li>
      <li><a href="https://meteofrance.com/" target="_blank">MÃ©tÃ©o France</a></li>
      <li><a href="https://www.nasa.gov/" target="_blank">NASA</a></li>
    </ul>
  </section>

  <script>
    async function runSuperForecast() {
      const res = await fetch("/api/superforecast", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ forecastData: {} }) // âš ï¸ brancher avec fusion rÃ©elle
      });
      const data = await res.json();
      document.getElementById("analysis").innerText = data.analysis || "âš ï¸ Analyse indisponible";
      loadForecasts();
      loadAlerts();
    }

    async function loadForecasts() {
      const countries = ["BE", "FR", "LU", "USA", "UK", "UA"];
      let html = "";
      for (const cc of countries) {
        const res = await fetch(`/api/forecast/${cc}`);
        const data = await res.json();
        if (data && data.length > 0) {
          data.forEach(f => {
            html += `<div class="forecast-card">
              <span>${f.country}</span> (${f.date}) :
              ${f.minTemp ?? "-"}Â°C / ${f.maxTemp ?? "-"}Â°C â€“
              ${f.summary ?? "Pas de rÃ©sumÃ©"} ${f.icon ?? ""}
            </div>`;
          });
        }
      }
      document.getElementById("forecasts").innerHTML = html || "Aucune prÃ©vision disponible.";
    }

    async function loadAlerts() {
      const res = await fetch("/api/alerts");
      const data = await res.json();
      let html = "";
      data.forEach(a => {
        let statusClass =
          a.status?.includes("Premier") ? "status-premier" :
          a.status?.includes("DÃ©jÃ ") ? "status-deja" :
          "status-doublon";
        html += `<div class="alert-card">
          <span>${a.title}</span> â€“ ${a.region} [${a.level.toUpperCase()}]
          <br/>${a.description}
          <br/>ProbabilitÃ©: ${a.probability}% â€“ 
          <span class="${statusClass}">${a.status ?? "?"}</span>
        </div>`;
      });
      document.getElementById("alerts").innerHTML = html || "Aucune alerte active.";
    }

    async function askJEAN() {
      const msg = document.getElementById("chatInput").value;
      const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
      });
      const data = await res.json();
      document.getElementById("chatReply").innerText = data.reply || "âš ï¸ Pas de rÃ©ponse";
    }

    async function loadLogs() {
      const res = await fetch("/api/admin/logs"); // âš ï¸ API Ã  crÃ©er cÃ´tÃ© backend
      const data = await res.json();
      document.getElementById("logs").innerText = data.join("\n");
    }

    async function loadUsers() {
      const res = await fetch("/api/admin/users"); // âš ï¸ API Ã  crÃ©er cÃ´tÃ© backend
      const data = await res.json();
      let html = "";
      data.forEach(u => {
        html += `<div>${u.type} â€“ ${u.zone} (${u.count} utilisateurs)</div>`;
      });
      document.getElementById("users").innerHTML = html || "Aucun utilisateur trouvÃ©.";
    }

    // Auto-load au dÃ©marrage
    loadForecasts();
    loadAlerts();
    loadLogs();
    loadUsers();
  </script>
</body>
</html>
