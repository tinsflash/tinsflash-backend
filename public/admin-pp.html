<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>🛰️ Console Admin TINSFLASH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="style.css">

  <!-- Weather Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">

  <style>
    body {
      font-family: "Orbitron", sans-serif;
      background: radial-gradient(circle at center, #000010, #000000);
      color: #00ffea;
      margin: 0;
      padding: 0;
    }
    h1, h2 { text-align: center; color: #00eaff; }
    .container { padding: 20px; max-width: 1200px; margin: auto; }
    .card {
      background: rgba(20, 20, 40, 0.9);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid #00ffea;
      box-shadow: 0 0 15px rgba(0, 255, 234, 0.4);
    }
    .btn {
      padding: 10px 15px;
      margin: 5px;
      background: #00ffea;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn:hover { background: #00c9c9; }
    textarea, input, select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border-radius: 6px;
      border: none;
    }
    #logs {
      background: #000;
      color: #0f0;
      font-family: monospace;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      border-radius: 8px;
    }
    .forecast-grid {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .day-card {
      flex: 1 1 150px;
      text-align: center;
      background: rgba(0, 255, 234, 0.05);
      border: 1px solid #00ffea;
      border-radius: 10px;
      padding: 10px;
    }
    .day-card i {
      font-size: 2rem;
      margin-bottom: 8px;
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #00ffea;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    footer {
      text-align: center;
      padding: 10px;
      border-top: 1px solid #00ffea;
      margin-top: 20px;
      font-size: 0.9rem;
      color: #00eaff;
    }
  </style>
</head>
<body>
  <h1>🛰️ Console Admin – TINSFLASH</h1>
  <div class="container">

    <!-- Supercalculateur -->
    <div class="card">
      <h2>⚡ Supercalculateur Météo</h2>
      <button class="btn" onclick="runForecast('morning')">🌅 Run 07h10</button>
      <button class="btn" onclick="runForecast('noon')">☀️ Run 12h10</button>
      <button class="btn" onclick="runForecast('evening')">🌙 Run 19h10</button>
      <div id="forecast-status">⏳ En attente de lancement...</div>
    </div>

    <!-- Logs & Alertes -->
    <div class="card">
      <h2>📡 Monitoring</h2>
      <button class="btn" onclick="loadLogs()">📖 Voir Logs</button>
      <button class="btn" onclick="loadAlerts()">⚠️ Voir Alertes</button>
      <div id="logs">⏳ Logs en attente...</div>
    </div>

    <!-- Prévisions nationales BE & FR -->
    <div class="card">
      <h2>🇧🇪🇫🇷 Prévisions Nationales (BE / FR)</h2>
      <div id="forecast-national" class="forecast-grid">⏳ Chargement...</div>
      <pre id="forecast-text">⏳ Génération bulletin météo national...</pre>
    </div>

    <!-- Statistiques utilisateurs -->
    <div class="card">
      <h2>👥 Statistiques Utilisateurs</h2>
      <div id="user-stats">⏳ Chargement statistiques...</div>
    </div>

    <!-- Chat IA -->
    <div class="card">
      <h2>🤖 IA J.E.A.N</h2>
      <textarea id="ai-input" rows="3" placeholder="Posez une question..."></textarea>
      <button class="btn" onclick="chatJean()">Envoyer</button>
      <div id="ai-response">⏳ En attente...</div>
    </div>
  </div>

  <footer>
    🚀 Console Admin TINSFLASH – Mode NASA
  </footer>

  <script>
    const API_BASE = "https://tinsflash-backend.onrender.com/api";

    // Supercalculateur
    async function runForecast(time) {
      document.getElementById("forecast-status").innerText = "⏳ Calcul en cours...";
      try {
        const res = await fetch(`${API_BASE}/forecast/national?country=BE`);
        const data = await res.json();
        document.getElementById("forecast-status").innerText =
          `✅ Run ${time} terminé : ${data.combined.temperature}°C, Fiabilité ${data.combined.reliability}%`;
      } catch (err) {
        document.getElementById("forecast-status").innerText = "❌ Erreur lancement forecast";
      }
    }

    // Logs
    async function loadLogs() {
      document.getElementById("logs").innerText = "⏳ Chargement logs...";
      try {
        const res = await fetch(`${API_BASE}/logs`);
        const data = await res.json();
        document.getElementById("logs").innerText = data.join("\\n");
      } catch {
        document.getElementById("logs").innerText = "❌ Erreur logs";
      }
    }

    // Alertes
    async function loadAlerts() {
      document.getElementById("logs").innerText = "⏳ Chargement alertes...";
      try {
        const res = await fetch(`${API_BASE}/alerts`);
        const data = await res.json();
        document.getElementById("logs").innerText =
          data.map(a => `⚠️ ${a.level} - ${a.message}`).join("\\n");
      } catch {
        document.getElementById("logs").innerText = "❌ Erreur alertes";
      }
    }

    // Prévisions nationales BE/FR
    async function loadNationalForecasts() {
      const container = document.getElementById("forecast-national");
      container.innerHTML = "⏳ Chargement...";
      try {
        const beRes = await fetch(`${API_BASE}/forecast/national?country=BE`);
        const frRes = await fetch(`${API_BASE}/forecast/national?country=FR`);
        const beData = await beRes.json();
        const frData = await frRes.json();

        container.innerHTML = `
          <div class="day-card"><i class="wi wi-day-sunny"></i><p>BE: ${beData.combined.description}, ${beData.combined.temperature}°C</p></div>
          <div class="day-card"><i class="wi wi-cloudy"></i><p>FR: ${frData.combined.description}, ${frData.combined.temperature}°C</p></div>
        `;
        document.getElementById("forecast-text").innerText =
          "🇧🇪 Bulletin BE: " + beData.combined.text + "\\n🇫🇷 Bulletin FR: " + frData.combined.text;
      } catch {
        container.innerHTML = "❌ Erreur chargement prévisions nationales";
      }
    }

    // Stats utilisateurs
    async function loadUserStats() {
      document.getElementById("user-stats").innerText = "⏳ Chargement...";
      try {
        const res = await fetch(`${API_BASE}/users/stats`);
        const data = await res.json();
        document.getElementById("user-stats").innerHTML = `
          <table>
            <tr><th>Type</th><th>Nombre</th></tr>
            <tr><td>Gratuit</td><td>${data.free}</td></tr>
            <tr><td>Premium</td><td>${data.premium}</td></tr>
            <tr><td>Pro</td><td>${data.pro}</td></tr>
            <tr><td>Pro+</td><td>${data.proplus}</td></tr>
            <tr><td>Zones couvertes</td><td>${data.covered}</td></tr>
            <tr><td>Zones non couvertes</td><td>${data.uncovered}</td></tr>
          </table>
        `;
      } catch {
        document.getElementById("user-stats").innerText = "❌ Erreur stats";
      }
    }

    // Chat IA
    async function chatJean() {
      const input = document.getElementById("ai-input").value;
      document.getElementById("ai-response").innerText = "⏳ Analyse...";
      try {
        const res = await fetch(`${API_BASE}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: input })
        });
        const data = await res.json();
        document.getElementById("ai-response").innerText = data.reply;
      } catch {
        document.getElementById("ai-response").innerText = "❌ Erreur IA";
      }
    }

    // Auto load
    window.onload = () => {
      loadNationalForecasts();
      loadUserStats();
    };
  </script>
</body>
</html>
