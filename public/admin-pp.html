<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>🛰️ TINSFLASH PRO+++ – Console IA J.E.A.N.</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body{margin:0;font-family:"Segoe UI",system-ui;background:#0b1220;color:#e6f6ff}
header{padding:12px;text-align:center;background:#08121d;color:#4fc3f7;font-weight:700;font-size:1.3em}
nav.menu{display:flex;justify-content:center;flex-wrap:wrap;gap:14px;padding:10px;background:#0d1624;border-bottom:1px solid #1e293b}
nav.menu a{color:#4fc3f7;text-decoration:none;font-weight:600}
nav.menu a:hover{color:#fff;text-shadow:0 0 8px #4fc3f7}
nav#controls{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;padding:8px;background:#0d1624}
button{background:#1b2b44;color:#4fc3f7;border:1px solid #4fc3f7;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600}
button:hover{background:#4fc3f7;color:#0b1220}
.cmd{font-size:12px;color:#8ab4f8;margin-top:4px;text-align:center}
.map{height:380px;margin:15px;border-radius:8px}
#logs{background:#0d1624;color:#b3e5fc;padding:10px;height:220px;overflow-y:auto;border-top:1px solid #1e293b;font-family:monospace}
footer{text-align:center;padding:8px;font-size:13px;color:#7dd3fc;background:#08121d}
</style>
</head>
<body>

<script>
const PIN_ADMIN="202679";
if(!sessionStorage.getItem("tinsflashPIN")){
 const p=prompt("Code d’accès admin ?");
 if(p!==PIN_ADMIN){alert("Accès refusé");location.href="/";}
 else sessionStorage.setItem("tinsflashPIN","ok");
}
</script>

<header>🛰️ TINSFLASH PRO+++ – Centrale IA J.E.A.N.</header>

<!-- ===================== MENU CONNECTÉ ===================== -->
<nav class="menu">
<a href="/admin-pp.html">🧠 Console</a>
<a href="/admin-alerts.html">🚨 Alertes</a>
<a href="/admin-radar.html">🗺️ Radar</a>
<a href="/admin-news.html">📰 News</a>
<a href="/admin-chat.html">💬 Chat</a>
<a href="/admin-local.html">📍 Local</a>
<a href="/admin-users.html">👥 Utilisateurs</a>
<a href="/provincenamur.html">🏛️ Province de Namur</a>
<a href="/protest.html">📢 Protest</a>
<a href="/">🏠 Index</a>
</nav>

<!-- ===================== BOUTONS DE RUN ===================== -->
<nav id="controls">
<button onclick="run('/api/run-global-europe')">🇪🇺 Europe</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-europe</div>

<button onclick="run('/api/run-global-usa')">🇺🇸 USA</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-usa</div>

<button onclick="run('/api/run-global-afrique')">🌍 Afrique</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-afrique</div>

<button onclick="run('/api/run-global-asie')">🌏 Asie</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-asie</div>

<button onclick="run('/api/run-global-ameriquesud')">🌎 Amérique du Sud</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-ameriquesud</div>

<button onclick="run('/api/run-global-oceanie')">🌊 Océanie</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-oceanie</div>

<button onclick="run('/api/run-global-canada')">🍁 Canada</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-canada</div>

<button onclick="run('/api/run-global-caribbean')">🏝️ Caraïbes</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-global-caribbean</div>

<button onclick="run('/api/run-belgique')">🇧🇪 Belgique</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-belgique</div>

<button onclick="run('/api/run-bouke')">📍 Bouke (local)</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/run-bouke</div>

<hr style="width:100%;border:0;border-top:1px solid #1e293b;margin:10px 0"/>

<button onclick="run('/api/runAIAnalysis')">🧠 Phase 2 – IA J.E.A.N.</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/runAIAnalysis</div>

<button onclick="run('/api/runWorldAlerts')">🚨 Phase 5 – Fusion mondiale alertes</button>
<div class="cmd">curl -X POST https://tinsflash.onrender.com/api/runWorldAlerts</div>
</nav>

<!-- ===================== CARTES ===================== -->
<h3 style="text-align:center;color:#7dd3fc">🗺️ Carte Prévisions IA J.E.A.N.</h3>
<div class="map" id="mapForecast"></div>

<h3 style="text-align:center;color:#7dd3fc">🚨 Carte Alertes Actives</h3>
<div class="map" id="mapAlerts"></div>

<!-- ===================== LOGS ===================== -->
<h3 style="text-align:center;color:#7dd3fc">🧾 Journal du moteur (live)</h3>
<div id="logs">[Démarrage du flux de logs...]</div>

<footer>© 2025 TINSFLASH PRO+++ – IA J.E.A.N. | Actualisation auto : 2 min</footer>

<script>
async function run(route){
 try{
  const r=await fetch(route,{method:"POST"});
  const j=await r.json();
  log(`▶️ ${route} → ${JSON.stringify(j)}`);
 }catch(e){log(`❌ ${route} → ${e.message}`);}
}

function log(msg){
 const logs=document.getElementById("logs");
 const line=document.createElement("div");
 line.textContent=`${new Date().toLocaleTimeString()} ${msg}`;
 logs.appendChild(line);
 logs.scrollTop=logs.scrollHeight;
}

// ===================== MAP FORECAST =====================
const map1=L.map("mapForecast").setView([20,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:6,minZoom:2}).addTo(map1);

// ===================== MAP ALERTS =====================
const map2=L.map("mapAlerts").setView([20,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:6,minZoom:2}).addTo(map2);

async function refreshMaps(){
 try{
  const f=await fetch("/api/forecast");const fj=await f.json();
  L.circleMarker([fj.lat,fj.lon],{radius:6,color:"cyan",fillOpacity:0.6})
   .addTo(map1).bindPopup(`🌤️ ${fj.condition}<br>${fj.temperature}°C`);
 }catch(e){log("Forecast map error "+e.message);}

 try{
  const r=await fetch("/api/alerts");const data=await r.json();
  map2.eachLayer(l=>{if(l instanceof L.CircleMarker) map2.removeLayer(l);});
  data.forEach(a=>{
    if(!a.lat||!a.lon) return;
    let color="gray";
    const conf=a.reliability||a.confidence||0;
    if(a.isPrimeur) color="blue"; else if(conf>=0.9) color="green";
    else if(conf>=0.7) color="orange"; else color="red";
    L.circleMarker([a.lat,a.lon],{radius:6,color,fillOpacity:0.6})
     .addTo(map2)
     .bindPopup(`<b>${a.title||a.event||"Alerte"}</b><br>${(conf*100).toFixed(0)}%`);
  });
 }catch(e){log("Alerts map error "+e.message);}
}
refreshMaps();
setInterval(refreshMaps,120000);

// ===================== LOGS SSE =====================
const evt=new EventSource("/api/logs");
evt.onmessage=e=>{const d=JSON.parse(e.data);log(d.message);}
</script>
</body>
</html>
