<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ğŸ›°ï¸ Console IA J.E.A.N. â€“ TINSFLASH PRO+++</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body{margin:0;background:#0b1220;color:#e6f6ff;font-family:"Segoe UI",sans-serif;}
header{background:#08121d;color:#4fc3f7;text-align:center;padding:10px;font-size:1.4em;text-shadow:0 0 10px #4fc3f7;}
nav{display:flex;justify-content:center;gap:12px;padding:10px;background:#0d1624;}
nav a{color:#7dd3fc;text-decoration:none;font-weight:bold;}
nav a:hover{color:#fff;text-shadow:0 0 10px #4fc3f7;}
.container{max-width:1250px;margin:auto;padding:15px;}
h2{color:#4fc3f7;margin-top:25px;border-left:4px solid #4fc3f7;padding-left:8px;}
button{background:#4fc3f7;color:#001;border:none;padding:10px 16px;margin:4px;border-radius:8px;font-weight:bold;cursor:pointer;}
button:hover{background:#7dd3fc;}
.status-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
.status-box{flex:1 1 180px;background:#101c2b;padding:10px;border-radius:8px;text-align:center;}
.status-light{width:14px;height:14px;border-radius:50%;display:inline-block;margin-right:6px;}
.green{background:#00ff88;} .red{background:#ff4444;} .orange{background:#ffaa00;} .blue{background:#4fc3f7;}
.map-duo{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:15px;}
.map{height:340px;border-radius:10px;overflow:hidden;}
.alert-counters{display:flex;justify-content:space-around;margin-top:15px;flex-wrap:wrap;}
.counter{background:#13233d;padding:10px 16px;border-radius:10px;text-align:center;min-width:150px;
box-shadow:0 0 10px rgba(0,0,0,0.3);} .counter h3{margin:0;color:#4fc3f7;}
#logs{background:#0e1721;padding:10px;border-radius:10px;height:200px;overflow-y:auto;
font-family:monospace;font-size:13px;margin-top:10px;}
.btn-ai{position:fixed;bottom:25px;right:25px;background:#4fc3f7;color:#000;font-weight:bold;
border:none;border-radius:50%;width:52px;height:52px;cursor:pointer;
box-shadow:0 0 15px rgba(79,195,247,0.6);font-size:18px;transition:transform .3s ease;z-index:999;}
.chat-box{position:fixed;bottom:90px;right:20px;background:#1b2439;border:2px solid #4fc3f7;border-radius:12px;
width:320px;height:400px;display:none;flex-direction:column;box-shadow:0 0 15px rgba(0,0,0,0.5);z-index:999;}
.chat-header{background:#4fc3f7;color:#000;text-align:center;padding:6px;font-weight:bold;}
.chat-messages{flex:1;padding:8px;overflow-y:auto;font-size:14px;background:#0e1423;}
.chat-input{display:flex;border-top:1px solid #333;}
.chat-input input{flex:1;padding:8px;border:none;background:#1b2339;color:#eee;}
.chat-input button{background:#4fc3f7;border:none;color:#000;padding:8px 12px;font-weight:bold;cursor:pointer;}
code{background:#0e1721;padding:3px 6px;border-radius:6px;color:#7dd3fc;display:block;margin:4px 0;}
</style>
</head>
<body>

<script>
if(!sessionStorage.getItem("tinsflashPIN")){
 const p=prompt("Code dâ€™accÃ¨s admin ?");
 if(p!=="202679"){alert("AccÃ¨s refusÃ©");location.href="/";}
 else sessionStorage.setItem("tinsflashPIN","ok");
}
</script>

<header>ğŸ›°ï¸ Console IA J.E.A.N â€“ TINSFLASH PRO+++</header>
<nav>
<a href="/admin-pp.html">Dashboard</a>
<a href="/admin-alerts.html">Alertes</a>
<a href="/admin-chat.html">Chat</a>
<a href="/admin-radar.html">Radar</a>
<a href="/admin-index.html">Index</a>
</nav>

<div class="container">
<h2>âš™ï¸ Phase 1 : Extraction pure et rÃ©elle</h2>
<button onclick="runEuropeUSA()">âš¡ Extraction Europeâ€“USAâ€“Canada</button>
<button onclick="runWorld()">ğŸŒ Extraction Reste du Monde</button>
<button onclick="runAll()">ğŸŒ Extraction PlanÃ¨te complÃ¨te</button>

<p style="color:#7dd3fc;font-size:0.9em;">
ğŸ’» Commandes Render manuelles :<br>
<code>curl -X POST https://tinsflash.onrender.com/api/run-global</code>
<code>curl -X POST https://tinsflash.onrender.com/api/run-world</code>
<code>curl -X POST https://tinsflash.onrender.com/api/run-all</code>
</p>

<h2>ğŸ§  Phase 2 : Analyse IA J.E.A.N.</h2>
<button onclick="runAIJean()">ğŸ¤– Lancer IA J.E.A.N. (Phase 2)</button>
<p style="color:#7dd3fc;font-size:0.9em;">
<code>curl -X POST https://tinsflash.onrender.com/api/ai-analyse</code>
</p>

<h3 style="color:#4fc3f7;">ğŸ§© ModÃ¨les IA externes (Hugging Face)</h3>
<div class="status-grid">
  <div class="status-box"><span class="status-light blue" id="light-graphcast"></span>GraphCast â€“ <b id="lat-graphcast">â€“</b>s</div>
  <div class="status-box"><span class="status-light blue" id="light-pangu"></span>Pangu â€“ <b id="lat-pangu">â€“</b>s</div>
  <div class="status-box"><span class="status-light blue" id="light-corrdiff"></span>CorrDiff â€“ <b id="lat-corrdiff">â€“</b>s</div>
  <div class="status-box"><span class="status-light blue" id="light-nowcastnet"></span>NowcastNet â€“ <b id="lat-nowcastnet">â€“</b>s</div>
</div>

<h2>ğŸ“¢ Phase 3 : Fusion des alertes mondiales</h2>
<button onclick="runAlerts()">ğŸš¨ Fusion des alertes (Phase 3)</button>
<p style="color:#7dd3fc;font-size:0.9em;">
<code>curl -X POST https://tinsflash.onrender.com/api/runWorldAlerts</code>
</p>

<h2>ğŸ§© Ã‰tat moteur</h2>
<div class="status-grid">
  <div class="status-box"><span id="motorLight" class="status-light"></span>Moteur : <b id="motorStatus">â€“</b></div>
  <div class="status-box"><span id="mongoLight" class="status-light"></span>MongoDB</div>
  <div class="status-box"><span id="aiLight" class="status-light blue"></span>IA J.E.A.N : <b id="aiStatus">VÃ©rification...</b></div>
</div>

<h2>ğŸŒ Cartes de suivi</h2>
<div class="map-duo">
  <div id="mapForecast" class="map"></div>
  <div id="mapAlerts" class="map"></div>
</div>

<div class="alert-counters">
  <div class="counter"><h3 id="count90">0</h3><div>ğŸŸ¢ &gt; 90 %</div></div>
  <div class="counter"><h3 id="count7089">0</h3><div>ğŸŸ  70â€“89 %</div></div>
  <div class="counter"><h3 id="count70">0</h3><div>ğŸ”´ &lt; 70 %</div></div>
  <div class="counter"><h3 id="countPrimeurs">0</h3><div>ğŸ”µ Primeurs</div></div>
</div>

<h2>ğŸ“œ Logs moteur</h2>
<div id="logs">Chargement...</div>
</div>

<!-- Chat IA -->
<button class="btn-ai" id="btnAI">ğŸ¤–</button>
<div class="chat-box" id="chatJean">
  <div class="chat-header">Assistant Technique (GPT-4o-mini)</div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="chat-input">
    <input id="chatInput" placeholder="Question technique..."/><button onclick="sendChat()">Envoyer</button>
  </div>
</div>

<script>
const API="/api";
const mapF=L.map("mapForecast").setView([20,0],2);
const mapA=L.map("mapAlerts").setView([20,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapF);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapA);
let forecastLayer=L.layerGroup().addTo(mapF);

// === PHASE 1 ===
async function runEuropeUSA(){execute("/api/run-global","Extraction Europeâ€“USAâ€“Canada");}
async function runWorld(){execute("/api/run-world","Extraction Reste du Monde");}
async function runAll(){execute("/api/run-all","Extraction PlanÃ¨te complÃ¨te");}

// === PHASE 2 ===
async function runAIJean(){execute("/api/ai-analyse","Analyse IA J.E.A.N.");}

// === PHASE 3 ===
async function runAlerts(){execute("/api/runWorldAlerts","Fusion des alertes mondiales");}

// === EXEC GÃ‰NÃ‰RIQUE ===
async function execute(endpoint,label){
  addLog(`ğŸš€ ${label} en cours...`);
  try{
    const r=await fetch(endpoint,{method:"POST"});
    const j=await r.json();
    addLog(j.success?`âœ… ${label} terminÃ©e`:`âŒ ${label} : ${j.error}`);
  }catch(e){addLog(`âš ï¸ ${label} : ${e.message}`);}
}

// === STATUTS ===
async function refreshStatus(){
  try{
    const r=await fetch("/api/status");
    const s=await r.json();
    document.getElementById("motorStatus").textContent=s.status||"â€“";
    document.getElementById("motorLight").className="status-light "+(s.status==="running"?"green":"red");
    document.getElementById("mongoLight").className="status-light "+(s.db==="connected"?"green":"red");
  }catch(e){addLog("âš ï¸ Status "+e.message);}
}
setInterval(refreshStatus,10000);
refreshStatus();

// === IA ===
async function checkAI(){
  try{
    const r=await fetch("/api/ai-health");
    const d=await r.json();
    const light=document.getElementById("aiLight");
    const text=document.getElementById("aiStatus");
    if(d.status==="ok"){light.className="status-light green";text.textContent="OpÃ©rationnelle";}
    else if(d.status==="warning"){light.className="status-light orange";text.textContent="Instable";}
    else{light.className="status-light red";text.textContent="Erreur";}
    // IA externes
    ["graphcast","pangu","corrdiff","nowcastnet"].forEach(m=>{
      const info=d[m]||{};const l=document.getElementById("light-"+m);const t=document.getElementById("lat-"+m);
      t.textContent=info.latency?info.latency.toFixed(2):"â€“";
      l.className="status-light "+(info.status==="online"?"green":info.status==="offline"?"red":"orange");
    });
  }catch(e){
    document.getElementById("aiLight").className="status-light red";
    document.getElementById("aiStatus").textContent="Erreur rÃ©seau";
  }
}
setInterval(checkAI,15000);
checkAI();

// === CARTES ===
async function loadForecast(){
  try{
    const r=await fetch(`${API}/forecast?lat=50&lon=4&country=BE`);
    const data=await r.json();
    forecastLayer.clearLayers();
    if(data && data.sources){
      const color=data.reliability>0.9?"green":data.reliability>0.7?"orange":"red";
      L.circleMarker([50,4],{radius:8,color}).addTo(forecastLayer)
      .bindPopup(`<b>PrÃ©vision Belgique</b><br>
        ğŸŒ¡ï¸ ${data.temperature?.toFixed(1)}Â°C<br>
        ğŸ’§ ${data.precipitation?.toFixed(1)} mm<br>
        ğŸŒ¬ï¸ ${data.wind?.toFixed(1)} km/h<br>
        ğŸ”— ${data.sources.join(", ")}<br>
        ğŸ§  FiabilitÃ©: ${(data.reliability*100).toFixed(0)}%`);
    }
  }catch(e){addLog("âš ï¸ Forecast "+e.message);}
}
setInterval(loadForecast,60000);
loadForecast();

// === ALERTES ===
async function loadAlerts(){
  const r=await fetch(API+"/alerts");
  const list=await r.json();
  let c90=0,c7089=0,c70=0,cP=0;
  list.forEach(a=>{
    if(!a.lat)return;
    let color="red";
    if(a.reliability>=0.9){color="green";c90++;}
    else if(a.reliability>=0.7){color="orange";c7089++;}
    else{c70++;}
    if(a.isPrimeur){cP++;color="blue";}
    L.circleMarker([a.lat,a.lon],{radius:6,color}).addTo(mapA).bindPopup(`<b>${a.title}</b><br>${a.zone}`);
  });
  document.getElementById("count90").textContent=c90;
  document.getElementById("count7089").textContent=c7089;
  document.getElementById("count70").textContent=c70;
  document.getElementById("countPrimeurs").textContent=cP;
}
loadAlerts();

// === LOGS ===
function addLog(t){
  const l=document.getElementById("logs");
  l.innerHTML+=`<div>${new Date().toLocaleTimeString()} ${t}</div>`;
  l.scrollTop=l.scrollHeight;
}

// === CHAT ===
const chatBox=document.getElementById("chatJean");
document.getElementById("btnAI").onclick=()=>chatBox.style.display=chatBox.style.display==="flex"?"none":"flex";
async function sendChat(){
  const msg=document.getElementById("chatInput").value;if(!msg)return;
  const m=document.getElementById("chatMessages");
  m.innerHTML+=`<div style='color:#4fc3f7;'>Vous : ${msg}</div>`;
  const r=await fetch(API+"/chat-tech",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:msg})});
  const d=await r.json();
  m.innerHTML+=`<div>J.E.A.N : ${d.reply}</div>`;m.scrollTop=m.scrollHeight;
}
</script>
</body>
</html>
