<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>‚ö° Centrale Nucl√©aire M√©t√©o - Admin</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; padding:20px; }
    h1,h2,h3 { color:#00ffcc; }
    input,select,button,textarea {
      padding:8px; margin:5px; border-radius:6px; border:1px solid #444;
    }
    button { background:#00ffcc; color:#111; font-weight:bold; cursor:pointer; }
    pre { background:#222; padding:10px; border-radius:6px; overflow-x:auto; }
    #forecastResult { margin-top:20px; }
    #chatBox { background:#222; padding:10px; border-radius:6px; margin-top:20px; }
  </style>
</head>
<body>
  <h1>‚ö° Centrale Nucl√©aire M√©t√©o - Cockpit Admin</h1>

  <!-- üîé Recherche ville + pays -->
  <div class="city-search">
    <h2>üåç Rechercher une localit√© (zones couvertes)</h2>
    <input type="text" id="cityInput" placeholder="Ville (ex: Marseille)" />
    
    <select id="countrySelect">
      <option value="FR">France</option>
      <option value="BE">Belgique</option>
      <option value="DE">Allemagne</option>
      <option value="UK">Royaume-Uni</option>
      <option value="NO">Norv√®ge</option>
      <option value="UA">Ukraine</option>
      <option value="US">√âtats-Unis</option>
      <!-- tu peux ajouter les 27 pays ici -->
    </select>
    
    <button onclick="searchCity()">üîé Voir pr√©visions</button>
  </div>

  <div id="forecastResult"></div>

  <!-- ü§ñ Chat IA moteur -->
  <div id="chatBox">
    <h2>ü§ñ Chat IA - Moteur m√©t√©o nucl√©aire</h2>
    <textarea id="chatInput" rows="3" placeholder="Posez une question (ex: 'Quel temps demain √† Marseille ?')"></textarea>
    <br>
    <button onclick="sendChat()">Envoyer</button>
    <div id="chatResponse"></div>
  </div>

  <script>
  async function searchCity() {
    const city = document.getElementById("cityInput").value;
    const country = document.getElementById("countrySelect").value;

    // üåç G√©olocalisation via Nominatim (limit√© au pays s√©lectionn√©)
    const geoRes = await fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=${country.toLowerCase()}&q=${encodeURIComponent(city)}`);
    const geoData = await geoRes.json();

    if (!geoData.length) {
      document.getElementById("forecastResult").innerHTML = "‚ùå Ville introuvable.";
      return;
    }

    const { lat, lon, display_name } = geoData[0];

    // üîó Appel moteur nucl√©aire m√©t√©o
    const forecastRes = await fetch(`/api/localforecast/${lat}/${lon}/${country}`);
    const forecast = await forecastRes.json();

    document.getElementById("forecastResult").innerHTML = `
      <h3>üìç ${display_name}</h3>
      <pre>${JSON.stringify(forecast.forecast, null, 2)}</pre>
    `;
  }

  async function sendChat() {
    const msg = document.getElementById("chatInput").value;
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    document.getElementById("chatResponse").innerHTML = `<pre>${data.reply}</pre>`;
  }
  </script>
</body>
</html>
