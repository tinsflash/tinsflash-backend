<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>⚡ Centrale Nucléaire Météo – Admin</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>⚡ Console Admin Tinsflash</h1>
  </header>

  <!-- Bouton Run unique -->
  <section>
    <h2>🚀 SuperForecast</h2>
    <button onclick="runSuperForecast()">Lancer Run</button>
    <div id="superforecast-result">En attente…</div>
  </section>

  <!-- Prévisions -->
  <section>
    <h2>🛰️ Prévisions nationales</h2>
    <div id="forecasts">⏳ Chargement…</div>
  </section>

  <!-- Alertes -->
  <section>
    <h2>⚠️ Alertes</h2>
    <div id="alerts">⏳ Chargement…</div>
  </section>

  <!-- Chat -->
  <section>
    <h2>🤖 J.E.A.N.</h2>
    <input id="chat-input" placeholder="Pose ta question…" style="width:70%;"/>
    <button onclick="sendChat()">Envoyer</button>
    <div id="chat-reply"></div>
  </section>

  <!-- Logs -->
  <section>
    <h2>📜 Logs</h2>
    <div id="logs">⏳ Chargement…</div>
  </section>

<script>
const API = "";

// === SuperForecast ===
async function runSuperForecast() {
  document.getElementById("superforecast-result").innerText = "⏳ Lancement…";
  try {
    const res = await fetch(`${API}/api/superforecast/run`, { method:"POST" });
    const data = await res.json();
    document.getElementById("superforecast-result").innerText = data.analysis || "✅ Run terminé";
    loadForecasts();
    loadLogs();
  } catch (err) {
    document.getElementById("superforecast-result").innerText = "❌ Erreur: " + err.message;
  }
}

// === Forecasts ===
async function loadForecasts() {
  const box = document.getElementById("forecasts");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const forecasts = await res.json();
    if (!forecasts.length) { box.innerHTML = "Aucune donnée."; return; }
    box.innerHTML = forecasts.map(f => `
      <div>
        <b>${f.country}</b> (${f.date}) 🌡️ ${f.minTemp}–${f.maxTemp}°C ☔ ${f.rainProbability || 0}%
      </div>`).join("");
  } catch (err) { box.innerHTML = "❌ Erreur: " + err.message; }
}

// === Alertes ===
async function loadAlerts() {
  const box = document.getElementById("alerts");
  try {
    const res = await fetch(`${API}/api/alerts`);
    const alerts = await res.json();
    if (!alerts.length) { box.innerHTML = "Aucune alerte."; return; }
    box.innerHTML = alerts.map(a => `
      <div>
        <b>${a.title || "Alerte"}</b> (${a.certainty}%) → ${a.status}<br/>
        ${a.description}<br/>
      </div>`).join("");
  } catch (err) { box.innerHTML = "❌ Erreur: " + err.message; }
}

// === Chat ===
async function sendChat() {
  const q = document.getElementById("chat-input").value;
  const reply = document.getElementById("chat-reply");
  reply.innerText = "⏳ J.E.A.N. réfléchit…";
  try {
    const res = await fetch(`${API}/api/chat`, { 
      method:"POST", headers:{ "Content-Type":"application/json" }, 
      body:JSON.stringify({ message:q })
    });
    const data = await res.json();
    reply.innerText = data.reply || "❌ Pas de réponse";
  } catch (err) { reply.innerText = "❌ Erreur: " + err.message; }
}

// === Logs ===
async function loadLogs() {
  const box = document.getElementById("logs");
  try {
    const res = await fetch(`${API}/api/logs`);
    const logs = await res.json();
    box.innerHTML = logs.map(l => `<div>[${l.timestamp}] ${l.message}</div>`).join("");
  } catch (err) { box.innerHTML = "❌ Erreur: " + err.message; }
}

setInterval(loadLogs, 10000);
loadForecasts(); loadAlerts(); loadLogs();
</script>
</body>
</html>
