<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Centrale NuclÃ©aire MÃ©tÃ©o â€“ Admin</title>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      margin: 0;
      padding: 0;
    }
    h1, h2 {
      text-align: center;
      color: cyan;
    }
    .section {
      background: #111;
      margin: 15px;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px #0ff;
    }
    button {
      background: cyan;
      border: none;
      padding: 10px 20px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
      margin-top: 10px;
    }
    textarea, pre, input {
      width: 100%;
      background: #000;
      color: #0f0;
      border: 1px solid #0ff;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table th, table td {
      border: 1px solid #0ff;
      padding: 8px;
      text-align: center;
    }
    .ok {
      color: lime;
      font-weight: bold;
    }
    .warn {
      color: yellow;
      font-weight: bold;
    }
    .alert {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>âš¡ Centrale NuclÃ©aire MÃ©tÃ©o â€“ Admin âš¡</h1>

  <!-- ğŸš€ Run -->
  <div class="section">
    <h2>ğŸš€ Lancer un Run SuperForecast</h2>
    <button onclick="launchRun()">ğŸš€ Lancer le Run</button>
  </div>

  <!-- ğŸ“œ Logs -->
  <div class="section">
    <h2>ğŸ“œ Logs en temps rÃ©el</h2>
    <pre id="logs">En attente de Run...</pre>
  </div>

  <!-- âš ï¸ Alertes -->
  <div class="section">
    <h2>âš ï¸ Alertes gÃ©nÃ©rÃ©es</h2>
    <pre id="alerts">[]</pre>
  </div>

  <!-- ğŸ“¡ Radar Console -->
  <div class="section">
    <h2>ğŸ“¡ Radar â€“ Vue Console</h2>
    <table id="radarTable">
      <thead>
        <tr>
          <th>Zone</th>
          <th>Pluie</th>
          <th>Neige</th>
          <th>Vent</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="4">Chargement...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- ğŸ‘¥ Utilisateurs -->
  <div class="section">
    <h2>ğŸ‘¥ Utilisateurs par catÃ©gorie</h2>
    <pre id="users">Chargement...</pre>
  </div>

  <!-- ğŸ¤– Chat -->
  <div class="section">
    <h2>ğŸ¤– Chat avec J.E.A.N.</h2>
    <input type="text" id="chatInput" placeholder="Pose ta question Ã  J.E.A.N."/>
    <button onclick="sendChat()">Envoyer</button>
    <pre id="chatLog">En attente de message...</pre>
  </div>

  <!-- ğŸŒ PrÃ©visions Nationales -->
  <div class="section">
    <h2>ğŸŒ PrÃ©visions Nationales (BE / FR / LUX)</h2>
    <pre id="nationalForecast">Chargement...</pre>

    <h3>ğŸ‡§ğŸ‡ª Belgique :</h3>
    <textarea id="beForecast"></textarea>
    <div class="ok" id="beOk"></div>

    <h3>ğŸ‡«ğŸ‡· France :</h3>
    <textarea id="frForecast"></textarea>
    <div class="ok" id="frOk"></div>

    <h3>ğŸ‡±ğŸ‡º Luxembourg :</h3>
    <textarea id="luxForecast"></textarea>
    <div class="ok" id="luxOk"></div>

    <button onclick="saveNationalForecasts()">ğŸ’¾ Sauvegarder les prÃ©visions nationales</button>
  </div>

  <script>
    async function launchRun() {
      const res = await fetch("/api/supercalc/run", { 
        method: "POST", 
        headers: { "Content-Type": "application/json" }, 
        body: JSON.stringify({ lat: 50.5, lon: 4.7 }) 
      });
      const data = await res.json();
      document.getElementById("logs").textContent = data.logs.join("\n");

      if (data.forecast && data.forecast.national) {
        document.getElementById("nationalForecast").textContent = JSON.stringify(data.forecast.national, null, 2);
        document.getElementById("beForecast").value = data.forecast.national.BE || "";
        document.getElementById("frForecast").value = data.forecast.national.FR || "";
        document.getElementById("luxForecast").value = data.forecast.national.LUX || "";

        document.getElementById("beOk").textContent = "âœ”ï¸ PrÃ©visions Belgique envoyÃ©es vers index";
        document.getElementById("frOk").textContent = "âœ”ï¸ PrÃ©visions France envoyÃ©es vers index";
        document.getElementById("luxOk").textContent = "âœ”ï¸ PrÃ©visions Luxembourg envoyÃ©es vers index";
      }
    }

    async function sendChat() {
      const msg = document.getElementById("chatInput").value;
      const res = await fetch("/api/chat", { 
        method: "POST", 
        headers: { "Content-Type": "application/json" }, 
        body: JSON.stringify({ message: msg }) 
      });
      const data = await res.json();
      document.getElementById("chatLog").textContent = "ğŸ§‘ Toi: " + msg + "\nğŸ¤– J.E.A.N.: " + (data.text || JSON.stringify(data));
    }

    async function saveNationalForecasts() {
      const be = document.getElementById("beForecast").value;
      const fr = document.getElementById("frForecast").value;
      const lux = document.getElementById("luxForecast").value;

      await fetch("/api/forecast/national/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ BE: be, FR: fr, LUX: lux })
      });

      alert("âœ… PrÃ©visions nationales sauvegardÃ©es !");
    }

    async function loadRadar() {
      const radar = await fetch("/api/radar").then(r=>r.json());
      const tbody = document.querySelector("#radarTable tbody");
      tbody.innerHTML = "";

      radar.forEach(zone => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${zone.name}</td>
          <td class="${zone.pluie ? 'alert' : 'ok'}">${zone.pluie ? "âš ï¸" : "âœ”ï¸"}</td>
          <td class="${zone.neige ? 'warn' : 'ok'}">${zone.neige ? "âš ï¸" : "âœ”ï¸"}</td>
          <td class="${zone.vent ? 'alert' : 'ok'}">${zone.vent ? "âš ï¸" : "âœ”ï¸"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function loadAdminData() {
      const logs = await fetch("/api/admin/logs").then(r=>r.json());
      document.getElementById("logs").textContent = logs.join("\n");

      const alerts = await fetch("/api/alerts").then(r=>r.json());
      document.getElementById("alerts").textContent = JSON.stringify(alerts, null, 2);

      const users = await fetch("/api/admin/users").then(r=>r.json());
      document.getElementById("users").textContent = JSON.stringify(users, null, 2);

      loadRadar();
    }

    loadAdminData();
  </script>
</body>
</html>
