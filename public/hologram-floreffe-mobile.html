<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>üì± D√¥me Floreffe Mobile</title>
<style>
body{margin:0;background:black;color:#8fe1ff;font-family:Segoe UI;text-align:center}
#scene{width:100%;height:65vh}
#info{padding:10px;font-size:0.9em;color:#8fe1ff}
canvas.radarCanvas{position:absolute;top:0;left:0;width:100%;height:100%;opacity:.25;z-index:0}
button{background:#003;padding:8px 16px;margin:6px;border:1px solid #0ff;color:#8fe1ff;border-radius:8px}
</style>
</head>
<body>
<h3>üåç D√¥me Floreffe Mobile</h3>
<div id="scene"></div>
<canvas id="radarCanvas" class="radarCanvas"></canvas>
<div id="info">Chargement du radar continental...</div>
<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
const scene=new THREE.Scene();
const cam=new THREE.PerspectiveCamera(45,innerWidth/(innerHeight*0.65),0.1,5000);
cam.position.set(0,100,300);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight*0.65);
document.getElementById("scene").appendChild(renderer.domElement);
const g=new THREE.Group();scene.add(g);
(async()=>{
 const a=await (await fetch("./floreffe_altitudes_hr.json")).json();
 const geom=new THREE.BufferGeometry();
 const verts=[],cols=[];
 const cLow=new THREE.Color(0x0020aa),cHigh=new THREE.Color(0xffffff);
 a.forEach(p=>{
  const x=p.lon*600-2800,y=p.alt*1.5,z=-p.lat*600+30500;
  verts.push(x,y,z);
  const c=cLow.clone().lerp(cHigh,Math.min(1,p.alt/250));
  cols.push(c.r,c.g,c.b);
 });
 geom.setAttribute("position",new THREE.Float32BufferAttribute(verts,3));
 geom.setAttribute("color",new THREE.Float32BufferAttribute(cols,3));
 const ptsMat=new THREE.PointsMaterial({size:2,vertexColors:true});
 g.add(new THREE.Points(geom,ptsMat));
 renderer.render(scene,cam);
})();
const radarCanvas=document.getElementById("radarCanvas"),ctx=radarCanvas.getContext("2d");
radarCanvas.width=innerWidth;radarCanvas.height=innerHeight;
async function drawRadar(){
 try{
  const r=await (await fetch("./floreffe_radar.json?"+Date.now())).json();
  ctx.clearRect(0,0,radarCanvas.width,radarCanvas.height);
  for(const f of r.fronts){
    const x=(f.lon+5)*80,y=(52-f.lat)*80;
    ctx.fillStyle=`rgba(0,255,255,${0.25+Math.random()*0.25})`;
    ctx.beginPath();ctx.arc(x,y,12,0,Math.PI*2);ctx.fill();
  }
  document.getElementById("info").innerText="Radar mis √† jour : "+new Date().toLocaleTimeString();
 }catch(e){console.warn(e.message);}
 setTimeout(drawRadar,600000);
}
drawRadar();
</script>
</body></html>
