<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tinsflash â€“ Centrale NuclÃ©aire MÃ©tÃ©o</title>
  <link rel="stylesheet" href="styles.css">

  <!-- âœ… Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6828365665232268"
     crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <h1>ğŸŒ Tinsflash â€“ La Centrale NuclÃ©aire MÃ©tÃ©o</h1>
  </header>

  <!-- PrÃ©visions locales -->
  <section id="local">
    <h2>ğŸ“ PrÃ©visions locales</h2>
    <div id="local-content">â³ Chargementâ€¦</div>
  </section>

  <!-- PrÃ©visions nationales -->
  <section id="national">
    <h2>ğŸ‡§ğŸ‡ª Belgique & ğŸ‡«ğŸ‡· France (multi-zones)</h2>
    <div id="national-content">â³ Chargementâ€¦</div>
  </section>

  <!-- PrÃ©visions 7 jours -->
  <section id="seven-days">
    <h2>ğŸ“… PrÃ©visions 7 jours</h2>
    <div id="days-container">â³ Chargementâ€¦</div>
  </section>

  <!-- Bulletin mÃ©tÃ©o -->
  <section id="forecast-text-section">
    <h2>ğŸ“° Bulletin mÃ©tÃ©o IA</h2>
    <pre id="forecast-text">â³ GÃ©nÃ©rationâ€¦</pre>
  </section>

  <!-- Radar -->
  <section id="radar">
    <h2>ğŸ›°ï¸ Radar en direct</h2>
    <div id="radar-map">â³ Chargementâ€¦</div>
  </section>

  <!-- Alertes -->
  <section id="alerts-section">
    <h2>âš ï¸ Alertes</h2>
    <div id="alerts-container">â³ Chargementâ€¦</div>
  </section>

  <footer>
    <p>âš¡ Centrale NuclÃ©aire MÃ©tÃ©o â€“ Powered by IA & multi-modÃ¨les rÃ©els (ECMWF, GFS, ICON, Copernicus, Meteomatics).</p>
  </footer>

<script>
const API = ""; // âœ garde vide si index.html est servi par ton backend Render

// ===== Helpers =====
const n = x => (x === null || x === undefined) ? "â€”" : x;
const icon = (rain, wx) => {
  const r = Number(rain ?? 0);
  if (r >= 60) return "ğŸŒ§ï¸";
  if (r >= 20) return "ğŸŒ¦ï¸";
  if ((wx||"").toLowerCase().includes("neige")) return "â„ï¸";
  return "â˜€ï¸";
};
function rowHTML(f) {
  return `<div>ğŸŒ¡ï¸ ${n(f?.minTemp)}Â° / ${n(f?.maxTemp)}Â° â€” â˜” ${n(f?.rainProbability)}% â€” ğŸ’¨ ${n(f?.windSpeed)} km/h</div>`;
}
function dayHTML(d) {
  return `<div>${d.date || "â€”"} ${icon(d?.rainProbability)} ${n(d?.minTemp)}Â°/${n(d?.maxTemp)}Â° â€” â˜” ${n(d?.rainProbability)}%</div>`;
}

// ===== PrÃ©visions locales (BE par dÃ©faut)
async function loadLocal() {
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    const be = data.find(f => f.country === "BE");
    document.getElementById("local-content").innerHTML =
      be ? rowHTML(be) : "âŒ DonnÃ©es indisponibles";
  } catch {
    document.getElementById("local-content").innerText = "âŒ Erreur API";
  }
}

// ===== National (BE + FR multi-zones)
async function loadNational() {
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    let html = "";

    // Belgique
    const be = data.find(f => f.country === "BE");
    if (be) html += "<h3>ğŸ‡§ğŸ‡ª Belgique</h3>" + rowHTML(be);

    // France (national + zones)
    const frNat = data.find(f => f.country === "FR");
    if (frNat) html += "<h3>ğŸ‡«ğŸ‡· France (national)</h3>" + rowHTML(frNat);

    const zones = ["FR-NO","FR-NE","FR-SO","FR-SE","FR-COR"];
    zones.forEach(z => {
      const zf = data.find(f => f.country === z);
      if (zf) {
        const label = { "FR-NO":"Nord-Ouest", "FR-NE":"Nord-Est", "FR-SO":"Sud-Ouest", "FR-SE":"Sud-Est", "FR-COR":"Corse" }[z];
        html += `<div><b>${label}</b> â€” ${rowHTML(zf)}</div>`;
      }
    });

    document.getElementById("national-content").innerHTML = html || "âŒ Non disponible";
  } catch {
    document.getElementById("national-content").innerText = "âŒ Erreur API";
  }
}

// ===== Vue rapide 7 jours (Belgique national par dÃ©faut)
async function load7Days() {
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    const be = data.filter(f => f.country === "BE");
    document.getElementById("days-container").innerHTML =
      be.slice(0,7).map(dayHTML).join("") || "âŒ Pas de donnÃ©es";
  } catch {
    document.getElementById("days-container").innerText = "âŒ Erreur API";
  }
}

// ===== Bulletin mÃ©tÃ©o IA
async function loadBulletin() {
  try {
    const res = await fetch(`${API}/api/logs`);
    const logs = await res.json();
    const last = logs.reverse().find(l => l.message.includes("Analyse IA"));
    document.getElementById("forecast-text").innerText =
      last ? last.message : "Pas encore disponible";
  } catch {
    document.getElementById("forecast-text").innerText = "âŒ Erreur API";
  }
}

// ===== Radar
async function loadRadar() {
  try {
    const res = await fetch(`${API}/api/radar`);
    const radar = await res.json();
    document.getElementById("radar-map").innerText = JSON.stringify(radar);
  } catch {
    document.getElementById("radar-map").innerText = "âŒ Erreur API";
  }
}

// ===== Alertes
async function loadAlerts() {
  try {
    const res = await fetch(`${API}/api/alerts`);
    const alerts = await res.json();
    document.getElementById("alerts-container").innerHTML =
      alerts.length ? alerts.map(a =>
        `<div>âš ï¸ <b>${a.title}</b> â€” ${n(a.certainty)}%</div>`
      ).join("") : "âœ… Aucune alerte active";
  } catch {
    document.getElementById("alerts-container").innerText = "âŒ Erreur API";
  }
}

// ===== Run
loadLocal();
loadNational();
load7Days();
loadBulletin();
loadRadar();
loadAlerts();
</script>
</body>
</html>
