<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tinsflash ‚Äî La m√©t√©o la plus pr√©cise au monde</title>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8204947691352732"
    crossorigin="anonymous"></script>

  <!-- Lottie Avatar -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <style>
    body { background:#0b0e13; color:#e6edf3; margin:0; font-family:Arial,sans-serif; }
    header { position:relative; text-align:center; }
    header video { width:100%; height:auto; display:block; }
    header h1 { font-size:2.2rem; margin:1rem 0 0.5rem; color:#58a6ff; }
    header p { max-width:900px; margin:auto; padding:0 1rem 1.5rem; font-size:1.1rem; line-height:1.6; color:#c9d1d9; }
    #soundToggle {
      position:absolute; top:10px; right:10px;
      background:rgba(0,0,0,0.6); color:white; border:none;
      padding:8px 12px; border-radius:6px; cursor:pointer;
    }
    section { background:#161b22; margin:1rem auto; padding:1rem; border-radius:8px; max-width:900px; box-shadow:0 2px 6px rgba(0,0,0,0.4); }
    section h2 { margin:0 0 0.8rem; color:#58a6ff; }
    input, button { padding:0.6rem; margin:0.3rem; border-radius:6px; border:1px solid #30363d; }
    button { cursor:pointer; background:#238636; color:white; border:none; }
    button:hover { background:#2ea043; }
    .forecast-day { display:flex; align-items:center; margin:0.5rem 0; }
    .forecast-day .icon { font-size:1.6rem; margin-right:10px; }
    #forecastBulletin { margin-top:1rem; padding:1rem; background:#21262d; border-radius:6px; border:1px solid #30363d; font-style:italic; }
    iframe { width:100%; height:450px; border:none; border-radius:8px; }
    .premium-banner { position:fixed; bottom:0; left:0; right:0; background:#238636; color:white; padding:1rem; text-align:center; display:flex; justify-content:space-between; align-items:center; z-index:999; }
    .premium-banner button { background:#0d1117; color:#58a6ff; border:1px solid #58a6ff; border-radius:6px; padding:0.5rem 1rem; cursor:pointer; }
    footer { background:#161b22; color:#8b949e; text-align:center; padding:1rem; border-top:1px solid #30363d; margin-top:80px; }
    footer a { color:#58a6ff; text-decoration:none; }
    #avatar-jean { position: fixed; bottom: 20px; right: 20px; width: 120px; height: 120px; cursor: pointer; z-index: 1000; }
  </style>
</head>
<body>
  <!-- üé¨ Vid√©o intro -->
  <header>
    <video id="introVideo" autoplay muted loop>
      <source src="intro-jean.mp4" type="video/mp4" />
    </video>
    <button id="soundToggle">üîá Activer le son</button>

    <h1>üåç Tinsflash ‚Äî La m√©t√©o la plus pr√©cise au monde</h1>
    <p>
      Notre moteur m√©t√©o fusionne <strong>les mod√®les physiques mondiaux de derni√®re g√©n√©ration</strong>
      avec <strong>l‚ÄôIA avanc√©e J.E.A.N.</strong>, les donn√©es de relief, le climat et les anomalies saisonni√®res.<br><br>
      R√©sultat : <strong>des pr√©visions locales et nationales ultra-fiables</strong>, et des alertes d√©tect√©es avant tout le monde.<br><br>
      Con√ßu pour le grand public, mais aussi pour les <strong>administrations</strong>, les <strong>agriculteurs</strong> et le <strong>secteur √©v√©nementiel</strong>.
    </p>
  </header>

  <!-- üîé Recherche ville -->
  <section>
    <h2>üîé Rechercher une ville</h2>
    <input id="city" placeholder="Ville (ex: Paris)" />
    <input id="country" placeholder="Pays (ex: FR)" />
    <button id="getForecast">Voir la m√©t√©o</button>
  </section>

  <!-- üìä Pr√©visions -->
  <section id="forecast">
    <h2>üìä Pr√©visions locales</h2>
    <div id="forecastIcons">Chargement des pr√©visions...</div>
    <div id="forecastBulletin">Bulletin m√©t√©o en cours de g√©n√©ration...</div>
  </section>

  <!-- üö® Alertes -->
  <section id="alerts">
    <h2>üö® Alertes m√©t√©o</h2>
    <div id="alertsResult">Chargement des alertes...</div>
  </section>

  <!-- üîî Notifications -->
  <section>
    <h2>üîî Notifications m√©t√©o</h2>
    <button id="notifBtn">Activer les notifications</button>
  </section>

  <!-- üí¨ Chat Jean -->
  <section id="chat-jean">
    <h2>üí¨ Demander √† J.E.A.N</h2>
    <input type="text" id="jeanInput" placeholder="Posez une question m√©t√©o..." />
    <button id="askJean">Envoyer</button>
    <div id="jeanReply"></div>
  </section>

  <!-- üå¶Ô∏è Radar -->
  <section>
    <h2>üå¶Ô∏è Radar m√©t√©o (Windy)</h2>
    <iframe src="https://embed.windy.com/embed2.html?lat=50.45&lon=4.85&zoom=6&level=surface&overlay=rain&menu=&message=true&marker=true"></iframe>
  </section>

  <!-- üöÄ Bandeau Premium -->
  <div class="premium-banner">
    <span>üöÄ Passez √† <strong>Tinsflash Premium</strong> pour d√©bloquer le radar 4D et des alertes encore plus rapides !</span>
    <button onclick="alert('Abonnement bient√¥t disponible üöÄ')">S‚Äôabonner</button>
  </div>

  <!-- Footer -->
  <footer>
    <p>¬© <span id="year"></span> Tinsflash‚Ñ¢ ‚Äî Tous droits r√©serv√©s</p>
    <p>üìß <a href="mailto:info@tinsflash.com">info@tinsflash.com</a> | üì± <a href="https://wa.me/324XXXXXXXX" target="_blank">WhatsApp Direct</a></p>
  </footer>

  <!-- üé≠ Avatar IA flottant -->
  <div id="avatar-jean">
    <lottie-player 
      src="https://assets10.lottiefiles.com/packages/lf20_zzr1rj7h.json"
      background="transparent" speed="1" loop autoplay>
    </lottie-player>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const video = document.getElementById("introVideo");
    document.getElementById("soundToggle").onclick = () => {
      video.muted = !video.muted;
      document.getElementById("soundToggle").textContent = video.muted ? "üîá Activer le son" : "üîä Couper le son";
    };

    // üìä Charger pr√©visions
    async function loadForecast(country) {
      const res = await fetch(`/api/forecast/${country}`);
      const data = await res.json();
      if (!data || data.error) {
        document.getElementById("forecastIcons").innerText = "‚ùå Erreur de r√©cup√©ration.";
        return;
      }
      let html = "";
      (data.days || []).forEach(d => {
        html += `<div class="forecast-day"><div class="icon">${d.icon || "‚òÄÔ∏è"}</div>
                 <span><strong>${d.date}</strong> ‚Äî ${d.condition || ""}, ${d.temp_min}¬∞C / ${d.temp_max}¬∞C</span></div>`;
      });
      document.getElementById("forecastIcons").innerHTML = html || "Aucune donn√©e disponible.";
      const bulletinRes = await fetch(`/api/podcast/${country}`);
      const bulletinData = await bulletinRes.json();
      document.getElementById("forecastBulletin").innerHTML = bulletinData?.podcast || "<em>Pas de bulletin g√©n√©r√©.</em>";
    }

    // üö® Charger alertes
    async function loadAlerts() {
      const res = await fetch("/api/alerts");
      const data = await res.json();
      if (!data || !data.length) {
        document.getElementById("alertsResult").innerText = "Aucune alerte active.";
        return;
      }
      let html = "<ul>";
      data.forEach(a => { html += `<li><strong>${a.zone}</strong> ‚Äî ${a.type} (${a.severity}) : ${a.message}</li>`; });
      html += "</ul>";
      document.getElementById("alertsResult").innerHTML = html;
    }

    // üîî Notifications
    if ("serviceWorker" in navigator && "PushManager" in window) {
      navigator.serviceWorker.register("/sw.js").then(reg => {
        document.getElementById("notifBtn").onclick = async () => {
          const sub = await reg.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: "<%= VAPID_PUBLIC_KEY %>"
          });
          await fetch("/api/subscribe", {
            method: "POST", headers: { "Content-Type": "application/json" },
            body: JSON.stringify(sub)
          });
          alert("‚úÖ Notifications m√©t√©o activ√©es !");
        };
      });
    }

    // üí¨ Chat J.E.A.N
    document.getElementById("askJean").onclick = async () => {
      const message = document.getElementById("jeanInput").value;
      const res = await fetch("/api/jean", {
        method: "POST", headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });
      const data = await res.json();
      document.getElementById("jeanReply").innerText = data.reply;
    };

    // Initial load
    loadForecast("BE");
    loadAlerts();
  </script>
</body>
</html>
