<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TINSFLASH â€“ La mÃ©tÃ©o 1000% rÃ©elle</title>

  <!-- âœ… Google AdSense verification -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6828365665232268"
     crossorigin="anonymous"></script>

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="loader.css">
  <link rel="stylesheet" href="radar.css">

  <!-- ğŸŒ Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script defer src="app.js"></script>
  <script defer src="loader.js"></script>
  <script defer src="radar.js"></script>
</head>
<body>
  <!-- ğŸ¬ Intro vidÃ©o -->
  <section class="intro-video">
    <video autoplay muted playsinline id="intro-jean">
      <source src="intro-jean.mp4" type="video/mp4">
      Votre navigateur ne supporte pas la vidÃ©o.
    </video>
    <div class="intro-overlay">
      <h1>ğŸŒ TINSFLASH</h1>
      <p>La mÃ©tÃ©o 1000% rÃ©elle, fonctionnelle et connectÃ©e</p>
      <div class="intro-buttons">
        <button onclick="toggleSound()" id="sound-btn">ğŸ”Š Activer le son</button>
        <button onclick="skipIntro()">â­ï¸ Passer lâ€™intro</button>
      </div>
    </div>
  </section>

  <!-- ğŸŒ¤ï¸ Contenu principal -->
  <header>
    <h1>PrÃ©visions MÃ©tÃ©o TINSFLASH</h1>
  </header>

  <main>
    <!-- ğŸ“ PrÃ©visions locales -->
    <section class="forecast-section">
      <h2>ğŸ“ PrÃ©visions locales</h2>
      <div id="local-loader" class="loader-container"></div>
      <div id="local-content" class="forecast-box neon-card"></div>
    </section>

    <!-- ğŸŒ PrÃ©visions nationales -->
    <section class="forecast-section">
      <h2>ğŸŒ PrÃ©visions nationales</h2>
      <div id="national-loader" class="loader-container"></div>
      <div id="national-content" class="forecast-box neon-card"></div>
    </section>

    <!-- ğŸ“… PrÃ©visions 7 jours -->
    <section class="forecast-section">
      <h2>ğŸ“… PrÃ©visions sur 7 jours</h2>
      <div id="days-loader" class="loader-container"></div>
      <div id="days-container" class="days-grid"></div>
    </section>

    <!-- ğŸ“ PrÃ©visions Ã©crites -->
    <section class="forecast-section">
      <h2>ğŸ“ PrÃ©visions Ã©crites</h2>
      <div id="forecast-text" class="forecast-box neon-card">
        â³ GÃ©nÃ©ration du bulletin mÃ©tÃ©o...
      </div>
    </section>

    <!-- ğŸ™ï¸ PrÃ©visions audio -->
    <section class="forecast-section">
      <h2>ğŸ™ï¸ PrÃ©visions audio</h2>
      <div id="audio-forecast" class="forecast-box neon-card">
        <p>ğŸ§ Cliquez sur Lecture pour Ã©couter le bulletin mÃ©tÃ©o.</p>
        <button onclick="playForecast()">â–¶ï¸ Lecture</button>
        <button onclick="stopForecast()">â¹ï¸ Stop</button>
      </div>
    </section>

    <!-- ğŸ›°ï¸ Radar mÃ©tÃ©o mondial -->
    <section class="forecast-section">
      <h2>ğŸŒ Radar mÃ©tÃ©o mondial</h2>
      <div id="radar-loader" class="loader-container"></div>
      <div id="radar-content"></div>
    </section>

    <!-- âš ï¸ Alertes -->
    <section class="forecast-section">
      <h2>âš ï¸ Alertes</h2>
      <div id="alerts-loader" class="loader-container"></div>
      <div id="alerts" class="forecast-box neon-card"></div>
    </section>
  </main>

  <!-- ğŸ“¢ Bandeau pub Google -->
  <aside class="ads">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-6828365665232268"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </aside>

  <footer>
    <p>ğŸš€ TINSFLASH 2025 â€“ La machine mÃ©tÃ©o mondiale</p>
  </footer>

  <!-- ğŸš€ Scripts -->
  <script>
    // ğŸ¬ VidÃ©o Intro
    function toggleSound() {
      const video = document.getElementById("intro-jean");
      const btn = document.getElementById("sound-btn");
      if (video.muted) {
        video.muted = false;
        btn.textContent = "ğŸ”‡ Couper le son";
      } else {
        video.muted = true;
        btn.textContent = "ğŸ”Š Activer le son";
      }
    }

    function skipIntro() {
      const video = document.getElementById("intro-jean");
      video.pause();
      document.querySelector(".intro-video").style.display = "none";
    }

    // ğŸ“ GÃ©nÃ©ration du bulletin Ã©crit
    function generateForecastText(daysData) {
      if (!daysData || daysData.length === 0) {
        document.getElementById("forecast-text").innerText =
          "âš ï¸ DonnÃ©es insuffisantes pour gÃ©nÃ©rer un bulletin.";
        return;
      }

      const today = daysData[0];
      const tomorrow = daysData[1];
      const rest = daysData.slice(2);

      let text = "";
      text += `ğŸŒ™ Ce soir : ${today.description}, tempÃ©ratures autour de ${today.temperature_min}Â°C Ã  ${today.temperature_max}Â°C.\n\n`;
      text += `â˜€ï¸ Demain (${tomorrow.jour}) : ${tomorrow.description}, min ${tomorrow.temperature_min}Â°C et max ${tomorrow.temperature_max}Â°C.\n\n`;

      if (rest.length > 0) {
        const minTemp = Math.min(...rest.map(d => d.temperature_min));
        const maxTemp = Math.max(...rest.map(d => d.temperature_max));
        text += `ğŸ“… Ensuite : tendance ${rest[0].description.toLowerCase()}, avec des tempÃ©ratures entre ${minTemp}Â°C et ${maxTemp}Â°C.`;
      }

      document.getElementById("forecast-text").innerText = text;
    }

    // ğŸ™ï¸ Audio forecast
    let synth = window.speechSynthesis;
    let utterance;

    function playForecast() {
      const text = document.getElementById("forecast-text").innerText;
      if (!text || text.startsWith("âš ï¸")) {
        alert("âš ï¸ Bulletin mÃ©tÃ©o indisponible pour lâ€™instant.");
        return;
      }

      stopForecast();
      utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "fr-FR";
      utterance.rate = 1;
      utterance.pitch = 1;
      synth.speak(utterance);
    }

    function stopForecast() {
      if (synth.speaking) {
        synth.cancel();
      }
    }

    // ğŸš€ Loaders + donnÃ©es mÃ©tÃ©o
    window.addEventListener("DOMContentLoaded", () => {
      // Local avec GPS
      const localLoader = startLoader("local-loader", 2500);
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => {
            loadLocalForecast(pos.coords.latitude, pos.coords.longitude)
              .then(() => localLoader.stop());
          },
          err => {
            document.getElementById("local-content").innerHTML =
              "âš ï¸ Localisation refusÃ©e.<br> Merci dâ€™encoder votre adresse complÃ¨te dans lâ€™onglet <strong>Compte</strong>.";
            localLoader.stop();
          }
        );
      } else {
        document.getElementById("local-content").innerHTML =
          "ğŸ’» Vous Ãªtes connectÃ© depuis une localisation gÃ©nÃ©rique.<br>" +
          "Merci dâ€™encoder votre adresse complÃ¨te dans lâ€™onglet <strong>Compte</strong>.";
        localLoader.stop();
      }

      // National
      const nationalLoader = startLoader("national-loader", 2500);
      loadNationalForecast("BE").then(() => nationalLoader.stop());

      // 7 jours + texte Ã©crit
      const daysLoader = startLoader("days-loader", 2500);
      loadSevenDays().then((daysData) => {
        daysLoader.stop();
        generateForecastText(daysData.days);
      });

      // Radar
      const radarLoader = startLoader("radar-loader", 2500);
      loadRadar().then(() => radarLoader.stop());

      // Alertes
      const alertsLoader = startLoader("alerts-loader", 2500);
      loadAlerts().then(() => alertsLoader.stop());
    });
  </script>
</body>
</html>
