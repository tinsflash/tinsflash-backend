<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TINSFLASH ‚Äî La m√©t√©o nucl√©aire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8204947691352732"
     crossorigin="anonymous"></script>

  <style>
    body { background:#0d1117; color:#eee; }
    .navbar { background:#161b22; }
    .ads { margin:20px 0; text-align:center; }
    .card { background:#161b22; color:#eee; border:1px solid #30363d; }
    iframe { width:100%; height:500px; border:none; }
    #introVideo { width:100%; max-height:400px; object-fit:cover; }
    #videoControls { position:absolute; top:20px; right:20px; z-index:10; }
  </style>
</head>
<body>
<nav class="navbar navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">‚ö° TINSFLASH</a>
  </div>
</nav>

<!-- Intro vid√©o -->
<div class="position-relative">
  <video id="introVideo" autoplay muted loop playsinline>
    <source src="intro.mp4" type="video/mp4">
    Votre navigateur ne supporte pas la vid√©o HTML5.
  </video>
  <button id="videoControls" class="btn btn-sm btn-warning">üîá Son</button>
</div>

<!-- PUB top -->
<div class="ads">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-8204947691352732"
       data-ad-slot="8028664604"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<div class="container my-4">

  <!-- Bloc pr√©visions -->
  <h2>Pr√©visions locales</h2>
  <form class="row g-2 mb-3" onsubmit="loadForecast(event)">
    <div class="col-md-6">
      <input id="city" class="form-control" placeholder="Votre ville">
    </div>
    <div class="col-md-4">
      <select id="country" class="form-select">
        <option value="BE">Belgique</option>
        <option value="FR">France</option>
        <option value="US">USA</option>
        <option value="GB">Royaume-Uni</option>
        <option value="DE">Allemagne</option>
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100">Voir</button>
    </div>
  </form>

  <div id="forecast-result" class="card p-3">Entrez une ville et un pays.</div>

  <!-- Bloc alertes -->
  <h2 class="mt-4">Alertes m√©t√©o</h2>
  <div id="alerts" class="row"></div>

  <!-- PUB milieu -->
  <div class="ads my-4">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8204947691352732"
         data-ad-slot="9437146866"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <!-- Radar -->
  <h2 class="mt-4">Radar m√©t√©o</h2>
  <iframe src="https://embed.windy.com/embed2.html?lat=50&lon=4&zoom=5&level=surface&overlay=rain&product=ecmwf"></iframe>

  <!-- PUB bas -->
  <div class="ads mt-4">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8204947691352732"
         data-ad-slot="9109843802"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// üé• Contr√¥le vid√©o intro
const video=document.getElementById("introVideo");
const btn=document.getElementById("videoControls");
btn.addEventListener("click",()=>{
  if(video.muted){
    video.muted=false;
    btn.textContent="üîä Son";
  } else {
    video.muted=true;
    btn.textContent="üîá Son";
  }
});

// Pr√©visions
async function loadForecast(e){
  e.preventDefault();
  const city=document.getElementById("city").value;
  const country=document.getElementById("country").value;
  const res=await fetch("/api/chat",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({message:`M√©t√©o √† ${city}`,country})}).then(r=>r.json());
  document.getElementById("forecast-result").innerHTML="<pre>"+JSON.stringify(res.reply,null,2)+"</pre>";
}

// Alertes
async function loadAlerts(){
  const a=await fetch("/api/alerts").then(r=>r.json());
  const box=document.getElementById("alerts");
  box.innerHTML="";
  if(a.covered && a.covered.length){
    a.covered.forEach(x=>{
      box.innerHTML+=`<div class="col-md-4"><div class="card p-2 mb-2"><b>${x.country||x.continent}</b><br>${x.message||x.details||"Alerte"}<br><span class="badge bg-danger">${x.confidence||"?"}%</span></div></div>`;
    });
  } else {
    box.innerHTML="<p>Aucune alerte active.</p>";
  }
}
loadAlerts();
</script>
</body>
</html>
