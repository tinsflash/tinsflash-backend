<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒ Tinsflash â€“ La Centrale NuclÃ©aire MÃ©tÃ©o</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>ğŸŒ Tinsflash â€“ PrÃ©visions NuclÃ©aires</h1>
  </header>

  <!-- PrÃ©visions locales -->
  <section>
    <h2>ğŸ“ PrÃ©visions locales</h2>
    <div id="local">â³ Chargementâ€¦</div>
  </section>

  <!-- PrÃ©visions nationales -->
  <section>
    <h2>ğŸ‡§ğŸ‡ª/ğŸ‡«ğŸ‡· PrÃ©visions nationales</h2>
    <div id="national">â³ Chargementâ€¦</div>
  </section>

  <!-- PrÃ©visions 7 jours -->
  <section>
    <h2>ğŸ“… PrÃ©visions 7 jours</h2>
    <div id="days">â³ Chargementâ€¦</div>
  </section>

  <!-- Bulletin texte -->
  <section>
    <h2>ğŸ“° Bulletin mÃ©tÃ©o</h2>
    <div id="bulletin">â³ Chargementâ€¦</div>
  </section>

  <!-- Radar -->
  <section>
    <h2>ğŸ›°ï¸ Radar</h2>
    <div id="radar">â³ Chargementâ€¦</div>
  </section>

  <!-- Alertes -->
  <section>
    <h2>âš ï¸ Alertes</h2>
    <div id="alerts">â³ Chargementâ€¦</div>
  </section>

<script>
const API = "";

// PrÃ©visions locales
async function loadLocal() {
  const box = document.getElementById("local");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    const be = data.find(f => f.country === "BE");
    box.innerHTML = be ? `ğŸŒ¡ï¸ ${be.minTemp}â€“${be.maxTemp}Â°C, â˜” ${be.rainProbability}%` : "Non dispo.";
  } catch (e) { box.innerText = "âŒ Erreur"; }
}

// PrÃ©visions nationales
async function loadNational() {
  const box = document.getElementById("national");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    const fr = data.filter(f => f.country.startsWith("FR"));
    box.innerHTML = fr.map(z => `<div>${z.country}: ${z.minTemp}â€“${z.maxTemp}Â°C</div>`).join("");
  } catch (e) { box.innerText = "âŒ Erreur"; }
}

// 7 jours
async function load7Days() {
  const box = document.getElementById("days");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    box.innerHTML = data.slice(0,7).map(d => `
      <div>${d.date} ğŸŒ¡ï¸ ${d.minTemp}â€“${d.maxTemp}Â°C â˜”${d.rainProbability}%</div>
    `).join("");
  } catch (e) { box.innerText = "âŒ Erreur"; }
}

// Bulletin
async function loadBulletin() {
  const box = document.getElementById("bulletin");
  try {
    const res = await fetch(`${API}/api/logs`);
    const logs = await res.json();
    const last = logs.reverse().find(l => l.message.includes("Analyse IA"));
    box.innerText = last ? last.message : "Pas encore dispo.";
  } catch (e) { box.innerText = "âŒ Erreur"; }
}

// Radar
async function loadRadar() {
  const box = document.getElementById("radar");
  try {
    const res = await fetch(`${API}/api/radar`);
    const radar = await res.json();
    box.innerText = JSON.stringify(radar);
  } catch (e) { box.innerText = "âŒ Erreur"; }
}

// Alertes
async function loadAlerts() {
  const box = document.getElementById("alerts");
  try {
    const res = await fetch(`${API}/api/alerts`);
    const alerts = await res.json();
    if (!alerts.length) { box.innerHTML = "Aucune alerte."; return; }
    box.innerHTML = alerts.map(a => `<div>${a.title} (${a.certainty}%)</div>`).join("");
  } catch (e) { box.innerText = "âŒ Erreur"; }
}

loadLocal(); loadNational(); load7Days(); loadBulletin(); loadRadar(); loadAlerts();
</script>
</body>
</html>
