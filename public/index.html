<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow">
  <title>TINSFLASH ‚Äì Pr√©visions & Alertes IA</title>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-82049476791352732" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #0b0f19;
      color: #ddd;
      text-align: center;
    }
    video {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }
    section {
      margin: 15px auto;
      padding: 15px;
      border-radius: 10px;
      background: #111831;
      max-width: 850px;
      text-align: left;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    h2 {
      color: #4fc3f7;
      margin-top: 0;
    }
    p { text-align: justify; line-height: 1.6; }
    .forecast-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      gap: 10px;
    }
    .day-box {
      background: #1a2238;
      border-radius: 8px;
      padding: 10px;
      width: 110px;
      text-align: center;
      color: #fff;
    }
    .day-box img { width: 50px; height: 50px; }
    #mapForecast, #mapAlerts {
      height: 250px;
      width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
    iframe {
      border: none;
      width: 100%;
      height: 260px;
      border-radius: 10px;
    }
    footer {
      text-align: center;
      padding: 15px;
      font-size: 14px;
      background: #111831;
      color: #aaa;
      margin-top: 20px;
    }
    footer a { color: #4fc3f7; text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    /* === Avatar Jean === */
    #jean-chat {
      position: fixed;
      bottom: 25px;
      right: 25px;
      text-align: center;
      z-index: 9999;
    }
    #jean-avatar {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(79,195,247,0.7);
      cursor: pointer;
      object-fit: cover;
      background: radial-gradient(circle at 30% 30%, #3b4b70, #0b0f19);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    #jean-avatar:hover {
      transform: scale(1.05);
      box-shadow: 0 0 25px rgba(79,195,247,1);
    }
    #chat-label {
      margin-top: 6px;
      background: #1a2238;
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      display: inline-block;
      font-size: 13px;
      cursor: pointer;
    }
    #chat-box {
      display: none;
      position: fixed;
      bottom: 130px;
      right: 20px;
      width: 320px;
      height: 420px;
      background: #1a2238;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      z-index: 10000;
    }
    #chat-messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      font-size: 13px;
    }
    .msg { margin:5px 0; padding:6px 10px; border-radius:6px; max-width:70%; }
    .user { background:#4fc3f7; color:#000; margin-left:auto; text-align:right; }
    .bot { background:#333; color:#fff; margin-right:auto; text-align:left; }
    .input-row { display:flex; gap:5px; padding:8px; }
    .input-row input { flex:1; padding:5px; border-radius:6px; border:1px solid #555; }
    .input-row button { background:#4fc3f7; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>

  <video autoplay muted loop>
    <source src="/intro-jean.mp4" type="video/mp4">
  </video>

  <section>
    <h2>üåç Bienvenue sur TINSFLASH</h2>
    <p>
      TINSFLASH croise les mod√®les m√©t√©orologiques internationaux et notre moteur IA
      multi-sources de nouvelle g√©n√©ration pour fournir <b>des pr√©visions fiables, locales et nationales</b>,
      adapt√©es √† ta position. Re√ßois aussi <b>des alertes anticip√©es</b> d√©tect√©es par notre syst√®me d‚Äôanalyse
      climatique mondial.
    </p>
  </section>

  <section>
    <h2>üìç Pr√©visions locales du jour</h2>
    <div class="forecast-grid" id="localForecast"></div>
  </section>

  <section>
    <h2>üå¶Ô∏è Pr√©visions nationales du jour</h2>
    <div class="forecast-grid" id="nationalForecast"></div>
  </section>

  <section>
    <h2>üß≠ Pr√©visions locales ‚Äì 7 jours</h2>
    <div class="forecast-grid" id="local7d"></div>
  </section>

  <section>
    <h2>üåê Pr√©visions nationales ‚Äì 7 jours</h2>
    <div class="forecast-grid" id="national7d"></div>
  </section>

  <section>
    <h2>üö® Alertes locales & nationales</h2>
    <div id="alerts">Chargement des alertes...</div>
  </section>

  <section>
    <h2>üåé Carte mondiale ‚Äì Pr√©visions</h2>
    <div id="mapForecast"></div>
  </section>

  <section>
    <h2>üå™Ô∏è Carte mondiale ‚Äì Alertes</h2>
    <div id="mapAlerts"></div>
  </section>

  <section>
    <h2>üì° Radar en direct</h2>
    <iframe src="https://embed.windy.com/embed2.html?lat=50.5&lon=4.5&zoom=5&level=surface&overlay=rain&menu=true"></iframe>
  </section>

  <footer>
    <p>¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s</p>
    <p>Contact : <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> | WhatsApp : <a href="https://wa.me/32473264477">+32 473 26 44 77</a></p>
    <p>Int√©ress√© par un partenariat ou l‚Äôacquisition de notre moteur m√©t√©o ? Parlons-en.</p>
  </footer>

  <!-- === AVATAR JEAN === -->
  <div id="jean-chat">
    <img id="jean-avatar" src="/avatars/jean-default.png" alt="Jean, assistant IA">
    <div id="chat-label">üí¨ Discuter avec moi</div>
  </div>

  <div id="chat-box">
    <div id="chat-messages"></div>
    <div class="input-row">
      <input type="text" id="chatInput" placeholder="Votre message...">
      <button onclick="sendChat()">Envoyer</button>
    </div>
  </div>

  <script>
    // === AVATAR ===
    const jeanAvatar = document.getElementById("jean-avatar");
    const chatLabel = document.getElementById("chat-label");
    const chatBox = document.getElementById("chat-box");

    function toggleChat() {
      chatBox.style.display = chatBox.style.display === "flex" ? "none" : "flex";
    }
    jeanAvatar.addEventListener("click", toggleChat);
    chatLabel.addEventListener("click", toggleChat);

    function addMsg(text, type="bot") {
      const msg = document.createElement("div");
      msg.className = "msg " + type;
      msg.innerText = text;
      document.getElementById("chat-messages").appendChild(msg);
      document.getElementById("chat-messages").scrollTop = document.getElementById("chat-messages").scrollHeight;
    }

    async function sendChat() {
      const input = document.getElementById("chatInput");
      const text = input.value.trim();
      if (!text) return;
      addMsg(text, "user");
      input.value = "";
      try {
        const res = await fetch("/api/jean", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        addMsg(data.reply || "‚ö†Ô∏è Pas de r√©ponse", "bot");
      } catch (e) {
        addMsg("Erreur: " + e.message, "bot");
      }
    }

    // === CARTES MONDIALES ===
    const mapForecast = L.map("mapForecast").setView([20,0], 2);
    const mapAlerts = L.map("mapAlerts").setView([20,0], 2);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapForecast);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapAlerts);
  </script>

</body>
</html>
