<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🌍 Tinsflash – La Centrale Nucléaire Météo</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>🌍 Tinsflash – Prévisions Nucléaires</h1>
  </header>

  <!-- Prévisions locales -->
  <section>
    <h2>📍 Prévisions locales</h2>
    <div id="local">⏳ Chargement…</div>
  </section>

  <!-- Prévisions nationales -->
  <section>
    <h2>🇧🇪/🇫🇷 Prévisions nationales</h2>
    <div id="national">⏳ Chargement…</div>
  </section>

  <!-- Prévisions 7 jours -->
  <section>
    <h2>📅 Prévisions 7 jours</h2>
    <div id="days">⏳ Chargement…</div>
  </section>

  <!-- Bulletin texte -->
  <section>
    <h2>📰 Bulletin météo</h2>
    <div id="bulletin">⏳ Chargement…</div>
  </section>

  <!-- Radar -->
  <section>
    <h2>🛰️ Radar</h2>
    <div id="radar">⏳ Chargement…</div>
  </section>

  <!-- Alertes -->
  <section>
    <h2>⚠️ Alertes</h2>
    <div id="alerts">⏳ Chargement…</div>
  </section>

<script>
const API = "";

// Prévisions locales
async function loadLocal() {
  const box = document.getElementById("local");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    const be = data.find(f => f.country === "BE");
    box.innerHTML = be ? `🌡️ ${be.minTemp}–${be.maxTemp}°C, ☔ ${be.rainProbability}%` : "Non dispo.";
  } catch (e) { box.innerText = "❌ Erreur"; }
}

// Prévisions nationales
async function loadNational() {
  const box = document.getElementById("national");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    const fr = data.filter(f => f.country.startsWith("FR"));
    box.innerHTML = fr.map(z => `<div>${z.country}: ${z.minTemp}–${z.maxTemp}°C</div>`).join("");
  } catch (e) { box.innerText = "❌ Erreur"; }
}

// 7 jours
async function load7Days() {
  const box = document.getElementById("days");
  try {
    const res = await fetch(`${API}/api/forecasts`);
    const data = await res.json();
    box.innerHTML = data.slice(0,7).map(d => `
      <div>${d.date} 🌡️ ${d.minTemp}–${d.maxTemp}°C ☔${d.rainProbability}%</div>
    `).join("");
  } catch (e) { box.innerText = "❌ Erreur"; }
}

// Bulletin
async function loadBulletin() {
  const box = document.getElementById("bulletin");
  try {
    const res = await fetch(`${API}/api/logs`);
    const logs = await res.json();
    const last = logs.reverse().find(l => l.message.includes("Analyse IA"));
    box.innerText = last ? last.message : "Pas encore dispo.";
  } catch (e) { box.innerText = "❌ Erreur"; }
}

// Radar
async function loadRadar() {
  const box = document.getElementById("radar");
  try {
    const res = await fetch(`${API}/api/radar`);
    const radar = await res.json();
    box.innerText = JSON.stringify(radar);
  } catch (e) { box.innerText = "❌ Erreur"; }
}

// Alertes
async function loadAlerts() {
  const box = document.getElementById("alerts");
  try {
    const res = await fetch(`${API}/api/alerts`);
    const alerts = await res.json();
    if (!alerts.length) { box.innerHTML = "Aucune alerte."; return; }
    box.innerHTML = alerts.map(a => `<div>${a.title} (${a.certainty}%)</div>`).join("");
  } catch (e) { box.innerText = "❌ Erreur"; }
}

loadLocal(); loadNational(); load7Days(); loadBulletin(); loadRadar(); loadAlerts();
</script>
</body>
</html>
