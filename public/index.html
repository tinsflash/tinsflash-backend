<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tinsflash - Les pr√©visions et alertes les plus fiables</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8204947691352732"
    crossorigin="anonymous"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

  <!-- HEADER avec vid√©o -->
  <header class="relative w-full h-[300px] md:h-[450px] overflow-hidden">
    <video id="introVideo" class="w-full h-full object-cover" autoplay muted loop>
      <source src="intro.mp4" type="video/mp4" />
      Votre navigateur ne supporte pas la vid√©o.
    </video>
    <button id="toggleSound" class="absolute bottom-4 right-4 bg-black/60 px-4 py-2 rounded text-sm">
      üîá Son OFF
    </button>
    <h1 class="absolute top-6 left-6 text-3xl md:text-5xl font-bold drop-shadow-lg">
      Tinsflash<br><span class="text-blue-400">Les pr√©visions et alertes les plus fiables</span>
    </h1>
  </header>

  <!-- Bandeau pub -->
  <div class="w-full bg-gray-800 text-center py-2">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8204947691352732"
         data-ad-slot="1234567890"
         data-ad-format="auto"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <!-- Local Forecast -->
  <section class="p-6">
    <h2 class="text-2xl font-bold mb-4">Pr√©visions locales</h2>
    <div id="localForecast" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    <p id="localForecastText" class="mt-4 text-gray-300"></p>
  </section>

  <!-- National Forecast -->
  <section class="p-6 bg-gray-800">
    <h2 class="text-2xl font-bold mb-4">Pr√©visions nationales / √âtat</h2>
    <div id="nationalForecast" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    <p id="nationalForecastText" class="mt-4 text-gray-300"></p>
  </section>

  <!-- Alertes -->
  <section class="p-6">
    <h2 class="text-2xl font-bold mb-4">Alertes m√©t√©o</h2>
    <div id="alerts" class="space-y-2"></div>
  </section>

  <!-- Radar -->
  <section class="p-6 bg-gray-800">
    <h2 class="text-2xl font-bold mb-4">Radar m√©t√©o</h2>
    <iframe src="/api/radar/global" class="w-full h-[400px] bg-black rounded"></iframe>
  </section>

  <!-- Publicit√© milieu -->
  <div class="w-full text-center py-4">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-8204947691352732"
         data-ad-slot="0987654321"
         data-ad-format="auto"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <!-- Conversion Premium -->
  <section class="p-6 text-center">
    <h2 class="text-2xl font-bold mb-4">Passez √† Premium, Pro ou Pro+</h2>
    <p class="mb-4 text-gray-300">Acc√©dez aux pr√©visions professionnelles, au radar avanc√© et aux alertes ultra-pr√©cises.</p>
    <a href="/premium" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 rounded-lg text-white font-semibold">D√©couvrir Premium</a>
  </section>

  <!-- Footer -->
  <footer class="bg-black py-4 text-center text-sm text-gray-400">
    ¬© Tinsflash system J.E.A.N. by Pydaris ‚Äì reproduction interdite
  </footer>

  <!-- Scripts -->
  <script>
    // Gestion vid√©o intro
    const video = document.getElementById('introVideo');
    const toggleBtn = document.getElementById('toggleSound');
    toggleBtn.addEventListener('click', () => {
      video.muted = !video.muted;
      toggleBtn.textContent = video.muted ? "üîá Son OFF" : "üîä Son ON";
    });

    // D√©tection langue utilisateur
    let userLang = navigator.language.startsWith("fr") ? "fr" : "en";

    // G√©olocalisation utilisateur
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(fetchForecast, askAddress);
      } else {
        askAddress();
      }
    }

    // Si GPS refus√© ‚Üí encodage adresse
    function askAddress() {
      const addr = prompt(userLang === "fr" ? "Entrez votre adresse pour obtenir les pr√©visions :" : "Enter your address for forecasts:");
      if (addr) {
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`)
          .then(res => res.json())
          .then(data => {
            if (data.length > 0) {
              fetchForecast({ coords: { latitude: data[0].lat, longitude: data[0].lon }});
            }
          });
      }
    }

    // Fetch Forecast depuis backend
    function fetchForecast(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      // Local
      fetch("/api/superforecast", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ lat, lon, country: "LOCAL", region: "user" })
      })
      .then(res => res.json())
      .then(data => renderForecast("localForecast", "localForecastText", data));

      // National
      fetch("/api/superforecast", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ lat, lon, country: "NATIONAL", region: "user" })
      })
      .then(res => res.json())
      .then(data => renderForecast("nationalForecast", "nationalForecastText", data));

      // Alertes
      fetch("/api/alerts")
        .then(res => res.json())
        .then(data => renderAlerts(data.alerts || []));
    }

    // Render forecast cards
    function renderForecast(containerId, textId, data) {
      const container = document.getElementById(containerId);
      const text = document.getElementById(textId);
      container.innerHTML = "";
      if (data?.forecast?.days) {
        data.forecast.days.forEach(day => {
          const div = document.createElement("div");
          div.className = "p-4 bg-gray-700 rounded text-center";
          div.innerHTML = `
            <div class="text-lg font-bold">${day.date}</div>
            <div class="text-4xl">${day.icon || "‚òÄÔ∏è"}</div>
            <div>${day.temp_min}¬∞ / ${day.temp_max}¬∞</div>
          `;
          container.appendChild(div);
        });
        text.textContent = data.forecast.summary || "";
      }
    }

    // Render alerts
    function renderAlerts(alerts) {
      const container = document.getElementById("alerts");
      container.innerHTML = "";
      alerts.forEach(alert => {
        const div = document.createElement("div");
        div.className = `p-3 rounded ${alert.reliability > 80 ? "bg-red-600" : "bg-yellow-500"}`;
        div.textContent = `${alert.type} (${alert.reliability}%) - ${alert.continent || alert.country || ""}`;
        container.appendChild(div);
      });
    }

    // Lancement au chargement
    getLocation();
  </script>
</body>
</html>
