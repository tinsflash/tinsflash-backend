<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TINSFLASH ‚Ä¢ Pr√©visions & Alertes les plus pr√©cises et en temps r√©el ‚Äì Monde</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="index.css" />
  <script defer src="index.js"></script>
  <style>
    body { margin:0;font-family:"Segoe UI",sans-serif;background:#0c1220;color:#eee; }
    header { text-align:center;padding:15px;background:linear-gradient(90deg,#18243b,#101725);
             color:#4fc3f7;font-size:1.6em;font-weight:bold; }
    video { width:100%;max-height:260px;object-fit:cover;display:block; }
    main { padding:20px;max-width:1200px;margin:auto; }
    h2 { color:#4fc3f7;border-left:4px solid #4fc3f7;padding-left:10px;margin-top:30px; }
    p.intro { text-align:justify;color:#ccc;font-size:1.05em;line-height:1.6em;margin-bottom:30px; }
    .forecast-section { display:flex;flex-wrap:wrap;gap:20px;justify-content:space-between; }
    .forecast-box { background:#131a2b;border-radius:10px;padding:15px;flex:1;min-width:300px;
                    box-shadow:0 0 10px rgba(0,0,0,0.3); }
    .map-container { height:360px;margin:25px 0;border-radius:10px;overflow:hidden;
                     box-shadow:0 0 12px rgba(0,0,0,0.4); }
    iframe { width:100%;height:450px;border:none;margin-top:25px;border-radius:10px; }
    footer { text-align:center;background:#111827;color:#ccc;padding:15px;font-size:0.9em; }
    footer a { color:#4fc3f7;text-decoration:none; }
    footer a:hover { text-decoration:underline; }
    .banner { background:#16233a;color:#4fc3f7;padding:12px;text-align:center;
              font-weight:bold;margin-top:20px;border-radius:8px; }

    /* Avatar J.E.A.N */
    .avatar-jean { float:right;width:110px;margin-left:15px;border-radius:50%;
                   box-shadow:0 0 25px rgba(79,195,247,0.4); }
    /* Zone g√©oloc */
    #geo-form { margin:15px 0;padding:10px;background:#131a2b;border-radius:8px; }
    #geo-form input { padding:6px;border:none;border-radius:6px;margin-right:8px; }
    #geo-form button { background:#4fc3f7;color:#000;border:none;padding:6px 10px;
                       border-radius:6px;font-weight:bold;cursor:pointer; }
  </style>
</head>
<body>
  <header>TINSFLASH ‚Ä¢ Pr√©visions & Alertes les plus precises et en temps r√©el ‚Äì Monde</header>

  <div class="banner">
    üåå Donn√©es issues de mod√®les m√©t√©orologiques, intelligences artificielles,
    images satellites et sp√©cificit√©s locales (relief, altitude, climat r√©gional).
  </div>

  <video autoplay muted loop playsinline>
    <source src="intro-jean.mp4" type="video/mp4" />
  </video>

  <main>
    <h2>Pr√©sentation du syst√®me J.E.A.N.</h2>
    <img src="avatars/jean-default.png" alt="J.E.A.N" class="avatar-jean" />
    <p class="intro">
      Le <strong>Syst√®me J.E.A.N.</strong> croise en temps r√©el les donn√©es satellites,
      mod√®les num√©riques et les mod√®les g√©n√©r√©s par l'intelligences artificielles multi-sources.
      Il analyse le relief, l‚Äôhumidit√©, la temp√©rature du sol et les microclimats
      pour fournir des pr√©visions <strong> les plus fiables, locales, nationales et mondiales</strong>,
      tout en anticipant les anomalies m√©t√©orologiques susceptibles d‚Äô√©voluer en alertes et avant les autres!
    </p>

    <h2>Votre position</h2>
    <div id="geo-form">
      <button onclick="getLocation()">üìç Activer la g√©olocalisation</button>
      ou entrez manuellement :
      <input type="text" id="manualAddress" placeholder="Rue, Ville, Pays" />
      <button onclick="setManualAddress()">Valider</button>
      <p id="geo-status" style="color:#4fc3f7;font-size:0.9em;"></p>
    </div>

    <h2>Pr√©visions du jour</h2>
    <div class="forecast-section">
      <div class="forecast-box">
        <h3>üåç Locales</h3>
        <div id="local-forecast">Chargement...</div>
      </div>
      <div class="forecast-box">
        <h3>üì° Nationales</h3>
        <div id="national-forecast">Chargement...</div>
      </div>
    </div>

    <h2>Pr√©visions sur 7 jours</h2>
    <div class="forecast-box" id="forecast-7days">Chargement...</div>

    <h2>Alertes actives</h2>
    <div id="alerts">Chargement des alertes...</div>

    <h2>Carte couverture des pr√©visions</h2>
    <div id="map-forecast" class="map-container"></div>

    <h2>Carte mondiale des alertes</h2>
    <div id="map-alerts" class="map-container"></div>

    <iframe
      src="https://embed.windy.com/embed2.html?lat=20&lon=10&zoom=2&level=surface&overlay=rain&menu=true&marker=false&calendar=24&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default"
      loading="lazy"
    ></iframe>

    <div class="banner">
      üîß Pour vos diagnostics et d√©tections de fuites :
      <a href="https://www.uman-detect.com" target="_blank">Uman-Detect.com</a>
    </div>
  </main>

  <footer>
    ¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s<br />
    üìß <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> |
    üí¨ WhatsApp :
    <a href="https://wa.me/32473264477" target="_blank">+32 473 26 44 77</a><br />
    <em>Contactez-nous pour tout partenariat ou achat du moteur J.E.A.N.</em>
  </footer>

  <script>
    // === G√©olocalisation ===
    async function getLocation() {
      const status = document.getElementById("geo-status");
      if (!navigator.geolocation) {
        status.textContent = "‚ö†Ô∏è G√©olocalisation non support√©e.";
        return;
      }
      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const lat = pos.coords.latitude, lon = pos.coords.longitude;
          status.textContent = `‚úÖ Position d√©tect√©e (${lat.toFixed(2)}, ${lon.toFixed(2)})`;
          sessionStorage.setItem("geoPos", JSON.stringify({ lat, lon }));
        },
        (err) => (status.textContent = "‚ùå Erreur g√©olocalisation : " + err.message)
      );
    }

    function setManualAddress() {
      const addr = document.getElementById("manualAddress").value.trim();
      if (!addr) return alert("Veuillez saisir une adresse compl√®te");
      document.getElementById("geo-status").textContent = "‚úÖ Adresse enregistr√©e : " + addr;
      sessionStorage.setItem("manualAddress", addr);
    }

    // === Cartes Leaflet ===
    const mapForecast = L.map("map-forecast").setView([20, 10], 2);
    const mapAlerts = L.map("map-alerts").setView([20, 10], 2);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapForecast);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapAlerts);

    // === Couverture pr√©visions ===
    async function loadCoverage() {
      const res = await fetch("/api/status");
      const data = await res.json();
      const covered = data.forecasts?.coveredZones || [];
      const uncovered = data.forecasts?.uncoveredZones || [];

      covered.forEach(z =>
        L.circleMarker([z.lat, z.lon], { color:"#4caf50", radius:6 })
         .addTo(mapForecast)
         .bindPopup(`${z.region} ‚Äì Zone couverte TINSFLASH`)
      );
      uncovered.forEach(z =>
        L.circleMarker([z.lat, z.lon], { color:"#2196f3", radius:6 })
         .addTo(mapForecast)
         .bindPopup(`${z.region} ‚Äì Zone Open Data`)
      );
    }

    // === Alertes ===
    async function loadMapAlerts() {
      const res = await fetch("/api/alerts");
      const alerts = await res.json();
      alerts.forEach(a => {
        const color = a.level === "high" ? "#ff0000" :
                      a.level === "medium" ? "#ff9800" : "#4caf50";
        const marker = L.circleMarker([a.lat || 0, a.lon || 0], { radius:8, color })
          .addTo(mapAlerts)
          .bindPopup(`<b>${a.region || a.country}</b><br>${a.title || "Alerte"}<br>${a.description || ""}`);
        marker.on("click",()=>mapAlerts.setView([a.lat,a.lon],6));
      });
    }

    loadCoverage();
    loadMapAlerts();
    setInterval(loadMapAlerts,60000);
  </script>
</body>
</html>
