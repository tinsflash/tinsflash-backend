<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TINSFLASH Météo – Prévisions et Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6828365665232268"
     crossorigin="anonymous"></script>

  <!-- Styles globaux -->
  <link rel="stylesheet" href="style.css">

  <!-- Leaflet pour radar -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Scripts -->
  <script defer src="app.js"></script>
  <script defer src="radar.js"></script>
</head>
<body>
  <header class="navbar">
    <div class="logo">🌩️ TinsFlash</div>
    <nav>
      <a href="index.html" class="active">Accueil</a>
      <a href="premium.html">Premium</a>
      <a href="pro.html">Pro</a>
      <a href="proplus.html">Pro+</a>
      <a href="cockpit.html">Cockpit</a>
      <a href="account.html">Mon Compte</a>
    </nav>
  </header>

  <main class="container">

    <!-- Prévisions locales (dernière run stockée) -->
    <section class="card" id="local">
      <h2>📍 Prévisions locales</h2>
      <div id="local-content">⏳ Chargement...</div>
    </section>

    <!-- Prévisions nationales (vue moyenne pays) -->
    <section class="card" id="national">
      <h2>🇧🇪 Prévisions nationales</h2>
      <div id="national-content">⏳ Chargement...</div>
    </section>

    <!-- Prévisions 7 jours -->
    <section class="card wide" id="seven-days">
      <h2>📅 Prévisions 7 jours</h2>
      <div id="days-container" class="days-grid">⏳ Chargement...</div>
    </section>

    <!-- Bulletin texte -->
    <section class="card" id="forecast-text-section">
      <h2>📰 Bulletin météo</h2>
      <pre id="forecast-text">⏳ Génération...</pre>
    </section>

    <!-- Radar -->
    <section class="card wide" id="radar">
      <h2>🛰️ Radar en direct</h2>
      <div id="radar-map" style="height:400px;border-radius:10px;">⏳ Radar...</div>
    </section>

    <!-- Alertes -->
    <section class="card" id="alerts">
      <h2>⚠️ Alertes météo</h2>
      <div id="alerts-content">⏳ Chargement...</div>
    </section>

    <!-- Podcast -->
    <section class="card" id="podcast">
      <h2>🎙️ Podcast météo</h2>
      <div id="podcast-container">⏳ Génération...</div>
    </section>

  </main>

  <footer class="footer">
    <p>© 2025 TinsFlash – La météo qui vous protège ⚡</p>
  </footer>

  <script>
    // Charger les prévisions depuis la dernière run stockée
    async function loadForecast() {
      try {
        const res = await fetch("/api/forecast/latest");
        const data = await res.json();

        if (data.error) {
          document.getElementById("local-content").innerText = "❌ " + data.error;
          return;
        }

        // Prévision locale
        document.getElementById("local-content").innerText =
          `🌡️ ${data.temperature_min}°C - ${data.temperature_max}°C | ` +
          `Vent ${data.wind} km/h | Précipitations ${data.precipitation} mm | ` +
          `Fiabilité ${data.reliability}%`;

        // Prévision nationale (simplifiée)
        document.getElementById("national-content").innerText =
          `🇧🇪 ${data.description || "Résumé indisponible"}`;

        // Prévisions 7 jours → simulation
        const daysContainer = document.getElementById("days-container");
        daysContainer.innerHTML = "";
        const now = new Date();
        for (let i = 0; i < 7; i++) {
          const d = new Date();
          d.setDate(now.getDate() + i);
          const dayBox = document.createElement("div");
          dayBox.className = "card";
          dayBox.innerText = `${d.toLocaleDateString("fr-FR", { weekday: "long" })} :
            ${data.temperature_min}°C - ${data.temperature_max}°C, Vent ${data.wind} km/h`;
          daysContainer.appendChild(dayBox);
        }

        // Bulletin texte IA
        document.getElementById("forecast-text").innerText =
          data.description || "Analyse météo indisponible.";
      } catch (err) {
        document.getElementById("local-content").innerText = "❌ Erreur chargement prévisions";
      }
    }

    document.addEventListener("DOMContentLoaded", loadForecast);
  </script>
</body>
</html>
