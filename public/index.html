<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <title>TINSFLASH ‚Äì Pr√©visions & Alertes IA</title>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8204947691352732" crossorigin="anonymous"></script>
  <link rel="icon" href="favicon.ico" />
  <style>
    body { margin:0; font-family: 'Segoe UI', sans-serif; background:#0a0e18; color:#e4e4e4; }
    h1,h2 { color:#4fc3f7; }
    section { margin:20px auto; max-width:900px; padding:15px; background:#101728; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.3); }
    video { width:100%; height:220px; object-fit:cover; display:block; border:none; }
    p { text-align:justify; line-height:1.6; }
    .forecast-grid { display:flex; flex-wrap:wrap; gap:8px; }
    .forecast-card { flex:1 1 90px; background:#1a2338; border-radius:10px; text-align:center; padding:8px; }
    .forecast-card img { width:40px; height:40px; }
    iframe { width:100%; height:300px; border:none; border-radius:10px; }
    footer { background:#080b13; color:#999; padding:20px; text-align:center; font-size:14px; }
    a { color:#4fc3f7; text-decoration:none; }
    /* üåç Cartes mondiales */
    #worldForecast, #worldAlerts { height:320px; border-radius:12px; overflow:hidden; margin-bottom:20px; }
    /* ü§ñ Avatar J.E.A.N */
    #jean-avatar {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 60px;
      cursor: pointer;
      z-index: 1000;
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(79,195,247,0.5);
      animation: pulse 2s infinite ease-in-out;
    }
    @keyframes pulse {
      0% { box-shadow:0 0 10px rgba(79,195,247,0.3); transform:scale(1); }
      50% { box-shadow:0 0 25px rgba(79,195,247,0.6); transform:scale(1.05); }
      100% { box-shadow:0 0 10px rgba(79,195,247,0.3); transform:scale(1); }
    }
    #chatbox {
      display:none;
      position:fixed; bottom:150px; right:25px;
      background:#111831; border-radius:12px; width:320px; height:400px;
      box-shadow:0 0 15px rgba(0,0,0,0.6);
      overflow:hidden; flex-direction:column; z-index:2000;
    }
    #chatbox header {
      background:#4fc3f7; color:#000; padding:8px; font-weight:bold;
      text-align:center;
    }
    #chatbox-messages {
      flex:1; padding:10px; overflow-y:auto; font-size:14px;
    }
    #chatbox input { width:100%; padding:8px; border:none; outline:none; }
  </style>
</head>

<body>
  <!-- üé¨ Vid√©o intro -->
  <video autoplay muted loop playsinline>
    <source src="intro-jean.mp4" type="video/mp4" />
  </video>

  <!-- üåç Introduction -->
  <section>
    <h1>üåç Bienvenue sur TINSFLASH</h1>
    <p>
      TINSFLASH croise les mod√®les m√©t√©orologiques internationaux et notre moteur IA multi-sources 
      de nouvelle g√©n√©ration, baptis√© <b>J.E.A.N.</b> ‚Äì <i>Joint Engine for Advanced Nowcasting</i> ‚Äì 
      pour fournir <b>des pr√©visions fiables, locales et nationales,</b> 
      adapt√©es √† ta position. Re√ßois aussi <b>des alertes anticip√©es</b> d√©tect√©es 
      par notre syst√®me d‚Äôanalyse climatique mondial.
    </p>
  </section>

  <!-- üìç Pr√©visions locales -->
  <section>
    <h2>üìç Pr√©visions locales du jour</h2>
    <div class="forecast-grid" id="local-today"></div>

    <h2>üìÜ Pr√©visions locales ‚Äì 7 jours</h2>
    <div class="forecast-grid" id="local-week"></div>
  </section>

  <!-- üá™üá∫ Pr√©visions nationales -->
  <section>
    <h2>‚òÅÔ∏è Pr√©visions nationales du jour</h2>
    <div class="forecast-grid" id="national-today"></div>

    <h2>üìÜ Pr√©visions nationales ‚Äì 7 jours</h2>
    <div class="forecast-grid" id="national-week"></div>
  </section>

  <!-- üö® Alertes locales et nationales -->
  <section>
    <h2>üö® Alertes locales & nationales</h2>
    <ul id="alerts"></ul>
  </section>

  <!-- üåç Carte du monde ‚Äì Pr√©visions -->
  <section>
    <h2>üåé Carte mondiale des pr√©visions</h2>
    <div id="worldForecast"></div>
  </section>

  <!-- üå™Ô∏è Carte du monde ‚Äì Alertes -->
  <section>
    <h2>üå™Ô∏è Carte mondiale des alertes</h2>
    <div id="worldAlerts"></div>
  </section>

  <!-- üåßÔ∏è Radar Windy -->
  <section>
    <h2>üåßÔ∏è Radar en direct</h2>
    <iframe src="https://embed.windy.com/embed2.html?lat=50.4&lon=4.8&zoom=5&level=surface&overlay=rain&menu=&message=true&marker=&calendar=now&pressure=true&type=map&location=coordinates&detail=true&detailLat=50.4&detailLon=4.8&metricWind=km/h&metricTemp=¬∞C&radarRange=-1" loading="lazy"></iframe>
  </section>

  <!-- üß† Avatar J.E.A.N -->
  <img id="jean-avatar" src="avatars/jean-default.png" alt="Assistant J.E.A.N" onclick="toggleChat()" />

  <!-- üí¨ Chat Cohere -->
  <div id="chatbox">
    <header>ü§ñ J.E.A.N ‚Äì Assistant IA</header>
    <div id="chatbox-messages"></div>
    <input type="text" id="chatbox-input" placeholder="Discuter avec J.E.A.N..." />
  </div>

  <footer>
    ¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s.<br />
    Contact : <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> | 
    WhatsApp : <a href="https://wa.me/32473264477">+32 473 26 44 77</a><br />
    üíº Partenariats & int√©grations moteur IA m√©t√©o : <a href="https://www.uman-detect.com" target="_blank">Uman-Detect</a>
  </footer>

  <!-- üß† JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <script>
    // === Cartes Leaflet ===
    const map1 = L.map('worldForecast').setView([20, 0], 2);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 6 }).addTo(map1);

    const map2 = L.map('worldAlerts').setView([20, 0], 2);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 6 }).addTo(map2);

    // === Chargement pr√©visions & alertes ===
    async function loadForecasts() {
      const res = await fetch('/api/status');
      const data = await res.json();
      document.getElementById('local-today').innerHTML =
        `<div class='forecast-card'><img src='icons/sun.png'><div>${new Date().toLocaleDateString()}</div></div>`;
      document.getElementById('national-today').innerHTML =
        `<div class='forecast-card'><img src='icons/cloud.png'><div>${new Date().toLocaleDateString()}</div></div>`;
      if (data.alerts) {
        document.getElementById('alerts').innerHTML =
          data.alerts.map(a => `<li>${a.zone}: <b>${a.level}</b> ‚Äì ${a.message}</li>`).join('');
      }
    }
    loadForecasts();

    // === Chat J.E.A.N (Cohere) ===
    const chatbox = document.getElementById("chatbox");
    const chatInput = document.getElementById("chatbox-input");
    const chatMessages = document.getElementById("chatbox-messages");
    function toggleChat() {
      chatbox.style.display = (chatbox.style.display === "none" || !chatbox.style.display) ? "flex" : "none";
    }
    async function sendToJean(msg) {
      const res = await fetch("/api/jean", {
        method: "POST", headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ message: msg })
      });
      const data = await res.json();
      return data.reply || "Pas de r√©ponse.";
    }
    chatInput.addEventListener("keypress", async e => {
      if (e.key === "Enter") {
        const msg = chatInput.value.trim();
        if (!msg) return;
        chatMessages.innerHTML += `<div><b>Moi:</b> ${msg}</div>`;
        chatInput.value = "";
        const reply = await sendToJean(msg);
        chatMessages.innerHTML += `<div><b>J.E.A.N:</b> ${reply}</div>`;
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    });
  </script>
</body>
</html>
