<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TINSFLASH ‚Äì Pr√©visions & Alertes M√©t√©o IA</title>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6828365665232268"
     crossorigin="anonymous"></script>

  <style>
    body { margin:0; font-family:"Segoe UI",sans-serif; background:#0d1117; color:#e6edf3; }
    header { position:relative; text-align:center; }
    video#intro { width:100%; max-height:380px; object-fit:cover; }
    h1 { margin:10px 0; color:#58a6ff; }
    main { padding:15px; max-width:1100px; margin:auto; }

    .card { background:#161b22; padding:12px; border-radius:8px; margin-bottom:16px; box-shadow:0 2px 6px rgba(0,0,0,0.4); }
    h2 { color:#79c0ff; margin:0 0 8px; font-size:1.1rem; }
    p { margin:5px 0; }

    /* Fan club */
    #fanclub { background:#111827; padding:15px; border-radius:10px; text-align:center; }
    #fanclub input { padding:8px; border:none; border-radius:6px; margin-right:6px; }
    #fanclub button { padding:8px 12px; background:#238636; border:none; border-radius:6px; color:#fff; cursor:pointer; }
    #fanclub small { display:block; font-size:0.7rem; color:#9ca3af; margin-top:5px; }

    /* Premium flottant */
    #premium-float {
      position:fixed; bottom:80px; right:15px; background:#ffcc00; color:#111;
      padding:10px 16px; border-radius:30px; box-shadow:0 0 10px rgba(0,0,0,0.5);
      animation:blink 1.2s infinite alternate; font-weight:bold; z-index:9999;
    }
    @keyframes blink { from{opacity:1;} to{opacity:0.4;} }

    /* Avatar J.E.A.N */
    #avatar-jean {
      position:fixed; bottom:20px; right:20px; width:90px; height:90px; cursor:pointer; z-index:9998;
    }

    /* Chat box */
    #chat-box {
      position:fixed; bottom:120px; right:20px; width:280px; height:330px; background:#fff;
      border-radius:10px; display:none; flex-direction:column; box-shadow:0 2px 8px rgba(0,0,0,0.4);
    }
    #chat-header { background:#238636; color:#fff; padding:6px; font-size:0.9rem; border-radius:10px 10px 0 0; }
    #chat-messages { flex:1; overflow-y:auto; padding:6px; color:#111; font-size:0.85rem; }
    #chat-input { display:flex; }
    #chat-input input { flex:1; border:none; padding:5px; }
    #chat-input button { background:#238636; border:none; color:#fff; padding:5px 8px; cursor:pointer; }

    /* Radar */
    iframe#radar { width:100%; height:450px; border:none; border-radius:10px; }

    footer { text-align:center; padding:15px; color:#aaa; font-size:0.85rem; }
    a { color:#58a6ff; text-decoration:none; }

    .upgrade-banner {
      background:#111827; border-left:4px solid #ffcc00; padding:10px; border-radius:8px; text-align:center;
      margin-bottom:15px;
    }
    .upgrade-btn {
      display:inline-block; background:#ffcc00; color:#111; padding:8px 14px; border-radius:6px; font-weight:bold;
      margin-top:8px; text-decoration:none;
    }
  </style>
</head>

<body>
  <header>
    <video id="intro" autoplay muted loop playsinline>
      <source src="intro-jean.mp4" type="video/mp4">
    </video>
    <h1>üå¶Ô∏è TINSFLASH ‚Äì L‚ÄôIA m√©t√©o mondiale la plus pr√©cise</h1>
    <p>Pr√©visions et alertes ultra-fiables, propuls√©es par intelligence artificielle.</p>
  </header>

  <main>
    <!-- Zone manuelle + g√©oloc -->
    <div class="card">
      <h2>üìç Votre position</h2>
      <button onclick="getLocation()">Activer ma g√©olocalisation</button>
      <input type="text" id="manualAddress" placeholder="Ou entrez votre ville..." style="margin-top:5px;width:100%;padding:6px;border-radius:6px;">
      <div id="userPosition" style="margin-top:6px;"></div>
    </div>

    <!-- Pr√©visions -->
    <div class="card">
      <h2>‚òÄÔ∏è Pr√©visions locales</h2>
      <div id="forecast"></div>
    </div>

    <!-- Pub milieu -->
    <div class="card">
      <h2>üí° Publicit√©</h2>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-6828365665232268"
           data-ad-slot="5574293942"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <!-- Alertes -->
    <div class="card">
      <h2>‚ö†Ô∏è Alertes actives</h2>
      <div id="alerts"></div>
    </div>

    <!-- Bulletin -->
    <div class="card">
      <h2>üì∞ Bulletin m√©t√©o</h2>
      <div id="bulletin"></div>
    </div>

    <!-- Radar -->
    <div class="card">
      <h2>üåç Radar en direct</h2>
      <iframe id="radar" src="https://embed.windy.com/embed2.html?lat=50.5&lon=4.7&zoom=6&level=surface&overlay=rain&menu=true&message=true&marker=true&calendar=now"></iframe>
    </div>

    <!-- Pub bas -->
    <div class="card">
      <h2>üí° Publicit√©</h2>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-6828365665232268"
           data-ad-slot="8607759190"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <!-- Fan Club -->
    <div id="fanclub" class="card">
      <h2>‚≠ê TINS‚ÄôFan Club & Avantages</h2>
      <p>Recevez concours exclusifs, alertes prioritaires et cadeaux r√©serv√©s √† la communaut√© m√©t√©o !</p>
      <form id="fanForm" onsubmit="registerFan(event)">
        <input type="email" id="fanEmail" placeholder="Votre email" required>
        <button type="submit">Je m‚Äôinscris</button>
      </form>
      <small>Conforme RGPD ‚Äì vos donn√©es ne seront jamais revendues.</small>
    </div>

    <!-- Zone non couverte -->
    <div id="upgrade-zone" class="upgrade-banner" style="display:none;">
      <h3>üåç Votre pays est actuellement couvert uniquement par nos <span style="color:#ffcc00;">alertes m√©t√©o automatiques</span>.</h3>
      <p>Pour d√©bloquer <strong>les pr√©visions ultra-pr√©cises</strong> de TINSFLASH, passez √† la version <strong>Pro</strong> (7 jours gratuits) !</p>
      <a href="https://buy.stripe.com/dRm4gBeBX9h782p74Bgfu01" class="upgrade-btn" target="_blank">üöÄ Passer Pro maintenant</a>
    </div>
  </main>

  <!-- Avatar + chat -->
  <img id="avatar-jean" src="avatars/jean-sun.png" alt="J.E.A.N" onclick="toggleChat()">
  <div id="chat-box">
    <div id="chat-header">üí¨ Chat m√©t√©o ‚Äì J.E.A.N</div>
    <div id="chat-messages"></div>
    <div id="chat-input">
      <input id="msg" placeholder="Posez votre question m√©t√©o...">
      <button onclick="sendMsg()">Envoyer</button>
    </div>
  </div>

  <!-- Bloc premium flottant -->
  <div id="premium-float" onclick="window.open('https://buy.stripe.com/cNiaEZgK5bpffuRex3gfu00','_blank');">
    ‚ú® Passez Premium / Pro+
  </div>

  <footer>
    ¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s <br>
    üìß <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> | üì± <a href="https://wa.me/32473264477" target="_blank">+32 473 26 44 77</a>
  </footer>

  <script>
    // üåê Multi-langue
    const lang = navigator.language || "fr";
    if (lang.startsWith("en")) document.title = "TINSFLASH ‚Äì AI Weather Engine";
    if (lang.startsWith("es")) document.title = "TINSFLASH ‚Äì Motor Meteorol√≥gico IA";

    // üìç G√©oloc
    async function getLocation(){
      if(!navigator.geolocation) return alert("G√©olocalisation non support√©e");
      navigator.geolocation.getCurrentPosition(async pos=>{
        const {latitude,longitude}=pos.coords;
        document.getElementById("userPosition").innerText=`Latitude ${latitude.toFixed(2)} / Longitude ${longitude.toFixed(2)}`;
        await loadForecast(latitude,longitude);
      });
    }

    // üîÆ Pr√©visions
    async function loadForecast(lat,lon){
      const res = await fetch(`/api/forecast/${encodeURIComponent('Europe')}`);
      const data = await res.json();
      const el=document.getElementById("forecast");
      if(data.forecast){
        el.innerHTML=`<p>Temp√©rature min : ${data.forecast.temp_min} ¬∞C<br>
        Temp√©rature max : ${data.forecast.temp_max} ¬∞C<br>
        Condition : ${data.forecast.condition}</p>`;
      } else {
        el.innerHTML=`<p>Aucune donn√©e de pr√©vision disponible ici.</p>`;
        document.getElementById("upgrade-zone").style.display="block";
      }
    }

    // ‚ö†Ô∏è Alertes
    async function loadAlerts(){
      const res = await fetch("/api/alerts");
      const alerts = await res.json();
      const box=document.getElementById("alerts");
      if(!alerts.length) box.innerHTML="<p>Aucune alerte active.</p>";
      else box.innerHTML = alerts.map(a=>`<div>üî¥ <b>${a.country||a.region}</b> ‚Äì ${a.data?.summary||'Alerte m√©t√©o'}</div>`).join("");
    }
    loadAlerts();

    // üí¨ Chat J.E.A.N
    function toggleChat(){
      const c=document.getElementById("chat-box");
      c.style.display=c.style.display==="flex"?"none":"flex";
    }
    async function sendMsg(){
      const msg=document.getElementById("msg").value.trim();
      if(!msg)return;
      const chat=document.getElementById("chat-messages");
      chat.innerHTML+=`<div><b>Moi :</b> ${msg}</div>`;
      document.getElementById("msg").value="";
      const res=await fetch("/api/jean",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:msg})});
      const data=await res.json();
      chat.innerHTML+=`<div><b>J.E.A.N :</b> ${data.reply}</div>`;
      chat.scrollTop=chat.scrollHeight;
    }

    // üíå Fan club
    async function registerFan(e){
      e.preventDefault();
      const email=document.getElementById("fanEmail").value;
      const geo=document.getElementById("userPosition").innerText;
      await fetch("/api/register-fan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,geo})});
      alert("Bienvenue dans le TINS‚ÄôFan Club !");
      document.getElementById("fanEmail").value="";
    }
  </script>
</body>
</html>
