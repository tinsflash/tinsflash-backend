<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tinsflash ‚Äì Pr√©visions M√©t√©o</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0a0a0a;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    header {
      background: #111;
      padding: 20px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: cyan;
    }
    main {
      padding: 15px;
      max-width: 900px;
      margin: auto;
    }
    .card {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
    }
    h2 {
      color: cyan;
      margin-bottom: 10px;
      text-align: center;
    }
    .forecast {
      font-size: 1rem;
      line-height: 1.4;
      white-space: pre-line;
    }
    iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 12px;
    }
  </style>
</head>
<body>
  <header>üåç Tinsflash ‚Äì Pr√©visions m√©t√©o</header>
  <main>
    <!-- Pr√©visions du jour -->
    <div class="card">
      <h2>üå§Ô∏è Pr√©visions du jour</h2>
      <div id="todayForecast" class="forecast">Chargement...</div>
    </div>

    <!-- Pr√©visions 7 jours -->
    <div class="card">
      <h2>üìÖ Pr√©visions 7 jours</h2>
      <div id="weekForecast" class="forecast">Chargement...</div>
    </div>

    <!-- Bulletin m√©t√©o local + national -->
    <div class="card">
      <h2>üì∞ Bulletin m√©t√©o</h2>
      <div id="bulletinText" class="forecast">
        Bulletin m√©t√©o en attente...
      </div>
    </div>

    <!-- Radar -->
    <div class="card">
      <h2>üì° Radar en temps r√©el</h2>
      <iframe src="https://embed.windy.com/embed2.html?lat=50.5&lon=4.7&zoom=5&level=surface&overlay=rain&menu=&message=true&calendar=&pressure=&type=map&location=coordinates&detail=true&detailLat=50.5&detailLon=4.7&metricWind=km/h&metricTemp=¬∞C&radarRange=-1"></iframe>
    </div>
  </main>

  <script>
    async function loadForecasts() {
      try {
        const today = await fetch("/api/forecast/local?lat=50.5&lon=4.7");
        const todayData = await today.json();
        document.getElementById("todayForecast").textContent =
          todayData.bulletinLocal || "‚ùå Pr√©vision locale indisponible.";

        const week = await fetch("/api/forecast/7days?lat=50.5&lon=4.7");
        const weekData = await week.json();
        document.getElementById("weekForecast").textContent =
          weekData.bulletin7days || "‚ùå Pr√©visions 7 jours indisponibles.";
      } catch (err) {
        document.getElementById("todayForecast").textContent = "‚ùå Erreur chargement pr√©visions locales";
        document.getElementById("weekForecast").textContent = "‚ùå Erreur chargement pr√©visions 7 jours";
      }
    }

    async function loadBulletin() {
      try {
        const res = await fetch("/bulletin.json");
        if (!res.ok) throw new Error("Bulletin indisponible");
        const data = await res.json();
        document.getElementById("bulletinText").textContent = data.bulletin || "‚ö†Ô∏è Bulletin m√©t√©o vide.";
      } catch {
        document.getElementById("bulletinText").textContent = "‚ö†Ô∏è Bulletin m√©t√©o non encore publi√©.";
      }
    }

    // Lancement initial
    loadForecasts();
    loadBulletin();
  </script>
</body>
</html>
