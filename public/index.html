<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TINSFLASH ‚Äì Pr√©visions et Alertes m√©t√©o IA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      color: #111;
    }
    header {
      position: relative;
      height: 250px;
      overflow: hidden;
    }
    header video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    header h1 {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: white;
      font-size: 2rem;
      text-shadow: 0 0 8px rgba(0,0,0,0.8);
    }
    main {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    h2 {
      color: #2563eb;
      margin-top: 40px;
      border-bottom: 2px solid #2563eb;
      padding-bottom: 5px;
    }
    .forecast-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    .forecast-card {
      background: white;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    .forecast-card img {
      width: 60px;
      margin-bottom: 5px;
    }
    .ads {
      margin: 20px 0;
      text-align: center;
    }
    iframe {
      border: none;
    }
    /* Chat J.E.A.N */
    #avatar-papa {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 120px;
      height: 120px;
      cursor: pointer;
      z-index: 9999;
    }
    #chat-jean {
      position: fixed;
      bottom: 160px;
      right: 20px;
      width: 320px;
      height: 400px;
      background: #0b0f1a;
      color: #fff;
      border-radius: 10px;
      display: none;
      flex-direction: column;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      font-family: Arial, sans-serif;
      z-index: 10000;
    }
    #chat-jean header {
      padding: 10px;
      background: #111827;
      font-weight: bold;
      color: #38bdf8;
      border-bottom: 1px solid #1f2937;
    }
    #messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      font-size: 0.9rem;
    }
    #chat-jean input {
      flex: 1;
      padding: 8px;
      border: none;
      outline: none;
      background: #1f2937;
      color: white;
    }
    #chat-jean button {
      background:#2563eb;
      border:none;
      color:white;
      padding:8px 12px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <!-- Bandeau vid√©o -->
  <header>
    <video autoplay muted loop playsinline>
      <source src="intro-jean.mp4" type="video/mp4">
    </video>
    <h1>TINSFLASH ‚Äì La m√©t√©o la plus pr√©cise du monde</h1>
  </header>

  <main>
    <p>
      Gr√¢ce √† notre moteur m√©t√©orologique r√©volutionnaire, TINSFLASH fournit
      <strong>les pr√©visions locales et nationales les plus fiables au monde</strong>,
      ainsi que des alertes pr√©cises et anticip√©es.
    </p>

    <!-- Pr√©visions locales -->
    <h2>üåç Pr√©visions locales</h2>
    <div id="localForecast" class="forecast-section">
      <div>Chargement en cours...</div>
    </div>

    <!-- Pr√©visions nationales -->
    <h2>üá´üá∑ Pr√©visions nationales</h2>
    <div id="nationalForecast" class="forecast-section">
      <div>Chargement en cours...</div>
    </div>

    <!-- Radar -->
    <h2>üì° Radar m√©t√©o</h2>
    <iframe src="https://embed.windy.com/embed2.html?lat=50&lon=4&detailLat=50&detailLon=4&width=100%&height=450&zoom=6&level=surface&overlay=rain&product=ecmwf&menu=&message=true&marker=true&calendar=24&pressure=true&type=map&location=coordinates&detail=true&metricWind=default&metricTemp=default&radarRange=-1"
      width="100%" height="450"></iframe>

    <!-- Publicit√© -->
    <div class="ads">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-8204947691352732"
           data-ad-slot="9437146866"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
    </div>
  </main>

  <!-- Lottie Avatar J.E.A.N -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <div id="avatar-papa">
    <lottie-player 
      src="https://assets10.lottiefiles.com/packages/lf20_j1adxtyb.json"
      background="transparent"
      speed="1"
      loop
      autoplay>
    </lottie-player>
  </div>

  <!-- Chat J.E.A.N -->
  <div id="chat-jean">
    <header>ü§ñ J.E.A.N. ‚Äì Assistant m√©t√©o</header>
    <div id="messages"></div>
    <div style="display:flex; border-top:1px solid #1f2937;">
      <input id="userInput" type="text" placeholder="Pose ta question m√©t√©o...">
      <button onclick="sendMessage()">Envoyer</button>
    </div>
  </div>

  <script>
    const avatar = document.getElementById("avatar-papa");
    const chat = document.getElementById("chat-jean");
    const messages = document.getElementById("messages");
    const userInput = document.getElementById("userInput");

    avatar.addEventListener("click", () => {
      chat.style.display = chat.style.display === "flex" ? "none" : "flex";
    });

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage("üßë‚Äçüíª", text);
      userInput.value = "";

      try {
        const res = await fetch("/api/jean", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        if (data.success) {
          addMessage("ü§ñ", data.reply);
          speak(data.reply);
        } else {
          addMessage("‚ùå", "Erreur: " + data.error);
        }
      } catch (err) {
        addMessage("‚ùå", "Probl√®me de connexion avec J.E.A.N.");
      }
    }

    function addMessage(sender, text) {
      const div = document.createElement("div");
      div.style.margin = "5px 0";
      div.innerHTML = `<b>${sender}</b>: ${text}`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    // Synth√®se vocale (voix grave masculine si dispo)
    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "fr-FR";
      utterance.pitch = 0.8;
      utterance.rate = 1;
      utterance.voice = speechSynthesis.getVoices().find(v => v.name.includes("Thomas") || v.name.includes("Google fran√ßais"));
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
