<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üå¶Ô∏è TINSFLASH ‚Äì Pr√©visions & Alertes m√©t√©o mondiales</title>

  <!-- ‚úÖ Google AdSense (Auto Ads g√©r√©s par Google) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6828365665232268" crossorigin="anonymous"></script>

  <!-- ‚úÖ Lottie -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <!-- ‚úÖ Leaflet (carte radar Windy) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(180deg, #eaf3ff, #cce0ff);
      color: #002b5c;
    }
    header {
      text-align: center;
      padding: 10px 0;
    }
    header h1 {
      font-size: 1.8rem;
      color: #004b91;
      margin: 0;
    }
    video {
      width: 100%;
      border: none;
      border-radius: 0;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 10px;
    }
    h2 {
      color: #004b91;
      font-size: 1.2rem;
      margin-top: 20px;
    }
    input, button, select {
      padding: 8px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #0078d7;
      color: #fff;
      cursor: pointer;
    }
    button:hover { background: #005ea6; }

    .forecast, .alerts, .bulletin {
      background: #ffffffb0;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    #radar {
      height: 350px;
      border-radius: 10px;
      overflow: hidden;
    }

    footer {
      background: #004b91;
      color: #fff;
      text-align: center;
      padding: 15px;
      margin-top: 20px;
      font-size: 0.9rem;
    }

    /* ‚úÖ Avatar J.E.A.N */
    #avatar-jean {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 80px;
      height: 80px;
      cursor: pointer;
      z-index: 9999;
    }

    #chat-box {
      position: fixed;
      bottom: 170px;
      right: 20px;
      width: 300px;
      height: 380px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
      display: none;
      flex-direction: column;
      z-index: 10000;
    }

    #chat-header {
      background: #0078d7;
      color: white;
      padding: 8px;
      border-radius: 12px 12px 0 0;
      text-align: center;
      font-weight: bold;
    }

    #chat-messages {
      flex: 1;
      padding: 8px;
      overflow-y: auto;
      font-size: 0.9rem;
    }

    #chat-input {
      display: flex;
    }

    #chat-input input {
      flex: 1;
      border: none;
      border-top: 1px solid #ddd;
      padding: 6px;
    }

    #chat-input button {
      background: #0078d7;
      border: none;
      color: white;
      padding: 6px 10px;
    }

    /* ‚úÖ Bouton Premium flottant */
    #premium-float {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #ffcc00;
      color: #002b5c;
      padding: 10px 15px;
      border-radius: 50px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      font-weight: bold;
      cursor: pointer;
      animation: pulse 1.5s infinite;
      z-index: 9999;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255,204,0,0.7); }
      70% { box-shadow: 0 0 0 15px rgba(255,204,0,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,204,0,0); }
    }

    /* ‚úÖ Fan Club */
    .fanclub {
      background: #f8fbff;
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
      text-align: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>
  <header>
    <h1>üåé TINSFLASH ‚Äì Pr√©visions et alertes m√©t√©o en temps r√©el</h1>
  </header>

  <!-- ‚úÖ Vid√©o bandeau -->
  <video autoplay muted loop playsinline>
    <source src="/videos/intro-jean.mp4" type="video/mp4" />
  </video>

  <div class="container">
    <p>Bienvenue sur <strong>TINSFLASH</strong>, la plateforme m√©t√©o la plus connect√©e du monde üåç<br>
    Pr√©visions locales et nationales ultra-pr√©cises, alertes automatiques en temps r√©el, radar haute r√©solution et intelligence m√©t√©o J.E.A.N. int√©gr√©e.</p>

    <!-- ‚úÖ Adresse manuelle + g√©olocalisation -->
    <h2>üìç Localisation</h2>
    <input type="text" id="manualAddress" placeholder="Entrez votre ville ou adresse">
    <button onclick="getForecastManual()">Valider</button>
    <button onclick="getGeo()">üì° Activer la g√©olocalisation</button>

    <!-- ‚úÖ Pr√©visions -->
    <div class="forecast">
      <h2>üå§Ô∏è Pr√©visions locales</h2>
      <div id="forecast-today">Chargement des pr√©visions...</div>
      <div id="forecast-week"></div>
    </div>

    <!-- ‚úÖ Alertes -->
    <div class="alerts">
      <h2>üö® Alertes m√©t√©o</h2>
      <div id="alerts-box">Chargement des alertes...</div>
    </div>

    <!-- ‚úÖ Bulletin auto -->
    <div class="bulletin">
      <h2>üì∞ Bulletin automatique</h2>
      <div id="bulletin-text">Analyse m√©t√©o en cours...</div>
    </div>

    <!-- ‚úÖ Fan Club -->
    <div class="fanclub">
      <h3>üéÅ Tins'Fan Club & Avantages</h3>
      <p>Inscrivez-vous pour recevoir les alertes exclusives, participer aux concours et d√©bloquer vos 7 jours Premium gratuits !</p>
      <input type="email" id="fanEmail" placeholder="Votre email">
      <button onclick="registerFan()">Je m‚Äôinscris üéâ</button>
      <p id="fanResult" style="margin-top:5px;font-size:0.9rem;"></p>
    </div>

    <!-- ‚úÖ Radar -->
    <h2>üåßÔ∏è Radar interactif</h2>
    <div id="radar"></div>
  </div>

  <!-- ‚úÖ Avatar J.E.A.N -->
  <div id="avatar-jean" onclick="toggleChat()">
    <img src="/avatars/jean-default.png" alt="J.E.A.N Avatar" style="width:80px;height:80px;border-radius:50%;">
  </div>

  <!-- ‚úÖ Chat Cohere -->
  <div id="chat-box">
    <div id="chat-header">üí¨ J.E.A.N (IA m√©t√©o)</div>
    <div id="chat-messages"></div>
    <div id="chat-input">
      <input type="text" id="chat-input-text" placeholder="Demandez √† J.E.A.N...">
      <button onclick="sendChat()">Envoyer</button>
    </div>
  </div>

  <!-- ‚úÖ Bouton Premium -->
  <div id="premium-float" onclick="window.open('https://buy.stripe.com/dRm4gBeBX9h782p74Bgfu01','_blank')">
    ‚≠ê Passez Premium ou Pro pour + de fonctions exclusives !
  </div>

  <!-- ‚úÖ Footer -->
  <footer>
    ¬© 2025 TINSFLASH | Contact : <a href="mailto:skysnapia@gmail.com" style="color:white;">skysnapia@gmail.com</a> | WhatsApp : 
    <a href="https://wa.me/32473264477" style="color:white;">+32 473 26 44 77</a>
  </footer>

  <script>
    // === GEOLOCALISATION ===
    function getGeo() {
      if (!navigator.geolocation) {
        alert("La g√©olocalisation n‚Äôest pas support√©e par votre navigateur.");
        return;
      }
      navigator.geolocation.getCurrentPosition(async pos => {
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        document.getElementById("manualAddress").value = `${lat},${lon}`;
        await getForecast(lat, lon);
      }, err => alert("Erreur g√©olocalisation : " + err.message));
    }

    // === PREVISIONS ===
    async function getForecastManual() {
      const address = document.getElementById("manualAddress").value;
      if (!address) return alert("Veuillez entrer une adresse.");
      getForecast(address);
    }

    async function getForecast(query) {
      document.getElementById("forecast-today").innerText = "Chargement...";
      const res = await fetch("/api/forecast/Europe");
      const data = await res.json();
      document.getElementById("forecast-today").innerText = data.forecast?.today || "Pr√©visions indisponibles.";
      document.getElementById("forecast-week").innerText = data.forecast?.week || "";
    }

    // === ALERTES ===
    async function loadAlerts() {
      const res = await fetch("/api/alerts");
      const alerts = await res.json();
      const box = document.getElementById("alerts-box");
      if (!alerts.length) return box.innerHTML = "Aucune alerte en cours.";
      box.innerHTML = alerts.map(a => `<div>‚ö†Ô∏è <b>${a.country}</b> ‚Äì ${a.message || 'Alerte en cours'}</div>`).join("");
    }

    // === BULLETIN ===
    function generateBulletin() {
      document.getElementById("bulletin-text").innerText =
        "Le bulletin est g√©n√©r√© automatiquement √† partir des derni√®res donn√©es m√©t√©o TINSFLASH...";
    }

    // === RADAR ===
    const map = L.map('radar').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    // === CHAT J.E.A.N ===
    function toggleChat() {
      const box = document.getElementById("chat-box");
      box.style.display = box.style.display === "flex" ? "none" : "flex";
    }

    async function sendChat() {
      const input = document.getElementById("chat-input-text");
      const msg = input.value.trim();
      if (!msg) return;
      const messages = document.getElementById("chat-messages");
      messages.innerHTML += `<div><b>Moi:</b> ${msg}</div>`;
      input.value = "";

      const res = await fetch("/api/jean", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
      });
      const data = await res.json();
      messages.innerHTML += `<div><b>J.E.A.N:</b> ${data.reply}</div>`;
      messages.scrollTop = messages.scrollHeight;
    }

    // === FAN CLUB ===
    async function registerFan() {
      const email = document.getElementById("fanEmail").value;
      if (!email) return alert("Veuillez entrer votre email.");
      const res = await fetch("/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, fanClub: true, consent: { accepted: true } })
      });
      const data = await res.json();
      document.getElementById("fanResult").innerText = data.message || data.error;
    }

    // AUTOLOAD
    loadAlerts();
    generateBulletin();
  </script>
</body>
</html>
