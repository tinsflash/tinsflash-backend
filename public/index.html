<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TINSFLASH ‚Ä¢ Pr√©visions & Alertes</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #0c1220;
      color: #eee;
    }
    header {
      text-align: center;
      padding: 15px;
      background: linear-gradient(90deg,#08101f,#15294d);
      color: #4fc3f7;
      font-size: 1.6em;
      font-weight: bold;
      text-shadow: 0 0 12px #4fc3f7;
    }
    .subheader {
      text-align: center;
      background:#0d1528;
      color:#7dd3fc;
      padding:6px;
      font-size:0.9em;
    }
    video {
      width: 100%;
      max-height: 260px;
      object-fit: cover;
      display: block;
    }
    main {max-width:1200px;margin:auto;padding:20px;}
    h2 {
      color:#4fc3f7;
      border-left:4px solid #4fc3f7;
      padding-left:10px;
      margin-top:35px;
    }
    p.intro{text-align:justify;color:#ccc;font-size:1.05em;line-height:1.6em;}
    .jean-block{
      display:flex;align-items:center;gap:18px;margin-top:20px;
    }
    .jean-avatar{
      width:90px;height:90px;border-radius:50%;box-shadow:0 0 30px rgba(79,195,247,0.6);
    }
    .forecast-section{display:flex;flex-wrap:wrap;gap:20px;}
    .forecast-box{
      background:#131a2b;border-radius:10px;padding:15px;flex:1;min-width:300px;
      box-shadow:0 0 10px rgba(0,0,0,0.3);
    }
    .forecast-day{border-bottom:1px solid #222;padding:6px 0;}
    .forecast-day:last-child{border:none;}
    .map-container{height:360px;margin:25px 0;border-radius:10px;overflow:hidden;box-shadow:0 0 12px rgba(0,0,0,0.4);}
    .alert-warning{
      background:#facc15;color:#000;text-align:center;font-weight:bold;padding:10px;
      border-radius:6px;animation:blink 1.2s infinite alternate;
    }
    @keyframes blink{from{opacity:1;}to{opacity:0.3;}}
    footer{text-align:center;background:#111827;color:#ccc;padding:15px;font-size:0.9em;}
    footer a{color:#4fc3f7;text-decoration:none;}
    footer a:hover{text-decoration:underline;}
    .btn-ai{
      position:fixed;bottom:20px;right:20px;background:#4fc3f7;color:#000;
      font-weight:bold;border:none;border-radius:20px;padding:10px 18px;cursor:pointer;
      box-shadow:0 0 15px rgba(79,195,247,0.6);
    }
    .chat-box{
      position:fixed;bottom:70px;right:20px;background:#1b2439;border:2px solid #4fc3f7;
      border-radius:12px;width:310px;height:380px;display:none;flex-direction:column;
      box-shadow:0 0 15px rgba(0,0,0,0.5);
    }
    .chat-header{background:#4fc3f7;color:#000;text-align:center;padding:5px;font-weight:bold;}
    .chat-messages{flex:1;padding:8px;overflow-y:auto;font-size:14px;background:#0e1423;}
    .chat-input{display:flex;border-top:1px solid #333;}
    .chat-input input{flex:1;padding:8px;border:none;background:#1b2339;color:#eee;}
    .chat-input button{background:#4fc3f7;border:none;color:#000;padding:8px 12px;font-weight:bold;cursor:pointer;}
    .banner{background:#16233a;color:#4fc3f7;padding:12px;text-align:center;font-weight:bold;margin-top:20px;border-radius:8px;}
  </style>
</head>
<body>
  <header>TINSFLASH ‚Ä¢ Pr√©visions & Alertes</header>
  <div class="subheader">üõ∞ Donn√©es satellites ‚Ä¢ Mod√®les IA multi-sources ‚Ä¢ Sp√©cificit√©s locales (relief, altitude, oc√©ans)</div>

  <video autoplay muted loop playsinline>
    <source src="intro-jean.mp4" type="video/mp4" />
  </video>

  <main>
    <div class="jean-block">
      <img src="jean-default.png" alt="avatar" width="200">
      <h2>Pr√©sentation du syst√®me TINSFLASH syst√®me J.E.A.N.</h2>
    </div>
    <p class="intro">
      Le <strong>Syst√®me J.E.A.N.</strong> croise en temps r√©el les donn√©es satellites, mod√®les num√©riques
      et intelligences artificielles multi-sources. Il analyse le relief, l‚Äôhumidit√©, la temp√©rature du sol
      et les microclimats pour fournir des pr√©visions <strong>fiables, locales, nationales et mondiales</strong>,
      tout en anticipant, souvent avant les autres, les anomalies m√©t√©orologiques susceptibles d‚Äô√©voluer en alertes.
    </p>

    <h2>üìç Votre position</h2>
    <div id="position-status">D√©tection de votre position en cours...</div>
    <input type="text" id="manualAddress" placeholder="Ou entrez votre adresse compl√®te (rue, ville, pays)" style="width:100%;padding:8px;margin-top:8px;border-radius:6px;border:none;background:#1b2339;color:#eee;" />

    <h2>Pr√©visions du jour</h2>
    <div class="forecast-section">
      <div class="forecast-box">
        <h3>üåç Locales</h3>
        <div id="local-today">Chargement...</div>
      </div>
      <div class="forecast-box">
        <h3>üì° Nationales</h3>
        <div id="national-today">Chargement...</div>
      </div>
    </div>

    <h2>Pr√©visions sur 7 jours</h2>
    <div id="forecast-7days" class="forecast-section">Chargement...</div>

    <h2>Alertes actives</h2>
    <div id="alerts">Chargement des alertes...</div>

    <h2>Carte couverture & pr√©visions</h2>
    <div id="map-forecast" class="map-container"></div>

    <h2>Carte mondiale des alertes</h2>
    <div id="map-alerts" class="map-container"></div>

    <div class="banner">
      üîß Pour vos diagnostics et d√©tections de fuites :
      <a href="https://www.uman-detect.com" target="_blank">Uman-Detect.com</a>
    </div>
  </main>

  <footer>
    ¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s<br/>
    üìß <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> |
    üí¨ <a href="https://wa.me/32473264477" target="_blank">WhatsApp +32 473 26 44 77</a><br/>
    <em>Contactez-nous pour partenariat ou acquisition du moteur J.E.A.N.</em>
  </footer>

  <button class="btn-ai" id="btnAI">IA-AI</button>
  <div class="chat-box" id="chatJean">
    <div class="chat-header">Assistant J.E.A.N.</div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="√âcris √† J.E.A.N..." />
      <button onclick="sendChat()">Envoyer</button>
    </div>
  </div>

  <script>
    const API_BASE = "https://tinsflash-backend.onrender.com/api";
    const chat = document.getElementById("chatJean");
    const btnAI = document.getElementById("btnAI");
    btnAI.onclick = ()=>{chat.style.display = chat.style.display==="flex"?"none":"flex";};

    async function sendChat(){
      const i=document.getElementById("chatInput");const msg=i.value.trim();
      if(!msg)return;
      const m=document.getElementById("chatMessages");
      m.innerHTML+=`<div style="color:#4fc3f7;">Vous: ${msg}</div>`;
      i.value="";
      try{
        const r=await fetch(`${API_BASE}/jean`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:msg})});
        const d=await r.json();
        m.innerHTML+=`<div>J.E.A.N: ${d.reply}</div>`;
        m.scrollTop=m.scrollHeight;
      }catch(e){m.innerHTML+=`<div>Erreur: ${e.message}</div>`;}
    }

    async function fetchJSON(url){try{const r=await fetch(url);if(!r.ok)throw new Error(`API ${r.status}`);return await r.json();}catch(e){console.error(e);return null;}}

    async function loadForecast(){
      const d=await fetchJSON(`${API_BASE}/status`);
      if(!d)return;
      const loc=document.getElementById("local-today");
      const nat=document.getElementById("national-today");
      if(d.forecasts?.local?.today)loc.innerHTML=`<b>${d.forecasts.local.today.summary}</b><br>${d.forecasts.local.today.temp_min}¬∞C / ${d.forecasts.local.today.temp_max}¬∞C`;
      else loc.innerHTML="‚ö†Ô∏è Donn√©es locales indisponibles";
      if(d.forecasts?.national?.today)nat.innerHTML=`<b>${d.forecasts.national.today.summary}</b><br>${d.forecasts.national.today.temp_min}¬∞C / ${d.forecasts.national.today.temp_max}¬∞C`;
      else nat.innerHTML="‚ö†Ô∏è Donn√©es nationales indisponibles";
      if(d.forecasts?.week){
        document.getElementById("forecast-7days").innerHTML=d.forecasts.week.map(f=>`<div class="forecast-box"><h3>${f.date}</h3><p>${f.summary}</p><p>üå° ${f.temp_min}¬∞C / ${f.temp_max}¬∞C</p></div>`).join("");
      }
    }

    async function loadAlerts(){
      const a=await fetchJSON(`${API_BASE}/alerts`);
      const div=document.getElementById("alerts");
      div.innerHTML="";
      if(!a||!a.length){div.innerHTML="‚úÖ Aucune alerte active";return;}
      a.forEach(e=>{
        const p=document.createElement("p");
        if(e.level==="continental")p.innerHTML=`<div class="alert-warning">‚ö†Ô∏è Alertes sur votre continent ‚Äì consultez la carte pour le d√©tail.</div>`;
        else p.innerHTML=`‚ö†Ô∏è <strong>${e.zone||e.country}</strong> ‚Äì ${e.title||e.type||"Alerte"} (${e.level||"info"})`;
        div.appendChild(p);
      });
    }

    function initMaps(){
      const mF=L.map("map-forecast").setView([20,10],2);
      const mA=L.map("map-alerts").setView([20,10],2);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mF);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mA);
    }

    function detectPosition(){
      const ps=document.getElementById("position-status");
      if(!navigator.geolocation){ps.textContent="‚ùå G√©olocalisation non support√©e";return;}
      navigator.geolocation.getCurrentPosition(p=>{
        ps.textContent=`‚úÖ Position d√©tect√©e : ${p.coords.latitude.toFixed(2)}, ${p.coords.longitude.toFixed(2)}`;
      },()=>{ps.textContent="‚ö†Ô∏è Position non d√©tect√©e, entrez votre adresse manuellement."});
    }

    document.addEventListener("DOMContentLoaded",()=>{
      detectPosition();
      initMaps();
      loadForecast();
      loadAlerts();
    });
  </script>
</body>
</html>
