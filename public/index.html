<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TinsFlash ‚Äì Super Radar M√©t√©o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#f4f6f9; color:#222; }
    header video { width:100%; max-height:300px; object-fit:cover; }
    header .overlay { position:absolute; top:20px; left:20px; color:#fff; background:#0008; padding:10px 20px; border-radius:6px; }
    h1 { margin:0; font-size:1.8em; }
    button { background:#0077ff; border:none; padding:10px 20px; border-radius:6px; color:white; cursor:pointer; margin-top:10px; }
    button:hover { background:#005fcc; }
    section { padding:20px; }
    h2 { border-left:5px solid #0077ff; padding-left:10px; }
    .forecast-container { display:flex; gap:15px; flex-wrap:wrap; }
    .forecast-day { flex:1; min-width:120px; background:white; padding:10px; border-radius:8px; box-shadow:0 2px 6px #0002; text-align:center; }
    .forecast-day img { width:50px; height:50px; }
    .alert { padding:12px; border-radius:6px; margin-bottom:10px; }
    .alert.high { background:#ffcccc; border:1px solid #cc0000; }
    .alert.medium { background:#fff4cc; border:1px solid #cc9900; }
    iframe { width:100%; height:400px; border:none; border-radius:8px; }
    footer { background:#222; color:#eee; padding:15px; text-align:center; }
    .premium { background:#0077ff11; border:1px solid #0077ff; padding:15px; border-radius:8px; margin-top:20px; text-align:center; }
  </style>
</head>
<body>
  <header>
    <video autoplay muted loop playsinline>
      <source src="intro-jean.mp4" type="video/mp4">
    </video>
    <div class="overlay">
      <h1>üåç TinsFlash ‚Äì Super Radar M√©t√©o</h1>
      <button onclick="loadWeather()">üîÑ Rafra√Æchir les pr√©visions</button>
    </div>
  </header>

  <section>
    <h2>üìç Pr√©visions locales</h2>
    <div id="forecast" class="forecast-container">Chargement...</div>
  </section>

  <section>
    <h2>‚ö†Ô∏è Alertes m√©t√©o</h2>
    <div id="alerts">Chargement...</div>
  </section>

  <section>
    <h2>üå¶ Radar en direct</h2>
    <iframe id="radar" src=""></iframe>
  </section>

  <section class="premium">
    <h2>üöÄ Passez √† Premium, Pro ou Pro+ !</h2>
    <p>Profitez de pr√©visions ultra pr√©cises, du Super Radar avanc√© et de l‚Äôassistance de J.E.A.N., votre expert m√©t√©o IA.</p>
  </section>

  <footer>
    ¬© 2025 TinsFlash ‚Äì Pr√©visions et radar m√©t√©o nouvelle g√©n√©ration
  </footer>

  <script>
    async function loadWeather() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          // --- Pr√©visions locales (7 jours) ---
          const forecastRes = await fetch(`/api/forecast/7days?lat=${lat}&lon=${lon}`);
          const forecastData = await forecastRes.json();
          renderForecast(forecastData);

          // --- Alertes ---
          const alertsRes = await fetch(`/api/alerts`);
          const alertsData = await alertsRes.json();
          renderAlerts(alertsData);

          // --- Radar (RainViewer gratuit) ---
          document.getElementById("radar").src =
            `https://www.rainviewer.com/map.html?loc=${lat},${lon},7&oFa=1&oC=1&oU=0&oCS=1&oF=1&oAP=1&c=3`;
        }, () => {
          document.getElementById("forecast").innerHTML = "‚ùå Localisation refus√©e.";
        });
      }
    }

    function renderForecast(data) {
      if (!data || !data.daily) {
        document.getElementById("forecast").innerHTML = "‚ùå Aucune donn√©e disponible.";
        return;
      }
      let html = "";
      data.daily.forEach(day => {
        html += `
          <div class="forecast-day">
            <h3>${new Date(day.date).toLocaleDateString("fr-FR", { weekday:"long", day:"numeric", month:"short" })}</h3>
            <img src="https://openweathermap.org/img/wn/${day.icon || "01d"}@2x.png" alt="">
            <p>${day.temp}¬∞C</p>
            <p>${day.description}</p>
          </div>
        `;
      });
      document.getElementById("forecast").innerHTML = html;
    }

    function renderAlerts(alerts) {
      if (!alerts || alerts.length === 0) {
        document.getElementById("alerts").innerHTML = "‚úÖ Aucune alerte pour votre zone.";
        return;
      }
      let html = "";
      alerts.forEach(a => {
        const cls = a.reliability >= 90 ? "high" : "medium";
        html += `<div class="alert ${cls}"><b>${a.type}</b> ‚Äì ${a.message} (Confiance: ${a.reliability}%)</div>`;
      });
      document.getElementById("alerts").innerHTML = html;
    }

    // Auto-lancement au chargement
    loadWeather();
  </script>
</body>
</html>
