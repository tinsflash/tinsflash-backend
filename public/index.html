<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TINSFLASH ‚Ä¢ Pr√©visions & Alertes</title>

  <!-- Google Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8204947691352732" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body{margin:0;font-family:"Segoe UI",sans-serif;background:#0f172a;color:#f5faff;}
    header{text-align:center;padding:15px;background:linear-gradient(90deg,#08101f,#15294d);
      color:#4fc3f7;font-size:1.6em;font-weight:bold;text-shadow:0 0 12px #4fc3f7;}
    .subheader{text-align:center;background:#0d1528;color:#7dd3fc;padding:6px;font-size:0.9em;}
    video{width:100%;max-height:180px;object-fit:cover;display:block;}
    main{max-width:1200px;margin:auto;padding:20px;}
    h2{color:#4fc3f7;border-left:4px solid #4fc3f7;padding-left:10px;margin-top:35px;}
    p.intro{color:#e0e8f9;line-height:1.7;font-size:1.08em;text-align:justify;}
    .intro-block{display:flex;align-items:flex-start;gap:18px;margin-top:20px;flex-wrap:wrap;opacity:0;transform:translateY(25px);transition:opacity 0.8s ease,transform 0.8s ease;}
    .intro-block.visible{opacity:1;transform:translateY(0);}
    .intro-block img{border-radius:12px;width:150px;height:auto;box-shadow:0 0 18px rgba(0,0,0,0.4);}
    .forecast-section{display:flex;flex-wrap:wrap;gap:20px;}
    .forecast-box{background:#131a2b;border-radius:10px;padding:15px;flex:1;min-width:300px;box-shadow:0 0 10px rgba(0,0,0,0.3);}
    .map-container{height:360px;margin:25px 0;border-radius:10px;overflow:hidden;box-shadow:0 0 12px rgba(0,0,0,0.4);}
    .alert-warning{background:#facc15;color:#000;text-align:center;font-weight:bold;padding:10px;border-radius:6px;animation:blink 1.2s infinite alternate;}
    @keyframes blink{from{opacity:1;}to{opacity:0.3;}}
    footer{text-align:center;background:#111827;color:#ccc;padding:15px;font-size:0.9em;}
    footer a{color:#4fc3f7;text-decoration:none;}
    footer a:hover{text-decoration:underline;}
    .banner{background:#16233a;color:#4fc3f7;padding:12px;text-align:center;font-weight:bold;margin-top:20px;border-radius:8px;}

    /* Chat IA */
    .btn-ai{position:fixed;bottom:25px;right:25px;background:#4fc3f7;color:#000;font-weight:bold;
      border:none;border-radius:50%;width:52px;height:52px;cursor:pointer;box-shadow:0 0 15px rgba(79,195,247,0.6);
      font-size:18px;transition:transform .3s ease;z-index:999;}
    .btn-ai:hover{transform:scale(1.1);}
    .chat-box{position:fixed;bottom:90px;right:20px;background:#1b2439;border:2px solid #4fc3f7;border-radius:12px;
      width:320px;height:400px;display:none;flex-direction:column;box-shadow:0 0 15px rgba(0,0,0,0.5);z-index:999;}
    .chat-header{background:#4fc3f7;color:#000;text-align:center;padding:6px;font-weight:bold;}
    .chat-messages{flex:1;padding:8px;overflow-y:auto;font-size:14px;background:#0e1423;}
    .chat-input{display:flex;border-top:1px solid #333;}
    .chat-input input{flex:1;padding:8px;border:none;background:#1b2339;color:#eee;}
    .chat-input button{background:#4fc3f7;border:none;color:#000;padding:8px 12px;font-weight:bold;cursor:pointer;}
    .notif-btn{background:#4fc3f7;color:#000;padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;margin-top:8px;}
    .premium-box{position:fixed;bottom:30px;right:20px;background:#15294d;color:#fff;border:2px solid #4fc3f7;
      border-radius:12px;padding:12px 16px;font-size:14px;box-shadow:0 0 15px rgba(0,0,0,0.5);display:none;z-index:998;}
    .premium-box a{color:#4fc3f7;text-decoration:none;font-weight:bold;}
  </style>
</head>

<body>
  <header>TINSFLASH ‚Ä¢ Pr√©visions & Alertes</header>
  <div class="subheader">üõ∞ Donn√©es satellites ‚Ä¢ Mod√®les IA multi-sources ‚Ä¢ Sp√©cificit√©s locales (relief, altitude, oc√©ans)</div>

  <video autoplay muted loop playsinline id="introVideo">
    <source src="intro-jean.mp4" type="video/mp4" />
  </video>
  <button id="soundBtn" style="position:absolute;top:15px;right:15px;z-index:99;background:#4fc3f7;border:none;padding:8px 10px;border-radius:6px;cursor:pointer;">üîä</button>

  <main>
    <div class="intro-block" id="introBlock">
      <img src="avatars/jean-default.png" alt="avatar">
      <div>
        <h2>Pr√©sentation du syst√®me J.E.A.N.</h2>
        <p class="intro">
          Le <strong>Syst√®me J.E.A.N.</strong> croise en temps r√©el les donn√©es satellites,
          mod√®les num√©riques et intelligences artificielles multi-sources. Il analyse le relief,
          l‚Äôhumidit√©, la temp√©rature du sol et les microclimats pour fournir des pr√©visions
          <strong>fiables, locales, nationales et mondiales</strong>, tout en anticipant, souvent avant
          les autres, les anomalies m√©t√©orologiques susceptibles d‚Äô√©voluer en alertes.
        </p>
      </div>
    </div>

    <h2>üìç Votre position</h2>
    <div id="position-status">D√©tection de votre position en cours...</div>
    <input type="text" id="manualAddress" placeholder="Ou entrez votre adresse compl√®te (rue, ville, pays)" style="width:100%;padding:8px;margin-top:8px;border-radius:6px;border:none;background:#1b2339;color:#eee;" />
    <button class="notif-btn" onclick="askNotifications()">üîî Activer les notifications m√©t√©o</button>

    <h2>Pr√©visions du jour</h2>
    <div class="forecast-section">
      <div class="forecast-box"><h3>üåç Locales</h3><div id="local-today">Chargement...</div></div>
      <div class="forecast-box"><h3>üì° Nationales</h3><div id="national-today">Chargement...</div></div>
    </div>

    <h2>Pr√©visions sur 7 jours</h2>
    <div id="forecast-7days" class="forecast-section">Chargement...</div>

    <h2>Alertes actives</h2>
    <div id="alerts">Chargement des alertes...</div>

    <h2>Carte couverture & pr√©visions</h2>
    <div id="map-forecast" class="map-container"></div>

    <h2>Carte mondiale des alertes</h2>
    <div id="map-alerts" class="map-container"></div>

    <h2>Radar Windy</h2>
    <iframe id="windyRadar" width="100%" height="450" src="https://embed.windy.com/embed2.html?lat=48.0&lon=3.0&zoom=3&level=surface&overlay=rain&menu=true" frameborder="0"></iframe>

    <div class="banner">
      üîß Pour vos diagnostics et d√©tections de fuites :
      <a href="https://www.uman-detect.com" target="_blank">Uman-Detect.com</a>
    </div>
  </main>

  <footer>
    ¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s<br/>
    üìß <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> |
    üí¨ <a href="https://wa.me/32473264477" target="_blank">WhatsApp +32 473 26 44 77</a><br/>
    Une demande de partenariat ou un √©ventuel rachat de notre syst√®me ? Contactez-nous.
  </footer>

  <!-- Bulle IA -->
  <button class="btn-ai" id="btnAI">ü§ñ</button>
  <div class="chat-box" id="chatJean">
    <div class="chat-header">Assistant J.E.A.N.</div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="√âcris √† J.E.A.N..." />
      <button onclick="sendChat()">Envoyer</button>
    </div>
  </div>

  <div class="premium-box" id="premiumBox">
    üöÄ Passez √† <a href="https://tinsflash.com/premium" target="_blank">Premium</a> ou
    <a href="https://tinsflash.com/pro" target="_blank">Pro</a> pour d√©bloquer toutes les alertes et pr√©visions d√©taill√©es !
  </div>

  <script>
    const API_BASE="https://tinsflash-backend.onrender.com/api";
    const chat=document.getElementById("chatJean");
    const btnAI=document.getElementById("btnAI");
    const premiumBox=document.getElementById("premiumBox");

    // üîÅ Rectangle premium cyclique
    function togglePremiumBox(){
      premiumBox.style.display="block";
      setTimeout(()=>premiumBox.style.display="none",5000);
      setTimeout(togglePremiumBox,30000);
    }
    setTimeout(togglePremiumBox,3000);

    btnAI.onclick=()=>chat.style.display=chat.style.display==="flex"?"none":"flex";

    // üîä Gestion du son vid√©o
    const soundBtn=document.getElementById("soundBtn");
    soundBtn.onclick=()=>{
      const v=document.getElementById("introVideo");
      v.muted=!v.muted;
      soundBtn.textContent=v.muted?"üîá":"üîä";
    };

    // üí¨ IA Cohere connect√©e
    async function sendChat(){
      const i=document.getElementById("chatInput");
      const msg=i.value.trim();if(!msg)return;
      const m=document.getElementById("chatMessages");
      m.innerHTML+=`<div style='color:#4fc3f7;'>Vous : ${msg}</div>`;i.value="";
      try{
        const r=await fetch(`${API_BASE}/cohere`,{
          method:"POST",headers:{"Content-Type":"application/json"},
          body:JSON.stringify({question:msg})
        });
        const d=await r.json();
        if(!d.success)throw new Error(d.error||d.reply);
        m.innerHTML+=`<div>J.E.A.N : ${d.reply}</div>`;
      }catch(e){m.innerHTML+=`<div>‚ùå ${e.message}</div>`;}
      m.scrollTop=m.scrollHeight;
    }

    // üå¶ Chargement des pr√©visions et alertes
    async function fetchJSON(url){try{const r=await fetch(url);if(!r.ok)throw new Error("HTTP "+r.status);return await r.json();}catch(e){console.error(e);return null;}}

    async function loadForecast(){
      const d=await fetchJSON(`${API_BASE}/status`);if(!d)return;
      const loc=document.getElementById("local-today");
      const nat=document.getElementById("national-today");
      if(d.forecasts?.local?.today)
        loc.innerHTML=`<b>${d.forecasts.local.today.summary}</b><br>üå° ${d.forecasts.local.today.temp_min}¬∞C / ${d.forecasts.local.today.temp_max}¬∞C`;
      else loc.innerHTML="‚ö†Ô∏è Donn√©es locales indisponibles";
      if(d.forecasts?.national?.today)
        nat.innerHTML=`<b>${d.forecasts.national.today.summary}</b><br>üå° ${d.forecasts.national.today.temp_min}¬∞C / ${d.forecasts.national.today.temp_max}¬∞C`;
      else nat.innerHTML="‚ö†Ô∏è Donn√©es nationales indisponibles";
      if(d.forecasts?.week){
        document.getElementById("forecast-7days").innerHTML=d.forecasts.week.map(f=>
          `<div class='forecast-box'><h3>${f.date}</h3><p>${f.summary}</p><p>üå° ${f.temp_min}¬∞C / ${f.temp_max}¬∞C</p></div>`
        ).join("");
      }
    }

    async function loadAlerts(){
      const a=await fetchJSON(`${API_BASE}/alerts`);
      const div=document.getElementById("alerts");div.innerHTML="";
      if(!a||!a.length){div.innerHTML="‚úÖ Aucune alerte active";return;}
      const groups={local:[],national:[],world:[]};
      a.forEach(e=>{const lvl=e.level||"local";groups[lvl].push(e);});
      ["local","national","world"].forEach(l=>{
        if(groups[l].length){
          const details=groups[l].map(x=>`<li>${x.country||x.zone}: ${x.title||x.type}</li>`).join("");
          div.innerHTML+=`<details><summary>‚ö†Ô∏è ${l.toUpperCase()}</summary><ul>${details}</ul></details>`;
        }
      });
    }

    // üó∫Ô∏è Cartes connect√©es
    function initMaps(){
      const mF=L.map("map-forecast").setView([20,10],2);
      const mA=L.map("map-alerts").setView([20,10],2);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mF);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mA);
    }

    // üìç Position utilisateur
    function detectPosition(){
      const ps=document.getElementById("position-status");
      if(!navigator.geolocation){ps.textContent="‚ùå G√©olocalisation non support√©e";return;}
      navigator.geolocation.getCurrentPosition(p=>{
        ps.textContent=`‚úÖ Position d√©tect√©e : ${p.coords.latitude.toFixed(2)}, ${p.coords.longitude.toFixed(2)}`;
      },()=>{ps.textContent="‚ö†Ô∏è Position non d√©tect√©e, entrez votre adresse manuellement."});
    }

    // üîî Notifications
    function askNotifications(){
      if(Notification.permission==="granted"){alert("Notifications d√©j√† activ√©es.");return;}
      Notification.requestPermission().then(p=>{
        if(p==="granted")new Notification("TINSFLASH : notifications m√©t√©o activ√©es !");
      });
    }

    // üéûÔ∏è Effet d‚Äôapparition fade-in
    window.addEventListener("scroll",()=>{
      const el=document.getElementById("introBlock");
      const rect=el.getBoundingClientRect();
      if(rect.top<window.innerHeight-100)el.classList.add("visible");
    });

    // üîΩ Cache la bulle IA pr√®s du footer
    window.addEventListener("scroll",()=>{
      const btn=document.getElementById("btnAI");
      const footer=document.querySelector("footer");
      const footerTop=footer.getBoundingClientRect().top;
      const vh=window.innerHeight;
      btn.style.opacity=(footerTop<vh-60)?"0":"1";
    });

    // üöÄ Init
    document.addEventListener("DOMContentLoaded",()=>{
      detectPosition();initMaps();loadForecast();loadAlerts();
      setInterval(loadForecast,600000);setInterval(loadAlerts,600000);
    });
  </script>
</body>
</html>
