<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TINSFLASH MÃ©tÃ©o â€“ PrÃ©visions et Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6828365665232268"
     crossorigin="anonymous"></script>

  <!-- Styles globaux -->
  <link rel="stylesheet" href="style.css">

  <!-- Leaflet pour radar -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Scripts -->
  <script defer src="app.js"></script>
  <script defer src="radar.js"></script>
</head>
<body>
  <header class="navbar">
    <div class="logo">ğŸŒ©ï¸ TinsFlash</div>
    <nav>
      <a href="index.html" class="active">Accueil</a>
      <a href="premium.html">Premium</a>
      <a href="pro.html">Pro</a>
      <a href="proplus.html">Pro+</a>
      <a href="cockpit.html">Cockpit</a>
      <a href="account.html">Mon Compte</a>
    </nav>
  </header>

  <main class="container">

    <!-- PrÃ©visions locales (derniÃ¨re run stockÃ©e) -->
    <section class="card" id="local">
      <h2>ğŸ“ PrÃ©visions locales</h2>
      <div id="local-content">â³ Chargement...</div>
    </section>

    <!-- PrÃ©visions nationales (vue moyenne pays) -->
    <section class="card" id="national">
      <h2>ğŸ‡§ğŸ‡ª PrÃ©visions nationales</h2>
      <div id="national-content">â³ Chargement...</div>
    </section>

    <!-- PrÃ©visions 7 jours -->
    <section class="card wide" id="seven-days">
      <h2>ğŸ“… PrÃ©visions 7 jours</h2>
      <div id="days-container" class="days-grid">â³ Chargement...</div>
    </section>

    <!-- Bulletin texte -->
    <section class="card" id="forecast-text-section">
      <h2>ğŸ“° Bulletin mÃ©tÃ©o</h2>
      <pre id="forecast-text">â³ GÃ©nÃ©ration...</pre>
    </section>

    <!-- Radar -->
    <section class="card wide" id="radar">
      <h2>ğŸ›°ï¸ Radar en direct</h2>
      <div id="radar-map" style="height:400px;border-radius:10px;">â³ Radar...</div>
    </section>

    <!-- Alertes -->
    <section class="card" id="alerts">
      <h2>âš ï¸ Alertes mÃ©tÃ©o</h2>
      <div id="alerts-content">â³ Chargement...</div>
    </section>

    <!-- Podcast -->
    <section class="card" id="podcast">
      <h2>ğŸ™ï¸ Podcast mÃ©tÃ©o</h2>
      <div id="podcast-container">â³ GÃ©nÃ©ration...</div>
    </section>

  </main>

  <footer class="footer">
    <p>Â© 2025 TinsFlash â€“ La mÃ©tÃ©o qui vous protÃ¨ge âš¡</p>
  </footer>

  <script>
    // Charger les prÃ©visions depuis la derniÃ¨re run stockÃ©e
    async function loadForecast() {
      try {
        const res = await fetch("/api/forecast/latest");
        const data = await res.json();

        if (data.error) {
          document.getElementById("local-content").innerText = "âŒ " + data.error;
          return;
        }

        // PrÃ©vision locale
        document.getElementById("local-content").innerText =
          `ğŸŒ¡ï¸ ${data.temperature_min}Â°C - ${data.temperature_max}Â°C | ` +
          `Vent ${data.wind} km/h | PrÃ©cipitations ${data.precipitation} mm | ` +
          `FiabilitÃ© ${data.reliability}%`;

        // PrÃ©vision nationale (simplifiÃ©e)
        document.getElementById("national-content").innerText =
          `ğŸ‡§ğŸ‡ª ${data.description || "RÃ©sumÃ© indisponible"}`;

        // PrÃ©visions 7 jours â†’ simulation
        const daysContainer = document.getElementById("days-container");
        daysContainer.innerHTML = "";
        const now = new Date();
        for (let i = 0; i < 7; i++) {
          const d = new Date();
          d.setDate(now.getDate() + i);
          const dayBox = document.createElement("div");
          dayBox.className = "card";
          dayBox.innerText = `${d.toLocaleDateString("fr-FR", { weekday: "long" })} :
            ${data.temperature_min}Â°C - ${data.temperature_max}Â°C, Vent ${data.wind} km/h`;
          daysContainer.appendChild(dayBox);
        }

        // Bulletin texte IA
        document.getElementById("forecast-text").innerText =
          data.description || "Analyse mÃ©tÃ©o indisponible.";
      } catch (err) {
        document.getElementById("local-content").innerText = "âŒ Erreur chargement prÃ©visions";
      }
    }

    document.addEventListener("DOMContentLoaded", loadForecast);
  </script>
</body>
</html>
