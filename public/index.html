<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>🌍 Centrale Nucléaire Météo – Vitrine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { background:#0a0f1c; color:#0ff; font-family:Arial, sans-serif; margin:0; padding:0; }
    h1, h2 { text-align:center; text-shadow:0 0 10px #0ff; }
    .section { border:1px solid #0ff; border-radius:10px; margin:15px; padding:15px; background:#111a2d; box-shadow:0 0 15px #0ff3; }
    button { background:#0ff; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:bold; }
    button:hover { background:#0cc; }
    pre, .box { background:#000; color:#0f0; padding:10px; border-radius:8px; overflow:auto; font-size:13px; }
    .error { color:red; font-weight:bold; }
    .ok { color:lime; font-weight:bold; }
    iframe { width:100%; height:300px; border:0; border-radius:10px; }
    .forecast-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); gap:10px; }
    .forecast-card { background:#0c162a; border-radius:8px; padding:10px; text-align:center; box-shadow:0 0 8px #0ff3; }
    .ads { margin:10px auto; text-align:center; background:#222; padding:8px; border-radius:8px; }
  </style>
</head>
<body>
  <h1>🌍 Centrale Nucléaire Météo</h1>
  <h2>Les prévisions et alertes les plus pointues du monde</h2>

  <!-- Google Ads -->
  <div class="ads">
    [Espace réservé Google Adsense – Bandeau pub]
  </div>

  <!-- Prévisions locales -->
  <div class="section">
    <h2>📍 Prévisions locales</h2>
    <button onclick="getLocalForecast()">🔄 Rafraîchir avec ma position</button>
    <pre id="localForecast">En attente géolocalisation...</pre>
  </div>

  <!-- Prévisions nationales -->
  <div class="section">
    <h2>🇧🇪🇫🇷 Prévisions Nationales (BE / FR)</h2>
    <button onclick="getBulletin('BE')">🇧🇪 Belgique</button>
    <button onclick="getBulletin('FR')">🇫🇷 France</button>
    <pre id="nationalForecast">Cliquez pour voir les bulletins...</pre>
  </div>

  <!-- Prévisions 7 jours -->
  <div class="section">
    <h2>📅 Prévisions 7 jours</h2>
    <div class="forecast-grid" id="weekForecast">Chargement...</div>
  </div>

  <!-- Alertes météo -->
  <div class="section">
    <h2>🚨 Alertes météo</h2>
    <button onclick="getAlerts()">🔄 Rafraîchir alertes</button>
    <pre id="alertsBox">En attente...</pre>
  </div>

  <!-- Bulletin météo -->
  <div class="section">
    <h2>📰 Bulletin météo automatique</h2>
    <pre id="bulletinBox">Chargement...</pre>
  </div>

  <!-- Radar -->
  <div class="section">
    <h2>📡 Radar météo global</h2>
    <iframe src="/api/radar/Europe"></iframe>
    <small>Radar interactif basé sur RainViewer / OpenStreetMap. 100% live.</small>
  </div>

  <!-- Actualités météo -->
  <div class="section">
    <h2>📰 Actualités météo (monde)</h2>
    <button onclick="getNews()">🔄 Rafraîchir</button>
    <div id="newsBox">Chargement...</div>
  </div>

  <!-- Upgrade -->
  <div class="section">
    <h2>✨ Passez Premium</h2>
    <p>Pour débloquer : radar avancé, prévisions ultra-détaillées, IA experte météo, et alertes avant tout le monde.</p>
    <button>💎 Devenir Premium</button>
  </div>

  <script>
    // Prévisions locales
    async function getLocalForecast() {
      document.getElementById("localForecast").innerText = "⏳ Chargement...";
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async pos => {
          try {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const res = await fetch(`/api/localforecast/${lat}/${lon}`);
            const data = await res.json();
            document.getElementById("localForecast").innerText = JSON.stringify(data, null, 2);
          } catch (err) {
            document.getElementById("localForecast").innerHTML = `<span class="error">Erreur: ${err}</span>`;
          }
        });
      } else {
        document.getElementById("localForecast").innerText = "❌ Géolocalisation non supportée.";
      }
    }

    // Prévisions nationales
    async function getBulletin(zone) {
      document.getElementById("nationalForecast").innerText = `⏳ Bulletin ${zone}...`;
      try {
        const res = await fetch(`/api/bulletin/${zone}`);
        const data = await res.json();
        document.getElementById("nationalForecast").innerText = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("nationalForecast").innerHTML = `<span class="error">Erreur: ${err}</span>`;
      }
    }

    // Prévisions 7 jours (par défaut sur Belgique)
    async function getWeekForecast() {
      const grid = document.getElementById("weekForecast");
      grid.innerHTML = "⏳ Chargement...";
      try {
        const res = await fetch(`/api/forecast/BE`);
        const data = await res.json();
        grid.innerHTML = "";
        data.forEach(day => {
          grid.innerHTML += `
            <div class="forecast-card">
              <b>${day.date}</b><br>
              ${day.icon}<br>
              🌡️ ${day.min}°C / ${day.max}°C<br>
              🌧️ ${day.rain}%<br>
              💨 ${day.wind} km/h<br>
              📊 Fiabilité: ${day.confidence}%
            </div>`;
        });
      } catch (err) {
        grid.innerHTML = `<span class="error">Erreur: ${err}</span>`;
      }
    }

    // Alertes
    async function getAlerts() {
      document.getElementById("alertsBox").innerText = "⏳ Chargement...";
      try {
        const res = await fetch(`/api/alerts/Europe`);
        const data = await res.json();
        document.getElementById("alertsBox").innerText = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("alertsBox").innerHTML = `<span class="error">Erreur: ${err}</span>`;
      }
    }

    // Bulletin automatique
    async function getBulletinAuto() {
      document.getElementById("bulletinBox").innerText = "⏳ Chargement...";
      try {
        const res = await fetch(`/api/bulletin/BE`);
        const data = await res.json();
        document.getElementById("bulletinBox").innerText = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("bulletinBox").innerHTML = `<span class="error">Erreur: ${err}</span>`;
      }
    }

    // News
    async function getNews() {
      document.getElementById("newsBox").innerText = "⏳ Chargement...";
      try {
        const res = await fetch("/api/news");
        const data = await res.json();
        let html = "<ul>";
        data.forEach(n => html += `<li><a href="${n.url}" target="_blank">${n.title}</a></li>`);
        html += "</ul>";
        document.getElementById("newsBox").innerHTML = html;
      } catch (err) {
        document.getElementById("newsBox").innerHTML = `<span class="error">Erreur: ${err}</span>`;
      }
    }

    // Auto load on start
    getWeekForecast();
    getBulletinAuto();
    getAlerts();
    getNews();
  </script>
</body>
</html>
