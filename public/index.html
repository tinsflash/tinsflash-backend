<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tinsflash – Météo augmentée par IA</title>
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="favicon.png" />
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #0b0f19;
      color: #e6e6e6;
      margin: 0;
      padding: 0;
    }
    header video {
      width: 100%;
      height: 280px;
      object-fit: cover;
      display: block;
    }
    section {
      padding: 20px;
      max-width: 1100px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
      color: #4fc3f7;
    }
    p.intro {
      text-align: justify;
      line-height: 1.6;
      font-size: 1.05rem;
      color: #ccc;
      margin-bottom: 30px;
    }
    .weather-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
    }
    .weather-card {
      background: #1a2238;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
      text-align: center;
    }
    .weather-card h3 {
      color: #4fc3f7;
    }
    .weather-icon {
      width: 64px;
      height: 64px;
      margin: auto;
    }
    .alert-section {
      background: #141b2d;
      padding: 15px;
      border-radius: 10px;
      margin-top: 25px;
    }
    iframe.map {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 10px;
      margin-top: 20px;
    }
    .footer {
      background: #111831;
      color: #aaa;
      text-align: center;
      padding: 15px;
      font-size: 0.9rem;
    }
    .footer a { color: #4fc3f7; text-decoration: none; }
    #avatar {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: url('avatar-default.png') center/cover no-repeat;
      border: 2px solid #4fc3f7;
      cursor: pointer;
      z-index: 999;
    }
    .ads-banner {
      width: 100%;
      text-align: center;
      margin: 25px 0;
      color: #999;
    }

    /* ⭐ BOUTON PREMIUM FLOTTANT ⭐ */
    #premium-float {
      position: fixed;
      bottom: 130px;
      right: 25px;
      background: linear-gradient(45deg,#ffd700,#ff9800);
      color: #000;
      font-weight: bold;
      border-radius: 50px;
      padding: 12px 18px;
      box-shadow: 0 0 15px rgba(255,215,0,0.7);
      cursor: pointer;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 10px rgba(255,215,0,0.6); }
      50% { box-shadow: 0 0 20px rgba(255,215,0,1); transform: scale(1.05); }
      100% { box-shadow: 0 0 10px rgba(255,215,0,0.6); transform: scale(1); }
    }
    #premium-options {
      display: none;
      position: fixed;
      bottom: 180px;
      right: 25px;
      background: #111831;
      border: 1px solid #4fc3f7;
      border-radius: 10px;
      padding: 10px;
      z-index: 9999;
      width: 240px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }
    #premium-options a {
      display: block;
      text-align: center;
      background: #4fc3f7;
      color: #000;
      padding: 8px;
      border-radius: 6px;
      text-decoration: none;
      margin: 6px 0;
      font-weight: bold;
    }
    #premium-options a:hover { background: #0288d1; color:#fff; }

    @media(max-width:700px){
      header video{height:180px;}
      #avatar{width:70px;height:70px;}
      #premium-float{padding:10px 14px;font-size:0.9rem;}
    }
  </style>
</head>
<body>
  <header>
    <video autoplay muted loop playsinline>
      <source src="intro-jean.mp4" type="video/mp4" />
    </video>
  </header>

  <section>
    <h1>🌍 Tinsflash – la météo augmentée par l’intelligence artificielle</h1>
    <p class="intro">
      Tinsflash croise en continu les données de tous les grands modèles (GFS, ECMWF, ICON, NOAA, Copernicus…)
      et les images satellites avec nos intelligences artificielles locales.  
      Notre moteur IA combine plusieurs couches d’analyse : relief, climat, topographie, cours d’eau,
      facteurs thermiques, et signaux faibles de dérive atmosphérique.  
      Résultat : des <strong>prévisions locales et nationales ultra-précises</strong>,
      capables de détecter les phénomènes avant les autres.  
      Rejoignez le <strong>Tins’Fan Club</strong> pour obtenir des alertes anticipées,
      des concours exclusifs et un accès Premium ou Pro à nos prévisions IA avancées.
    </p>

    <h2>☀️ Météo du jour</h2>
    <div class="weather-grid" id="todayForecast"></div>

    <h2>📅 Prévisions sur 7 jours</h2>
    <div class="weather-grid" id="weekForecast"></div>

    <div class="alert-section" id="alertsSection">
      <h2>⚠️ Alertes locales, nationales et mondiales</h2>
      <div id="alertsContent">Chargement des alertes en cours...</div>
    </div>

    <div class="ads-banner">— Partenaire officiel : <a href="https://www.uman-detect.com" target="_blank">Uman Detect Belgium</a> —</div>

    <h2>🗺️ Prévisions – Carte dynamique</h2>
    <iframe class="map" src="https://www.windy.com/?50.4,4.5,5"></iframe>

    <h2>🌪️ Alertes – Carte mondiale</h2>
    <iframe class="map" src="https://embed.windy.com/embed2.html?lat=50.4&lon=4.5&zoom=4&level=surface&overlay=alerts"></iframe>
  </section>

  <div class="ads-banner">📢 Espace publicitaire – Google AdSense activé</div>

  <section>
    <h2>🌧️ Radar en temps réel</h2>
    <iframe class="map" src="https://embed.windy.com/embed2.html?lat=50.4&lon=4.5&zoom=6&level=surface&overlay=rain"></iframe>
  </section>

  <footer class="footer">
    © 2025 Tinsflash | Contact : <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> | WhatsApp :
    <a href="https://wa.me/32473264477" target="_blank">+32 473 26 44 77</a><br>
    Pour partenariat, intégration IA ou achat de notre moteur : contactez-nous.
  </footer>

  <!-- Avatar IA J.E.A.N -->
  <div id="avatar" title="Parler à J.E.A.N"></div>

  <!-- ⭐ BOUTON PREMIUM FLOTTANT -->
  <div id="premium-float">⭐ Passez Premium / Pro</div>
  <div id="premium-options">
    <a href="https://buy.stripe.com/cNiaEZgK5bpffuRex3gfu00" target="_blank">🌟 Premium – 7j gratuits</a>
    <a href="https://buy.stripe.com/dRm4gBeBX9h782p74Bgfu01" target="_blank">🚀 Pro – 7j gratuits</a>
  </div>

  <script>
    // === Bouton Premium toggle ===
    const btn = document.getElementById("premium-float");
    const box = document.getElementById("premium-options");
    btn.addEventListener("click", () => {
      box.style.display = box.style.display === "block" ? "none" : "block";
    });

    // === GEOLOCALISATION UTILISATEUR ===
    window.onload = async () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async pos => {
          const { latitude, longitude } = pos.coords;
          loadWeather(latitude, longitude);
        }, () => loadWeather(50.4, 4.5));
      } else loadWeather(50.4, 4.5);
    };

    async function loadWeather(lat, lon) {
      try {
        const res = await fetch(`/api/forecast/${lat},${lon}`);
        const data = await res.json();
        document.getElementById("todayForecast").innerHTML =
          renderForecast(data.forecast?.today || {}, "Local") +
          renderForecast(data.forecast?.national || {}, "National");
        document.getElementById("weekForecast").innerHTML =
          renderWeek(data.forecast?.week || []);
      } catch (e) {
        console.error("Erreur météo:", e);
      }

      try {
        const resAlerts = await fetch("/api/alerts");
        const alerts = await resAlerts.json();
        document.getElementById("alertsContent").innerHTML =
          alerts.length ? alerts.map(a=>`<p>🌩️ <strong>${a.title}</strong> – ${a.description}</p>`).join("") :
          "<p>Aucune alerte active.</p>";
      } catch (e) {
        document.getElementById("alertsContent").innerText = "Erreur de chargement des alertes.";
      }
    }

    function renderForecast(data, label) {
      if (!data || !data.temp_min) return "";
      return `<div class='weather-card'>
        <h3>${label}</h3>
        <img src='${data.icon || "https://openweathermap.org/img/wn/10d.png"}' class='weather-icon'/>
        <p>${data.condition || "N/A"}</p>
        <p>🌡️ Min ${data.temp_min}° / Max ${data.temp_max}°</p>
        <p>💨 Vent ${data.wind || "?"} km/h</p>
      </div>`;
    }

    function renderWeek(days) {
      return days.map(d=>`
        <div class='weather-card'>
          <h3>${d.day || ""}</h3>
          <img src='${d.icon || "https://openweathermap.org/img/wn/10d.png"}' class='weather-icon'/>
          <p>${d.condition || "N/A"}</p>
          <p>🌡️ ${d.temp_min}° / ${d.temp_max}°</p>
        </div>
      `).join("");
    }

    // === Avatar J.E.A.N chat cohere ===
    document.getElementById("avatar").addEventListener("click", async ()=>{
      const msg = prompt("💬 Pose ta question météo à J.E.A.N :");
      if(!msg) return;
      const res = await fetch("/api/jean",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:msg})});
      const data = await res.json();
      alert("🤖 J.E.A.N : " + data.reply);
    });
  </script>
</body>
</html>
