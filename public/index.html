<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TINSFLASH ‚Ä¢ Pr√©visions & Alertes en temps r√©el</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="index.css" />
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #0b0f19;
      color: #eee;
    }
    header {
      text-align: center;
      background: #081224;
      padding: 15px;
      color: #4fc3f7;
      font-weight: bold;
      font-size: 1.5em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    video {
      width: 100%;
      max-height: 260px;
      object-fit: cover;
    }
    .info-line {
      background: #0c1a2e;
      color: #4fc3f7;
      text-align: center;
      padding: 8px;
      font-size: 1em;
    }
    main {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    .intro {
      display: flex;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 25px;
    }
    .intro img.jean-avatar {
      width: 150px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,200,255,0.4);
      flex-shrink: 0;
    }
    .intro-text {
      flex: 1;
      text-align: justify;
      font-size: 1.05em;
      color: #ccc;
      line-height: 1.6em;
    }
    h2 {
      color: #4fc3f7;
      border-left: 4px solid #4fc3f7;
      padding-left: 10px;
      margin-top: 30px;
    }
    .forecast-section {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 20px;
    }
    .forecast-box {
      background: #121b2c;
      border-radius: 8px;
      flex: 1;
      min-width: 280px;
      padding: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .forecast-box h3 { color: #4fc3f7; }
    .blinking-box {
      animation: blink 1s infinite;
      background: rgba(0,255,255,0.1);
      border: 1px solid cyan;
      padding: 10px;
      border-radius: 8px;
    }
    @keyframes blink {
      0%,100%{opacity:1;}
      50%{opacity:0.6;}
    }
    #map-forecast, #map-alerts {
      height: 380px;
      border-radius: 10px;
      margin-top: 20px;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }
    footer {
      text-align: center;
      background: #081224;
      color: #aaa;
      padding: 15px;
      margin-top: 30px;
      font-size: 0.9em;
    }
    footer a { color: #4fc3f7; text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>üåç TINSFLASH ‚Ä¢ Pr√©visions & Alertes en temps r√©el</header>
  <video autoplay muted loop playsinline>
    <source src="background-sunrise.mp4" type="video/mp4" />
  </video>

  <div class="info-line">üõ∞ Donn√©es satellites ‚Ä¢ Mod√®les IA multi-sources ‚Ä¢ Sp√©cificit√©s locales (relief, altitude, oc√©ans)</div>

  <main>
    <section class="intro">
      <img src="avatars/jean-default.png" alt="J.E.A.N" class="jean-avatar" id="jeanAvatar" />
      <div class="intro-text">
        <h2>Pr√©sentation du moteur IA <b>J.E.A.N</b></h2>
        <p>
          Le <b>moteur TINSFLASH</b> combine <b>l‚Äôensemble des mod√®les m√©t√©orologiques existants</b>
          <i>plus les mod√®les d‚Äôintelligence artificielle de derni√®re g√©n√©ration</i>.  
          Il croise ces donn√©es avec les images satellites, le relief, l‚Äôaltitude,
          l‚Äôhumidit√© du sol et les microclimats pour fournir des
          <b>pr√©visions locales, nationales et mondiales d‚Äôune pr√©cision in√©gal√©e</b>,
          tout en anticipant <b>les alertes avant tout le monde</b>, o√π que vous soyez.
        </p>
      </div>
    </section>

    <section>
      <h2>üìç Votre position</h2>
      <p id="user-location">Analyse de votre zone en cours...</p>
    </section>

    <section>
      <h2>üìä Pr√©visions du jour</h2>
      <div class="forecast-section">
        <div class="forecast-box"><h3>üåÜ Locales</h3><div id="local-forecast">Chargement...</div></div>
        <div class="forecast-box"><h3>üèô Nationales</h3><div id="national-forecast">Chargement...</div></div>
      </div>
    </section>

    <section>
      <h2>üìÖ Pr√©visions sur 7 jours</h2>
      <div id="forecast-7days" class="forecast-section"></div>
    </section>

    <section>
      <h2>‚ö†Ô∏è Alertes en temps r√©el</h2>
      <div id="alerts" class="blinking-box">Chargement des alertes...</div>
    </section>

    <section>
      <h2>üó∫Ô∏è Carte mondiale des pr√©visions</h2>
      <div id="map-forecast"></div>
    </section>

    <section>
      <h2>üåé Carte mondiale des alertes</h2>
      <p id="continent-warning" style="text-align:center;color:#4fc3f7;"></p>
      <div id="map-alerts"></div>
    </section>
  </main>

  <footer>
    ¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s<br />
    üìß <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> |
    üí¨ WhatsApp : <a href="https://wa.me/32473264477" target="_blank">+32 473 26 44 77</a>
  </footer>

  <script src="index.js"></script>

  <script>
    // === G√©olocalisation et interface dynamique ===
    async function initPosition() {
      const locEl = document.getElementById("user-location");
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            const { latitude, longitude } = pos.coords;
            locEl.innerHTML = `Latitude : ${latitude.toFixed(2)}, Longitude : ${longitude.toFixed(2)}`;
            await loadForecastAndAvatar(latitude, longitude);
          },
          () => {
            locEl.innerHTML = "üìç G√©olocalisation refus√©e. Veuillez entrer une adresse manuellement.";
          }
        );
      } else {
        locEl.innerHTML = "‚ùå G√©olocalisation non support√©e.";
      }
    }

    // === Lien entre avatar et m√©t√©o ===
    async function loadForecastAndAvatar(lat, lon) {
      const avatar = document.getElementById("jeanAvatar");
      try {
        const res = await fetch(`/api/status`);
        const data = await res.json();

        // V√©rifie si zone couverte
        const covered = data?.checkup?.coveredPoints?.some(p =>
          Math.abs(p.lat - lat) < 0.5 && Math.abs(p.lon - lon) < 0.5
        );

        // D√©termine avatar selon m√©t√©o
        let condition = "default";
        const f = data.forecasts?.local || data.forecasts?.national;
        if (f?.today?.rain > 0) condition = "rain";
        if (data.alertsLocal?.length > 0) condition = "alert";
        if (f?.today?.sun) condition = "sun";

        avatar.src = `avatars/jean-${condition}.png`;

        // Marque la carte des zones couvertes
        const mapF = L.map("map-forecast").setView([20, 10], 2);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapF);
        (data.checkup?.coveredPoints || []).forEach(pt => {
          L.circle([pt.lat, pt.lon], {
            color: "green",
            fillColor: "green",
            fillOpacity: 0.4,
            radius: 80000
          }).addTo(mapF);
        });

        // Carte alertes
        const mapA = L.map("map-alerts").setView([20, 10], 2);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(mapA);
        (data.alertsWorld || []).forEach(a => {
          L.circle([a.lat, a.lon], {
            color: "red",
            fillColor: "red",
            fillOpacity: 0.6,
            radius: 100000
          }).addTo(mapA).bindPopup(a.title || "Alerte");
        });

        // Warning continent
        if (!covered) {
          document.getElementById("continent-warning").textContent =
            "‚ö†Ô∏è Alertes sur votre continent ‚Äî consultez la carte pour le d√©tail.";
        }
      } catch (e) {
        console.error("Erreur avatar/forecast:", e);
      }
    }

    initPosition();
  </script>
</body>
</html>
