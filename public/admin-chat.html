<!-- PATH: public/admin-chat.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üí¨ Console IA J.E.A.N ‚Äì Chat moteur & m√©t√©o</title>
  <style>
    body{font-family:Inter,system-ui,Arial;background:#0b0f19;color:#eee;margin:0}
    header{background:#111831;padding:15px;text-align:center;color:#4fc3f7;font-size:22px;font-weight:bold}
    nav{background:#1a2238;padding:10px;display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
    nav a{color:#ccc;text-decoration:none;font-weight:600}nav a:hover{color:#4fc3f7}
    main{padding:15px;max-width:900px;margin:auto}
    .chat-box{background:#111831;border-radius:10px;box-shadow:0 0 12px #000;overflow:hidden;display:flex;flex-direction:column;height:80vh}
    .chat-header{background:#4fc3f7;color:#000;text-align:center;font-weight:bold;padding:8px}
    .chat-messages{flex:1;padding:10px;overflow-y:auto;font-size:15px;line-height:1.5}
    .msg{margin:6px 0;padding:8px 10px;border-radius:8px;max-width:75%}
    .user{background:#4fc3f7;color:#000;margin-left:auto}
    .bot{background:#1e2a48;color:#fff}
    .chat-input{display:flex;border-top:1px solid #333;background:#0f1629;padding:8px}
    .chat-input input{flex:1;padding:10px;border-radius:8px;border:none;background:#1b2339;color:#eee}
    .chat-input button{background:#4fc3f7;color:#000;font-weight:bold;border:none;border-radius:8px;padding:10px 16px;cursor:pointer}
    .chat-input button:hover{background:#03a9f4}
    .mode-switch{display:flex;gap:10px;justify-content:center;margin:10px 0}
    .mode-switch button{background:#1a2238;color:#ccc;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
    .mode-switch button.active{background:#4fc3f7;color:#000;font-weight:bold}
    .status{font-size:13px;text-align:center;color:#7dd3fc;margin-top:5px}
  </style>
</head>
<body>
<script>
// === S√©curit√© admin ===
const storedPin=sessionStorage.getItem("tinsflashPIN");
if(!storedPin){
  const pin=prompt("Code d‚Äôacc√®s admin ?");
  if(pin!=="202679"){alert("‚õî Acc√®s refus√©");location.href="/";}
  else{sessionStorage.setItem("tinsflashPIN","ok");}
}

let mode="moteur"; // moteur / meteo
const messagesDiv=document.createElement("div");
let chatMessages;

// === Envoi question IA ===
async function sendMessage(){
  const input=document.getElementById("chatInput");
  const msg=input.value.trim();
  if(!msg)return;
  chatMessages.innerHTML+=`<div class="msg user">üßë‚Äçüíª ${msg}</div>`;
  input.value="";
  chatMessages.scrollTop=chatMessages.scrollHeight;

  try{
    const res=await fetch("/api/ai-admin",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:msg,mode})
    });
    const data=await res.json();
    if(data.success){
      chatMessages.innerHTML+=`<div class="msg bot">ü§ñ ${data.reply}</div>`;
    }else{
      chatMessages.innerHTML+=`<div class="msg bot">‚ö†Ô∏è Erreur : ${data.error||"R√©ponse IA indisponible"}</div>`;
    }
  }catch(e){
    chatMessages.innerHTML+=`<div class="msg bot">‚ùå ${e.message}</div>`;
  }
  chatMessages.scrollTop=chatMessages.scrollHeight;
}

// === Changement de mode ===
function switchMode(newMode){
  mode=newMode;
  document.querySelectorAll(".mode-switch button").forEach(b=>b.classList.remove("active"));
  document.getElementById("btn-"+newMode).classList.add("active");
  document.getElementById("statusMode").innerHTML=`Mode actif : <b>${newMode.toUpperCase()}</b>`;
}

window.onload=()=>{
  chatMessages=document.getElementById("chatMessages");
  switchMode("moteur");
}
</script>

<header>üí¨ Console IA J.E.A.N ‚Äì Chat moteur & m√©t√©o</header>
<nav>
  <a href="/admin-pp.html">Console moteur</a>
  <a href="/admin-alerts.html">Alertes</a>
  <a href="/admin-chat.html">Chat</a>
  <a href="/admin-index.html">Index</a>
  <a href="/admin-radar.html">Radar & News</a>
  <a href="/admin-users.html">Utilisateurs</a>
</nav>

<main>
  <div class="mode-switch">
    <button id="btn-moteur" onclick="switchMode('moteur')">‚öôÔ∏è Moteur</button>
    <button id="btn-meteo" onclick="switchMode('meteo')">üå¶Ô∏è M√©t√©o</button>
  </div>
  <div class="status" id="statusMode">Mode actif : <b>MOTEUR</b></div>

  <div class="chat-box">
    <div class="chat-header">J.E.A.N (GPT-4o-mini)</div>
    <div class="chat-messages" id="chatMessages">
      <div class="msg bot">üëã Bonjour Patrick, ici J.E.A.N. ‚Äì Pr√™t √† analyser le moteur ou la m√©t√©o mondiale avec le mod√®le <b>GPT-4o-mini</b>.</div>
    </div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Pose ta question ici..." onkeypress="if(event.key==='Enter')sendMessage()" />
      <button onclick="sendMessage()">Envoyer</button>
    </div>
  </div>
</main>
</body>
</html>
