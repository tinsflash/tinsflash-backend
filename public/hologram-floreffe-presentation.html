<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåç TINSFLASH PRO+++ ‚Äî D√¥me Floreffe</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at 50% 60%, #001000 0%, #000 90%);
      font-family: 'Segoe UI', sans-serif;
      color: #8fe1ff;
    }
    #hud {
      position: absolute; top: 10px; left: 10px;
      font-size: 15px; color: #8fe1ff; text-shadow: 0 0 10px #00ffff; z-index: 10;
    }
    #btnDemo {
      position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0, 255, 255, 0.1); border: 1px solid #00c3ff; border-radius: 8px;
      color: #8fe1ff; padding: 10px 25px; font-size: 16px; cursor: pointer; z-index: 10;
    }
    #btnDemo:hover { background: #00c3ff; color: #000; font-weight: bold; }
    #intro {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: center;
      flex-direction: column; background: radial-gradient(circle at 50% 50%, #001010 0%, #000 90%);
      color: #0ff; z-index: 100; animation: fadeOut 4s ease 6s forwards;
    }
    @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
  </style>
</head>
<body>
  <div id="intro">
    <h1 style="font-size:2.5em; text-shadow:0 0 15px #00ffff;">üåç TINSFLASH PRO+++</h1>
    <p>IA J.E.A.N. ‚Äî D√¥me m√©t√©orologique Floreffe</p>
    <p style="opacity:0.7;">Relief HR, hydrologie et pr√©visions IA locales</p>
  </div>

  <div id="hud">‚è≥ Initialisation du d√¥me Floreffe...</div>
  <button id="btnDemo">‚ñ∂ D√âMONSTRATION AUTOMATIQUE</button>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.161/build/three.module.js";
    import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.161/examples/jsm/controls/OrbitControls.js";

    const hud = document.getElementById("hud");
    const btnDemo = document.getElementById("btnDemo");

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 8000);
    camera.position.set(0, 180, 500);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;

    scene.add(new THREE.DirectionalLight(0x99ffcc, 1.3).position.set(1,1,1));
    scene.add(new THREE.AmbientLight(0x102020));

    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(3000,3000),
      new THREE.MeshPhongMaterial({ color:0x001a00, opacity:0.6, transparent:true })
    );
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    const reliefGroup = new THREE.Group();
    const overlayGroup = new THREE.Group();
    const radarGroup = new THREE.Group();
    scene.add(reliefGroup, overlayGroup, radarGroup);

    async function loadData() {
      try {
        hud.textContent = "Chargement des donn√©es topographiques...";
        const altitudes = await (await fetch("./floreffe_altitudes_hr.json")).json();
        const forecasts = await (await fetch("./floreffe_forecasts.json")).json();
        buildScene(altitudes, forecasts);
      } catch (e) { hud.textContent = "‚ùå Erreur : "+e.message; }
    }

    function buildScene(altitudes, forecasts) {
      const geometry = new THREE.BufferGeometry();
      const vertices=[], colors=[];
      const cLow = new THREE.Color(0x0033aa), cHigh = new THREE.Color(0xffffff);

      altitudes.forEach(p=>{
        const x=(p.lon-4.7)*1000, y=p.alt*1.5, z=(50.4-p.lat)*1000;
        vertices.push(x,y,z);
        const c=cLow.clone().lerp(cHigh,Math.min(1,p.alt/300));
        colors.push(c.r,c.g,c.b);
      });

      geometry.setAttribute("position", new THREE.Float32BufferAttribute(vertices,3));
      geometry.setAttribute("color", new THREE.Float32BufferAttribute(colors,3));
      reliefGroup.add(new THREE.Points(geometry,new THREE.PointsMaterial({size:2.5,vertexColors:true})));

      forecasts.zones.forEach(z=>{
        const col=z.precipitation>10?0x00ffff:0x00aaff;
        const s=new THREE.Mesh(new THREE.SphereGeometry(3.5,8,8),new THREE.MeshBasicMaterial({color:col}));
        s.position.set((z.lon-4.7)*1000,(z.alt??100)+60,(50.4-z.lat)*1000);
        overlayGroup.add(s);
      });

      const radarGeom=new THREE.CircleGeometry(800,64);
      const radarMat=new THREE.MeshBasicMaterial({color:0x00ff66,transparent:true,opacity:0.08,side:THREE.DoubleSide});
      const radar=new THREE.Mesh(radarGeom,radarMat);
      radar.rotation.x=-Math.PI/2;
      radarGroup.add(radar);

      const radarAnim=()=>{radar.rotation.z+=0.002; radar.material.opacity=0.05+0.03*Math.sin(Date.now()*0.002); requestAnimationFrame(radarAnim);};
      radarAnim();
      hud.textContent="‚úÖ D√¥me pr√™t ‚Äî IA J.E.A.N. active.";
      animate();
    }

    function animate(){requestAnimationFrame(animate); reliefGroup.rotation.y+=0.0008; overlayGroup.rotation.y+=0.0008; controls.update(); renderer.render(scene,camera);}

    btnDemo.onclick=()=>{
      const speak=(t)=>{const u=new SpeechSynthesisUtterance(t);u.lang="fr-FR";speechSynthesis.speak(u);};
      speak("Bienvenue sur le d√¥me m√©t√©o IA J.E.A.N. de Floreffe.");
      let a=0; const loop=()=>{a+=0.003; camera.position.x=400*Math.sin(a); camera.position.z=400*Math.cos(a); camera.lookAt(0,100,0); requestAnimationFrame(loop);}; loop();
    };

    window.addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
    scene.fog=new THREE.Fog(0x001a00,200,1200);
    loadData();
  </script>
</body>
</html>
