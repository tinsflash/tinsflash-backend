<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="robots" content="noindex,nofollow" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>TINSFLASH ‚Ä¢ D√¥me Floreffe (IA J.E.A.N.)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{margin:0;font-family:"Segoe UI",sans-serif;background:#0f172a;color:#f5faff;}
header{text-align:center;padding:15px;background:linear-gradient(90deg,#08101f,#15294d);color:#4fc3f7;font-size:1.6em;font-weight:bold;text-shadow:0 0 12px #4fc3f7;}
.subheader{text-align:center;background:#0d1528;color:#7dd3fc;padding:6px;font-size:.9em;}
.video-container{position:relative;overflow:hidden;}
video{width:100%;max-height:180px;object-fit:cover;display:block;filter:brightness(.95);}
.video-overlay{position:absolute;bottom:0;width:100%;height:60px;background:linear-gradient(to bottom,rgba(15,23,42,0)0%,#0f172a100%);pointer-events:none;}
.sound-btn{position:absolute;right:15px;bottom:15px;background:rgba(0,0,0,.5);border:none;border-radius:50%;color:#4fc3f7;font-size:18px;padding:6px;cursor:pointer;}
main{max-width:1200px;margin:auto;padding:20px;}
h2{color:#4fc3f7;border-left:4px solid #4fc3f7;padding-left:10px;margin-top:35px;}
p{color:#e0e8f9;line-height:1.5;text-align:justify;}
.intro-title{text-align:center;color:#4fc3f7;font-size:1.6em;margin-top:25px;text-shadow:0 0 10px #4fc3f7;}
.intro-block{display:flex;align-items:center;gap:18px;flex-wrap:wrap;}
.intro-block img{border-radius:10px;width:140px;max-height:220px;object-fit:contain;box-shadow:0 0 18px rgba(0,0,0,.4);}
.intro-text{flex:1;max-height:200px;overflow-y:auto;background:#131a2b;padding:12px;border-radius:10px;color:#e0e8f9;line-height:1.5;}
.forecast-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
.forecast-card{background:#131a2b;border-radius:10px;padding:10px;min-width:130px;text-align:center;box-shadow:0 0 10px rgba(0,0,0,.3);}
.forecast-card small{color:#9ca3af;}
.map-container{height:360px;margin:25px 0;border-radius:10px;overflow:hidden;box-shadow:0 0 12px rgba(0,0,0,.4);}
.alert-section .alert-box{background:#1b2439;border-left:4px solid #4fc3f7;padding:8px;margin-bottom:8px;border-radius:8px;}
.alert-surv{border-left-color:#9ca3af!important;background:#202837;color:#cbd5e1;}
.alert-val{border-left-color:#facc15!important;background:#2a2535;color:#fde68a;}
.alert-conf{border-left-color:#22d3ee!important;background:#11263f;color:#bae6fd;}
.banner{background:#16233a;color:#4fc3f7;padding:12px;text-align:center;font-weight:bold;margin-top:20px;border-radius:8px;}
.premium-box{background:#11203a;border:1px solid #4fc3f7;border-radius:10px;padding:14px;margin-top:25px;text-align:center;}
.premium-box a{color:#4fc3f7;text-decoration:none;font-weight:bold;}
footer{text-align:center;background:#111827;color:#ccc;padding:15px;font-size:.9em;}
footer a{color:#4fc3f7;text-decoration:none;}
select{padding:8px;margin:10px 0;border-radius:6px;border:1px solid #4fc3f7;background:#11203a;color:#f5faff;}
.btn-ai{position:fixed;bottom:25px;right:25px;background:#4fc3f7;color:#000;font-weight:bold;border:none;border-radius:50%;width:52px;height:52px;cursor:pointer;box-shadow:0 0 15px rgba(79,195,247,.6);font-size:18px;transition:transform .3s ease;z-index:999;}
.btn-ai:hover{transform:scale(1.1);}
#update-info{text-align:right;color:#7dd3fc;font-size:.85em;margin-bottom:10px;}
</style>
</head>

<body>
<header>TINSFLASH ‚Ä¢ D√¥me Floreffe (IA J.E.A.N.)</header>
<div class="subheader">üõ∞ Donn√©es satellites ‚Ä¢ Mod√®les IA multi-sources ‚Ä¢ Analyse humaine combin√©e</div>
<div class="video-container">
<video autoplay muted loop playsinline id="introVideo"><source src="intro-jean.mp4" type="video/mp4"/></video>
<div class="video-overlay"></div><button class="sound-btn" id="soundToggle">üîá</button>
</div>

<main id="app">
<h2 class="intro-title">Pr√©sentation du syst√®me TINSFLASH IA J.E.A.N.</h2>
<div class="intro-block">
<img src="avatars/jean-default.png" alt="Avatar J.E.A.N"/>
<div class="intro-text">
<p>Le moteur <strong>TINSFLASH IA J.E.A.N.</strong> surveille en temps r√©el la commune de <b>Floreffe</b> et ses zones sensibles.</p>
<p>Objectif : <b>anticiper verglas, ruissellements et inondations</b> pour les services communaux.</p>
<p>Les analyses combinent donn√©es satellites, mod√®les m√©t√©o et IA locale J.E.A.N., pond√©r√©es par le relief, l‚Äôaltitude et l‚Äôhumidit√© du sol.</p>
</div>
</div>

<h2>M√©t√©o locale ‚Äî Maison communale (aujourd‚Äôhui)</h2>
<div id="update-info">Mise √† jour IA J.E.A.N. : <span id="updateTime">‚Äì</span></div>
<div id="forecast-today" class="forecast-grid">Chargement‚Ä¶</div>

<h2>Pr√©visions 7 jours ‚Äî Maison communale</h2>
<div id="forecast-week" class="forecast-grid">Chargement‚Ä¶</div>

<h2>Pr√©visions par zone</h2>
<select id="zoneSelect"></select>
<div id="zoneForecast" class="forecast-grid"></div>

<h2>Alertes locales et nationales</h2>
<div id="alerts-local" class="alert-section">Chargement‚Ä¶</div>

<h2>Carte communale ‚Äî Pr√©visions et alertes actives</h2>
<div id="map-alerts" class="map-container"></div>

<h2>Radar m√©t√©o Windy (IA)</h2>
<iframe width="100%" height="450" src="https://embed.windy.com/embed2.html?lat=50.45&lon=4.76&zoom=11&level=surface&overlay=rain&menu=true&message=true&type=map&location=coordinates" frameborder="0"></iframe>
<div class="banner">üåÄ Radar 3D/4D interne bient√¥t disponible</div>

<div class="premium-box">
‚òéÔ∏è <b>TINSFLASH ‚Äì Patrick Pynnaert</b><br/>
üìû <a href="tel:+32473264477">0473 26 44 77</a> ‚Äì üí¨ WhatsApp<br/>
üîß Partenaire diagnostics : <a href="https://www.uman-detect.com" target="_blank">Uman-Detect.com</a>
</div>
</main>

<footer>¬© 2025 TINSFLASH ‚Äì Tous droits r√©serv√©s | <a href="rgpd.html">Politique RGPD</a><br/>
üìß <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a></footer>

<script>
const video=document.getElementById("introVideo"),soundToggle=document.getElementById("soundToggle");
soundToggle.onclick=()=>{video.muted=!video.muted;soundToggle.textContent=video.muted?"üîá":"üîä";};

async function initFloreffe(){
 try{
  const f=await fetch("floreffe_forecasts.json?"+Date.now()).then(r=>r.json());
  const a=await fetch("floreffe_alerts.json?"+Date.now()).then(r=>r.json());
  document.getElementById("updateTime").textContent=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});
  renderForecastToday(f.general);
  renderForecastWeek(f.general);
  renderZones(f.zones||[],a);
  renderAlerts(a,true);
  renderMap(f.zones||[],a);
 }catch(e){console.error(e);}
}
document.addEventListener("DOMContentLoaded",initFloreffe);

// ===== Bloc m√©t√©o locale d√©taill√© =====
function renderForecastToday(g){
 const c=document.getElementById("forecast-today");
 if(!g||!g.temp_min){c.textContent="Aucune donn√©e";return;}
 const fiab=normalize(g.reliability);
 const icon=getIcon(g.condition);
 c.innerHTML=`
 <div class='forecast-card'>
   ${icon}<br>
   <b>${g.temp_min}¬∞ / ${g.temp_max}¬∞</b><br>
   ${g.condition||"‚Äî"}<br>
   üå° Ressentie : ${fmt(g.feels_like,"¬∞")}<br>
   üíß Pr√©cip. : ${fmt(g.precipitation," mm/h")}<br>
   üå¨ Vent : ${fmt(g.wind_speed," km/h")}<br>
   üîπ Fiabilit√© ${(fiab*100).toFixed(0)} %
 </div>`;
}

// ===== Bloc semaine =====
function renderForecastWeek(g){
 const c=document.getElementById("forecast-week");c.innerHTML="";
 const w=g?.week||[];
 if(!w.length){c.innerHTML="<div class='forecast-card'>Donn√©es indisponibles</div>";return;}
 w.forEach(j=>{
  const ic=getIcon(j.condition);
  c.innerHTML+=`<div class='forecast-card'>
  ${ic}<br><b>${j.day}</b><br>${j.temp_min}¬∞ / ${j.temp_max}¬∞<br><small>${j.condition}</small><br>
  <small>Fiabilit√© ${(normalize(j.reliability)*100).toFixed(0)} %</small></div>`;
 });
}

// ===== Bloc par zone =====
function renderZones(z,a){
 const sel=document.getElementById("zoneSelect"),zoneDiv=document.getElementById("zoneForecast");
 sel.innerHTML="";(z||[]).forEach(v=>{const o=document.createElement("option");o.value=v.name;o.textContent=v.name;sel.appendChild(o);});
 sel.onchange=()=>renderZone(z.find(x=>x.name===sel.value),a);
 if(z.length)renderZone(z[0],a);
}
function renderZone(z,alerts){
 const c=document.getElementById("zoneForecast");c.innerHTML="";
 if(!z){c.textContent="Aucune donn√©e";return;}
 const fiab=normalize(z.reliability);
 const ic=getIcon(z.condition);
 c.innerHTML=`<div class='forecast-card'>
 ${ic}<br><b>${z.name}</b><br>${z.temp_min}¬∞ / ${z.temp_max}¬∞<br>
 üíß ${fmt(z.precipitation," mm/h")}<br>
 üå¨ ${fmt(z.wind_speed," km/h")}<br>
 üí® Humidit√© ${fmt(z.humidity,"%")}<br>
 üîπ Fiabilit√© ${(fiab*100).toFixed(0)} %</div>`;
}

// ===== Alertes =====
function renderAlerts(list,showNational=false){
 const c=document.getElementById("alerts-local");c.innerHTML="";
 const l=Array.isArray(list)?list:[];if(!l.length){c.innerHTML="<div class='alert-box'>Aucune alerte active</div>";return;}
 const norm=x=>normalize(x.confidence||x.reliability);
 const sec=(t,cls,arr)=>arr.map(a=>`<div class='alert-box ${cls}'>‚ö†Ô∏è <b>${a.type}</b> ‚Äì ${a.zone}<br><small>${a.description||""}</small><br><small>Confiance ${(norm(a)*100).toFixed(0)} %</small></div>`).join("");
 let html=sec("conf","alert-conf",l.filter(a=>norm(a)>=.9));
 html+=sec("val","alert-val",l.filter(a=>norm(a)>=.7&&norm(a)<.9));
 html+=sec("surv","alert-surv",l.filter(a=>norm(a)<.7));
 c.innerHTML=html||"<div class='alert-box'>Aucune alerte locale</div>";
}

// ===== Carte =====
function renderMap(z,a){
 const m=L.map("map-alerts").setView([50.44,4.76],12);
 L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(m);
 (z||[]).forEach(f=>{
  if(f.lat&&f.lon)L.circleMarker([f.lat,f.lon],{radius:6,color:"#3b82f6"}).addTo(m)
   .bindPopup(`<b>${f.name}</b><br>${f.temp_min}¬∞ / ${f.temp_max}¬∞<br>${f.condition||""}`);
 });
 (a||[]).forEach(x=>{
  const r=normalize(x.confidence),clr=r>=.9?"#ef4444":r>=.7?"#f59e0b":"#9ca3af";
  if(x.lat&&x.lon)L.circleMarker([x.lat,x.lon],{radius:8,color:clr}).addTo(m)
   .bindPopup(`<b>${x.type}</b><br>${x.zone}<br><small>${x.description}</small><br><small>Confiance ${(r*100).toFixed(0)} %</small>`);
 });
}

// ===== Utils =====
function normalize(r){return typeof r!=="number"?0:r>1?r/100:r;}
function fmt(v,u){return v==null||isNaN(v)?"‚Äî":`${Number(v).toFixed(1)}${u||""}`;}
function getIcon(cond){
 const c=(cond||"").toLowerCase();
 if(c.includes("pluie"))return"üåßÔ∏è";
 if(c.includes("averse"))return"üå¶Ô∏è";
 if(c.includes("soleil"))return"‚òÄÔ∏è";
 if(c.includes("√©clair"))return"‚õÖ";
 if(c.includes("vent"))return"üå¨Ô∏è";
 if(c.includes("neige"))return"‚ùÑÔ∏è";
 if(c.includes("brouillard"))return"üå´Ô∏è";
 return"üå°Ô∏è";
}
</script>
</body>
</html>
