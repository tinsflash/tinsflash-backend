<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="robots" content="noindex,nofollow" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>TINSFLASH â€¢ DÃ´me Floreffe (IA J.E.A.N. â€“ Version complÃ¨te)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<style>
body{margin:0;font-family:"Segoe UI",sans-serif;background:#0f172a;color:#f5faff;}
header{display:flex;justify-content:space-between;align-items:center;padding:15px;background:linear-gradient(90deg,#08101f,#15294d);color:#4fc3f7;font-size:1.6em;font-weight:bold;text-shadow:0 0 12px #4fc3f7;}
header button{background:#11263f;color:#7dd3fc;border:1px solid #4fc3f7;border-radius:6px;padding:6px 12px;font-size:.9em;cursor:pointer;transition:.3s;}
header button:hover{background:#4fc3f7;color:#000;}
.subheader{text-align:center;background:#0d1528;color:#7dd3fc;padding:6px;font-size:.9em;}
.video-container{position:relative;overflow:hidden;}
video{width:100%;max-height:180px;object-fit:cover;display:block;filter:brightness(.95);}
.video-overlay{position:absolute;bottom:0;width:100%;height:60px;background:linear-gradient(to bottom,rgba(15,23,42,0)0%,#0f172a100%);pointer-events:none;}
.sound-btn{position:absolute;right:15px;bottom:15px;background:rgba(0,0,0,.5);border:none;border-radius:50%;color:#4fc3f7;font-size:18px;padding:6px;cursor:pointer;}
main{max-width:1300px;margin:auto;padding:20px;}
h2{color:#4fc3f7;border-left:4px solid #4fc3f7;padding-left:10px;margin-top:35px;}
p{color:#e0e8f9;line-height:1.5;text-align:justify;}
.intro-title{text-align:center;color:#4fc3f7;font-size:1.6em;margin-top:25px;text-shadow:0 0 10px #4fc3f7;}
.intro-block{display:flex;align-items:center;gap:18px;flex-wrap:wrap;}
.intro-block img{border-radius:10px;width:140px;max-height:220px;object-fit:contain;box-shadow:0 0 18px rgba(0,0,0,.4);}
.intro-text{flex:1;max-height:200px;overflow-y:auto;background:#131a2b;padding:12px;border-radius:10px;color:#e0e8f9;line-height:1.5;}
.map-container{height:420px;margin:25px 0;border-radius:10px;overflow:hidden;box-shadow:0 0 12px rgba(0,0,0,.4);}
#summary-box{background:#16233a;border-radius:10px;padding:12px;margin-top:15px;text-align:center;box-shadow:0 0 10px rgba(0,0,0,.3);}
.forecast-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;justify-content:center;}
.forecast-card{background:#131a2b;border-radius:10px;padding:10px;min-width:120px;text-align:center;box-shadow:0 0 10px rgba(0,0,0,.3);}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.9em;}
th,td{border-bottom:1px solid #22304e;padding:6px;text-align:center;}
th{background:#16233a;color:#7dd3fc;}
tr:hover{background:#1a2845;}
.alert-box{background:#1b2439;border-left:4px solid #4fc3f7;padding:8px;margin-bottom:8px;border-radius:8px;}
.alert-surv{border-left-color:#9ca3af!important;background:#202837;color:#cbd5e1;}
.alert-val{border-left-color:#facc15!important;background:#2a2535;color:#fde68a;}
.alert-conf{border-left-color:#22d3ee!important;background:#11263f;color:#bae6fd;}
.banner{background:#16233a;color:#4fc3f7;padding:12px;text-align:center;font-weight:bold;margin-top:20px;border-radius:8px;}
.premium-box{background:#11203a;border:1px solid #4fc3f7;border-radius:10px;padding:14px;margin-top:25px;text-align:center;}
footer{text-align:center;background:#111827;color:#ccc;padding:15px;font-size:.9em;}
footer a{color:#4fc3f7;text-decoration:none;}
footer a:hover{text-decoration:underline;}
.btn-ai{position:fixed;bottom:25px;right:25px;background:#4fc3f7;color:#000;font-weight:bold;border:none;border-radius:50%;width:52px;height:52px;cursor:pointer;box-shadow:0 0 15px rgba(79,195,247,.6);font-size:18px;transition:transform .3s ease;z-index:999;}
.btn-ai:hover{transform:scale(1.1);}
.chat-box{position:fixed;bottom:90px;right:20px;background:#1b2439;border:2px solid #4fc3f7;border-radius:12px;width:320px;height:420px;display:none;flex-direction:column;box-shadow:0 0 15px rgba(0,0,0,.5);z-index:999;}
.chat-header{background:#4fc3f7;color:#000;text-align:center;padding:6px;font-weight:bold;}
.chat-messages{flex:1;padding:8px;overflow-y:auto;font-size:14px;background:#0e1423;}
.chat-input{display:flex;border-top:1px solid #333;}
.chat-input input{flex:1;padding:8px;border:none;background:#1b2339;color:#eee;}
.chat-input button{background:#4fc3f7;border:none;color:#000;padding:8px 12px;font-weight:bold;cursor:pointer;}
</style>
</head>

<body>
<header>
  <span>TINSFLASH â€¢ DÃ´me Floreffe (IA J.E.A.N.)</span>
  <button id="castBtn">ğŸ¬ Caster vers Ã©cran</button>
</header>
<div class="subheader">ğŸ›° DonnÃ©es satellites â€¢ IA locale multi-sources â€¢ CorrÃ©lation topographique</div>

<div class="video-container">
  <video autoplay muted loop playsinline id="introVideo">
    <source src="intro-jean.mp4" type="video/mp4"/>
  </video>
  <div class="video-overlay"></div>
  <button class="sound-btn" id="soundToggle">ğŸ”‡</button>
</div>

<main>
<h2 class="intro-title">PrÃ©sentation du systÃ¨me TINSFLASH IA J.E.A.N.</h2>
<div class="intro-block">
<img src="avatars/jean-default.png" alt="Avatar J.E.A.N"/>
<div class="intro-text">
<p><strong>TINSFLASH IA J.E.A.N.</strong> analyse en continu la commune de <b>Floreffe</b> via 60 points de mesure intÃ©grant topographie, vent, humiditÃ© et donnÃ©es hydrologiques.</p>
<p>Objectif : <b>anticiper verglas, ruissellement et inondations</b> avant les services officiels, avec une fiabilitÃ© IA supÃ©rieure Ã  90 %.</p>
</div></div>

<h2>ğŸ“¡ SynthÃ¨se IA J.E.A.N. â€“ Commune de Floreffe</h2>
<div id="summary-box">Chargement des donnÃ©es...</div>

<h2>ğŸ—º Carte communale â€“ 60 points de prÃ©vision</h2>
<div id="map" class="map-container"></div>

<h2>ğŸ“Š DÃ©tail complet des zones</h2>
<div style="overflow-x:auto">
<table id="zonesTable">
<thead><tr><th>Zone</th><th>Temp (Â°C)</th><th>Pluie (mm/h)</th><th>Vent (km/h)</th><th>HumiditÃ© (%)</th><th>Altitude (m)</th><th>FiabilitÃ© IA (%)</th></tr></thead>
<tbody><tr><td colspan="7">Chargementâ€¦</td></tr></tbody>
</table></div>

<h2>âš ï¸ Alertes locales et nationales</h2>
<div id="alertsBox">Chargementâ€¦</div>

<h2>ğŸŒŒ DÃ´me holographique Floreffe</h2>
<iframe src="hologram-floreffe.html" style="width:100%;height:420px;border:none;border-radius:10px;"></iframe>

<div class="banner">ğŸŒ€ Radar 3D/4D interne bientÃ´t disponible</div>

<div class="premium-box">
â˜ï¸ Service & Helpdesk : <b>TINSFLASH â€“ Patrick Pynnaert</b><br/>
ğŸ“ <a href="tel:+32473264477">0473 26 44 77</a> â€“ ğŸ’¬ WhatsApp<br/>
ğŸ”§ <a href="https://www.uman-detect.com" target="_blank">Uman-Detect.com</a>
</div>
</main>

<footer>Â© 2025 TINSFLASH â€“ Tous droits rÃ©servÃ©s | <a href="rgpd.html">Politique RGPD</a><br/>
ğŸ“§ <a href="mailto:skysnapia@gmail.com">skysnapia@gmail.com</a> | ğŸ’¬ <a href="https://wa.me/32473264477" target="_blank">WhatsApp (contact Patrick)</a></footer>

<button class="btn-ai" id="btnAI">ğŸ¤–</button>
<div class="chat-box" id="chatJean"><div class="chat-header">Assistant mÃ©tÃ©o J.E.A.N.</div>
<div class="chat-messages" id="chatMessages">
<div style="color:#4fc3f7;padding:5px;">Pour discuter avec J.E.A.N., achetez vos crÃ©dits IA (5,90 â‚¬/100 questions).<br/>
<a href="https://buy.stripe.com/00w28t3Xj9h70zX0Gdgfu02" target="_blank" style="color:#7dd3fc;">ğŸ‘‰ Acheter des crÃ©dits</a></div></div>
<div class="chat-input"><input type="text" id="chatInput" placeholder="Posez votre question mÃ©tÃ©oâ€¦" disabled/><button disabled>Envoyer</button></div></div>

<script>
const video=document.getElementById("introVideo"),soundToggle=document.getElementById("soundToggle");
soundToggle.onclick=()=>{video.muted=!video.muted;soundToggle.textContent=video.muted?"ğŸ”‡":"ğŸ”Š";};
document.getElementById("btnAI").onclick=()=>{const c=document.getElementById("chatJean");c.style.display=c.style.display==="flex"?"none":"flex";};

// === ğŸ¬ CAST VERS Ã‰CRAN ===
const castBtn=document.getElementById("castBtn");
castBtn.addEventListener("click",async()=>{
 try{
   const stream=await navigator.mediaDevices.getDisplayMedia({video:true});
   const videoEl=document.createElement("video");
   videoEl.srcObject=stream;videoEl.play();
   alert("âœ… Projection active sur votre Ã©cran.\nFermez lâ€™onglet ou arrÃªtez le cast pour revenir au mode normal.");
 }catch(err){alert("âš ï¸ Casting annulÃ© ou non pris en charge : "+err.message);}
});

// === DONNÃ‰ES LOCALES ===
async function initFloreffe(){
 try{
  const forecasts=await fetch("floreffe_forecasts.json?"+Date.now()).then(r=>r.json());
  const alerts=await fetch("floreffe_alerts.json?"+Date.now()).then(r=>r.json());
  // ğŸ”§ Lecture compatible avec toutes versions de la Phase 5
let zones = [];
if (Array.isArray(forecasts?.zones)) zones = forecasts.zones;
else if (Array.isArray(forecasts?.data)) zones = forecasts.data;
else if (Array.isArray(forecasts?.data?.zones)) zones = forecasts.data.zones;
else if (Array.isArray(forecasts)) zones = forecasts;
else console.warn("âš ï¸ Aucune zone dÃ©tectÃ©e dans le JSON floreffe_forecasts.json", forecasts);
  const avg=(arr,k)=>arr.length?arr.reduce((a,b)=>a+(b[k]??0),0)/arr.length:0;
  const t=avg(zones,"temperature").toFixed(1);
  const p=avg(zones,"precipitation").toFixed(1);
  const w=avg(zones,"wind").toFixed(1);
  const h=avg(zones,"humidity")?avg(zones,"humidity").toFixed(0):"â€”";
  const r=(avg(zones,"reliability")*100).toFixed(0);
  document.getElementById("summary-box").innerHTML=
  `<b>ğŸŒ Commune de Floreffe</b><br>ğŸŒ¡ ${t}Â°C | ğŸ’§ ${p} mm/h | ğŸŒ¬ ${w} km/h | ğŸ’¦ ${h}%<br>ğŸ”¹ FiabilitÃ© IA J.E.A.N. : ${r}% | Points actifs : ${zones.length}/60`;
  renderMap(zones,alerts);renderTable(zones);renderAlerts(alerts);
 }catch(e){console.error(e);}
}
console.log(`ğŸ“Š ${zones.length} zones chargÃ©es pour Floreffe`);
function renderMap(zones,alerts){
 const map=L.map("map").setView([50.44,4.76],12);
 L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);
 (zones||[]).forEach(z=>{
  const marker=L.circleMarker([z.lat,z.lon],{radius:6,color:"#3b82f6"}).addTo(map);
  const info=`<b>${z.name}</b><br>ğŸŒ¡ ${fmt(z.temperature,"Â°C")}<br>ğŸ’§ ${fmt(z.precipitation," mm/h")}<br>ğŸŒ¬ ${fmt(z.wind," km/h")}<br>ğŸ”¹ FiabilitÃ© ${(z.reliability*100).toFixed(0)}%`;
  marker.bindPopup(info);
 });
 (alerts||[]).forEach(a=>{
  const r=a.reliability??a.confidence??0.8;
  let color="#f87171";if(r>=0.9)color="#ef4444";else if(r>=0.7)color="#f59e0b";else color="#9ca3af";
  if(a.lat&&a.lon)L.circleMarker([a.lat,a.lon],{radius:8,color}).addTo(map)
  .bindPopup(`<b>${a.type||"Alerte"}</b><br>${a.zone||""}<br><small>${a.description||""}</small><br>Confiance ${(r*100).toFixed(0)}%`);
 });
}

function renderTable(zones){
 const tb=document.querySelector("#zonesTable tbody");tb.innerHTML="";
 zones.forEach(z=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td>${z.name||"?"}</td><td>${fmt(z.temperature,"Â°")}</td><td>${fmt(z.precipitation,"")}</td><td>${fmt(z.wind,"")}</td><td>${fmt(z.humidity,"")}</td><td>${z.alt??"?"}</td><td>${(z.reliability*100).toFixed(0)}</td>`;
  tb.appendChild(tr);
 });
}

function renderAlerts(list){
 const c=document.getElementById("alertsBox");
 const items=Array.isArray(list)?list:[];
 if(!items.length){c.innerHTML="<div class='alert-box'>Aucune alerte active</div>";return;}
 let html="";
 const cat=(f,cls,title)=>{const arr=items.filter(f);if(!arr.length)return"";let t=`<h3>${title}</h3>`;arr.forEach(a=>{
  const r=(a.reliability??a.confidence??0.8)*100;
  t+=`<div class='alert-box ${cls}'><b>${a.type||"Alerte"}</b> â€“ ${a.zone||""}<br>${a.description?`<small>${a.description}</small><br>`:""}Confiance ${r.toFixed(0)}%</div>`;});return t;};
 html+=cat(a=>(a.reliability??a.confidence)>=0.9,"alert-conf","Alertes confirmÃ©es (â‰¥90%)");
 html+=cat(a=>{const r=a.reliability??a.confidence;return r>=0.7&&r<0.9;},"alert-val","Ã€ valider (70â€“89%)");
 html+=cat(a=>{const r=a.reliability??a.confidence;return r<0.7;},"alert-surv","En surveillance (<70%)");
 c.innerHTML=html;
}
function fmt(v,unit){return(v==null||isNaN(v))?"â€”":`${Number(v).toFixed(1)}${unit||""}`;}
window.onload=initFloreffe;
</script>
</body>
</html>
